<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><title>lambdasç¼–ç¨‹</title>
<link rel="stylesheet" href="/css/layout.css">
<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="/css/vendors/rabbit-lyrics.css">
<link rel="shortcut icon" href="/img/favicon.ico"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ç®€å•æ˜“æ‡‚ã®ç°ä»£é­”æ³•" type="application/atom+xml">
</head><body><header class="base-menu"><div class="menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">ç®€å•æ˜“æ‡‚ã®ç°ä»£é­”æ³•</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav></div></header><header class="base-mobile-menu"><div class="mobile-menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">ç®€å•æ˜“æ‡‚ã®ç°ä»£é­”æ³•</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav><div class="toggle-menu" id="mobile-menu-toggle"><span class="menu-bar"></span><span class="menu-bar"> </span><span class="menu-bar"></span></div></div></header><div class="base-content"><div class="base-content-main"><article class="article-main"><h1 class="article-title">lambdasç¼–ç¨‹</h1><div class="article-meta"><p class="meta-item meta-time"><span class="meta-item-title"></span><i class="icon-calendar"> </i>2021-12-09</p><p class="meta-item meta-tag"><span class="meta-item-title"></span><i class="icon-tag"> </i><a class="tag-link" href="/tags/kotlin/">kotlin</a></p></div><div class="article-content"><h2 id="ä¸»è¦å†…å®¹"><a class="header-anchor" href="#ä¸»è¦å†…å®¹">Â¶</a>ä¸»è¦å†…å®¹</h2>
<ol>
<li>lambdaè¡¨è¾¾å¼å’Œæˆå‘˜å¼•ç”¨</li>
<li>å‡½æ•°å¼é£æ ¼çš„é›†åˆä½¿ç”¨</li>
<li>Sequences: é›†åˆçš„æƒ°æ€§å¤„ç†</li>
<li>Kotlinä¸­ä½¿ç”¨Javaå‡½æ•°æ¥å£</li>
<li>å¸¦æœ‰receiverçš„lambdaå‡½æ•°çš„å†™æ³•</li>
</ol>
<h2 id="Lambda-expressions-and-member-references"><a class="header-anchor" href="#Lambda-expressions-and-member-references">Â¶</a>Lambda expressions and member references</h2>
<h3 id="Introduction-to-lambdas-blocks-of-code-as-function-parameters"><a class="header-anchor" href="#Introduction-to-lambdas-blocks-of-code-as-function-parameters">Â¶</a>Introduction to lambdas: blocks of code as function parameters</h3>
<h3 id="Syntax-for-lambda-expressions"><a class="header-anchor" href="#Syntax-for-lambda-expressions">Â¶</a>Syntax for lambda expressions</h3>
<p>æˆªæ­¢ç›®å‰ä¸ºæ­¢ï¼Œæ‰€æœ‰ç¼–ç¨‹è¯­è¨€çš„lambdaçš„è¡¨è¾¾å¼è¯­æ³•æ˜¯é€šç”¨å’Œç±»ä¼¼çš„ï¼Œ</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="keyword">val</span> sum = &#123; x: <span class="built_in">Int</span>, y: <span class="built_in">Int</span> -&gt; x + y &#125;</span><br><span class="line">&gt;&gt;&gt; println(sum(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="keyword">val</span> people = listOf(Person(<span class="string">&quot;Alice&quot;</span>, <span class="number">29</span>), Person(<span class="string">&quot;Bob&quot;</span>, <span class="number">31</span>))</span><br><span class="line">&gt;&gt;&gt; println(people.maxBy &#123; it.age &#125;)</span><br><span class="line">Person(name=Bob, age=<span class="number">31</span>)</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ç”¨äº†å†…å»ºçš„ç»“æ„ä½“ï¼Œä¸‹é¢æ˜¯ä¸€èˆ¬çš„lambdaè¯­æ³•ï¼š</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">people.maxBy(&#123; p: Person -&gt; p.age &#125;)</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…å†™æˆï¼š</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">people.maxBy() &#123; p: Person -&gt; p.age &#125;</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…å†™æˆï¼š</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">people.maxBy &#123; p: Person -&gt; p.age &#125;</span><br></pre></td></tr></table></figure>
<p>ç®€åŒ–çš„ç±»å‹æ¨æ–­ï¼š</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">people.maxBy &#123; p -&gt; p.age &#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœå°†lambdaå­˜å‚¨ä¸ºä¸€ä¸ªå˜é‡ï¼Œåœ¨æ²¡æœ‰ä¸Šä¸‹æ–‡ç¯å¢ƒçš„æƒ…å†µä¸‹ï¼Œæ˜¯æ— æ³•æ¨æ–­çš„ã€‚å¿…é¡»æ˜¾å¼æŒ‡å®šï¼š</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="keyword">val</span> getAge = &#123;p: Person -&gt; p.age &#125;</span><br><span class="line">&gt;&gt;&gt; people.maxBy(getAge)</span><br></pre></td></tr></table></figure>
<h3 id="Accessing-variables-in-scope"><a class="header-anchor" href="#Accessing-variables-in-scope">Â¶</a>Accessing variables in scope</h3>
<p>å¯¹äºæ‰€æœ‰å‡½æ•°å¼ç¼–ç¨‹è€Œè¨€ï¼ŒåŸºæœ¬ä¸Šï¼Œèƒ½å¤Ÿä¿®æ”¹å¤–éƒ¨å¼€æ”¾é¡¹çš„lambdaè¡¨è¾¾å¼å°±æ˜¯é—­åŒ…(ä¹Ÿå«æ–¹æ³•ï¼Œæˆ–è€…å¸¦æœ‰å‰¯ä½œç”¨çš„å‡½æ•°)ï¼›å¦åˆ™å°±æ˜¯çº¯å‡½æ•°ã€‚</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">tryToCountButtonClicks</span><span class="params">(button: <span class="type">Button</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> clicks = <span class="number">0</span></span><br><span class="line">  button.onClick &#123; clicks++ &#125;</span><br><span class="line">  <span class="keyword">return</span> clicks</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Member-references"><a class="header-anchor" href="#Member-references">Â¶</a>Member references</h3>
<p>Kotlinçš„æˆå‘˜å¼•ç”¨( <em>member reference</em> )å’ŒJava8çš„ <code>::</code>ä¸€æ ·ã€‚</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> getAge = Person::age</span><br></pre></td></tr></table></figure>
<p>å¯¹äºtop-levelçš„å‡½æ•°å¯ä»¥çœç•¥æ–‡ä»¶å(top-level æˆå‘˜çš„ç±»åå°±æ˜¯æ–‡ä»¶å)ï¼Œè­¬å¦‚ï¼š</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">salute</span><span class="params">()</span></span> = println(<span class="string">&quot;Salute!&quot;</span>)</span><br><span class="line">&gt;&gt;&gt; run(::salute)</span><br><span class="line">Salute!</span><br></pre></td></tr></table></figure>
<p>æˆå‘˜å¼•ç”¨çš„å†™æ³•æ¯”lambdaçš„å†™æ³•æ›´åŠ ä¾¿æ·ï¼Œå› ä¸ºå®ƒä¸éœ€è¦ä¼ é€’å‚æ•°ï¼š</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> action = &#123;person: Person, message: String -&gt; sendEmail(person, message)&#125;  <span class="comment">// This lambda delegates to a sendEmail function.</span></span><br><span class="line"><span class="keyword">val</span> nextAction = ::sendEmail  <span class="comment">// You can use a member reference instead.</span></span><br></pre></td></tr></table></figure>
<p>ä½ å¯ä»¥æ¨è¿Ÿè¿™ç§è®¿é—®ç”¨ä½œæ„é€ å™¨å¼•ç”¨ï¼š</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">Person</span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> age: <span class="built_in">Int</span>)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; <span class="keyword">val</span> createPerson = ::Person  <span class="comment">// An action of creating an instance of &quot;Person&quot; is saved as a value.</span></span><br><span class="line">&gt;&gt;&gt; <span class="keyword">val</span> p = createPerson(<span class="string">&quot;Alice&quot;</span>, <span class="number">29</span>)</span><br><span class="line">&gt;&gt;&gt; println(p)</span><br><span class="line">Person(name=Alice, age=<span class="number">29</span>)</span><br></pre></td></tr></table></figure>
<p>ç±»ä¼¼åœ°ï¼Œä¹Ÿå¯ä»¥ç”¨äºæ‰©å±•å‡½æ•°ï¼š</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> Person.<span class="title">isAdult</span><span class="params">()</span></span> = age &gt;= <span class="number">21</span></span><br><span class="line"><span class="keyword">val</span> predicate = Person::isAdult</span><br></pre></td></tr></table></figure>
<h2 id="Functional-APIs-for-collections"><a class="header-anchor" href="#Functional-APIs-for-collections">Â¶</a>Functional APIs for collections</h2>
<p>ç°ä»£è¯­è¨€é›†åˆçš„æ‰€æœ‰APIåŸºæœ¬ä¸Šéƒ½æ˜¯é€šç”¨çš„ï¼Œå› ä¸ºæ•°æ®ç»“æ„ä¸ä¼šç›¸å·®å¤ªå¤§ã€‚</p>
<h3 id="Essentials-filter-and-map"><a class="header-anchor" href="#Essentials-filter-and-map">Â¶</a>Essentials: filter and map</h3>
<p><code>filter</code>å’Œ <code>map</code> ä½œä¸ºé›†åˆå¸¸è§çš„å‡½æ•°apiã€‚</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">Person</span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> age: <span class="built_in">Int</span>)</span><br></pre></td></tr></table></figure>
<p><code>filter</code>å‡½æ•°è¿‡æ»¤å¶æ•°ï¼š</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="keyword">val</span> list = listOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">&gt;&gt;&gt; println(list.filter &#123; it % <span class="number">2</span> == <span class="number">0</span> &#125;)  <span class="comment">// Only even numbers remain.</span></span><br><span class="line">[<span class="number">2</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<p>è¿‡æ»¤è¶…è¿‡30å²çš„äººï¼Œ</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="keyword">val</span> people = listOf(Person(<span class="string">&quot;Alice&quot;</span>, <span class="number">29</span>), Person(<span class="string">&quot;Bob&quot;</span>, <span class="number">31</span>))</span><br><span class="line">&gt;&gt;&gt; println(people.filter &#123; it.age &gt; <span class="number">30</span> &#125;)</span><br><span class="line">[Person(name=Bob, age=<span class="number">31</span>)]</span><br></pre></td></tr></table></figure>
<p><code>map</code>çš„ä½œç”¨ç›¸å½“äºtransformerï¼Œè­¬å¦‚ï¼š</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="keyword">val</span> list = listOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">&gt;&gt;&gt; println(list.map &#123; it * it &#125;)</span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>]</span><br></pre></td></tr></table></figure>
<p>è½¬æ¢ç±»å‹</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; people = listOf(Person(<span class="string">&quot;Alice&quot;</span>, <span class="number">29</span>), Person(<span class="string">&quot;Bob&quot;</span>, <span class="number">31</span>))</span><br><span class="line">&gt;&gt;&gt; println(people.map &#123; it.name &#125;)</span><br><span class="line">[Alice, Bob]</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥æ›¿æ¢ä¸ºæˆå‘˜å¼•ç”¨çš„å†™æ³•æ›´åŠ ç®€æ´ï¼š</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">people.map(Person::name)</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥é“¾å¼è°ƒç”¨ï¼Œ</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; people.filter &#123; it.age &gt; <span class="number">30</span> &#125;.map(Person::name)</span><br><span class="line">[Bob]</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…ç»„åˆlambdaå’Œæˆå‘˜å¼•ç”¨ï¼Œ</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">people.filter &#123; it.age == people.maxBy[Person::age).age &#125;</span><br></pre></td></tr></table></figure>
<p>æ”¹è¿›å†™æ³•ï¼Œä»…è®¡ç®—ä¸€æ¬¡ï¼Œ</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> maxAge = people.maxBy(Person::age).age</span><br><span class="line">people.filter &#123; it.age == maxAge &#125;</span><br></pre></td></tr></table></figure>
<h3 id="â€œAllâ€-â€œAnyâ€-â€œcountâ€-and-â€œfindâ€-applying-a-predicate-to-a-collection"><a class="header-anchor" href="#â€œAllâ€-â€œAnyâ€-â€œcountâ€-and-â€œfindâ€-applying-a-predicate-to-a-collection">Â¶</a>â€œAllâ€, â€œAnyâ€, â€œcountâ€, and â€œfindâ€: applying a predicate to a collection</h3>
<p>å®ç°ä¸Šå’ŒJava 8 çš„predicateæ— å·®åˆ«ï¼Œ</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="keyword">val</span> canBeInClub27 = &#123; p: Person -&gt; p.age &lt;= <span class="number">27</span> &#125;</span><br><span class="line">&gt;&gt;&gt; <span class="keyword">val</span> people = listOf(Person(<span class="string">&quot;Alice&quot;</span>, <span class="number">27</span>), Person(<span class="string">&quot;Bob&quot;</span>, <span class="number">31</span>))</span><br><span class="line">&gt;&gt;&gt; println(people.all(canBeInClub27))</span><br><span class="line"><span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœä»…æ£€æµ‹è‡³å°‘ä¸€ä¸ªåŒ¹é…ï¼Œä½¿ç”¨<code>any</code>ï¼Œ</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; println(people.any(canBeInClub27))</span><br><span class="line"><span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p><code>!all</code>çš„é€†å‘½é¢˜å°±æ˜¯<code>any</code>ï¼Œæ‰€ä»¥ä¸‹é¢çš„å†™æ³•æ˜¯ç­‰ä»·çš„ï¼Œ</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="keyword">val</span> list = listOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">&gt;&gt;&gt; println(!list.all &#123; it == <span class="number">3</span> &#125;)  <span class="comment">// The negation ! isn&#x27;t noticeable, so it&#x27;s better to use &quot;any&quot; in this case.</span></span><br><span class="line"><span class="literal">true</span></span><br><span class="line">&gt;&gt;&gt; println(list.any &#123; it != <span class="number">3</span> &#125;)  <span class="comment">// The condition in the argument has changed to its opposite.</span></span><br><span class="line"><span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p><code>count</code>ç»Ÿè®¡æ»¡è¶³çš„predicateï¼Œ</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="keyword">val</span> people = listOf(Person(<span class="string">&quot;Alice&quot;</span>, <span class="number">27</span>), Person(<span class="string">&quot;Bob&quot;</span>, <span class="number">31</span>))</span><br><span class="line">&gt;&gt;&gt; println(people.count(canBeInClub27))</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>
<h3 id="GroupBy-converting-a-list-to-a-map-of-groups"><a class="header-anchor" href="#GroupBy-converting-a-list-to-a-map-of-groups">Â¶</a>GroupBy: converting a list to a map of groups</h3>
<p><code>groupBy</code>åœ¨ç»Ÿè®¡è®¡ç®—çš„åœºæ™¯è¢«ç»å¸¸ç”¨åˆ°ï¼Œé¡¾åæ€ä¹‰â€œåˆ†ç»„â€ï¼Œ</p>
<p>æŒ‰å¹´é¾„åˆ†ç»„ï¼Œ</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="keyword">val</span> people = listOf(Person(<span class="string">&quot;Alice&quot;</span>, <span class="number">31</span>), Person(<span class="string">&quot;Bob&quot;</span>, <span class="number">29</span>), Person(<span class="string">&quot;Carol&quot;</span>, <span class="number">31</span>))</span><br><span class="line">&gt;&gt;&gt; println(people.groupBy &#123; it.age &#125;)</span><br></pre></td></tr></table></figure>
<p>å’ŒJavaä¸€æ ·ï¼Œåˆ†ç»„åæ”¾åœ¨ä¸€ä¸ª<code>Map&lt;Int, List&lt;Person&gt;&gt;</code>é‡Œé¢ã€‚</p>
<h3 id="flatMap-and-flattern-processing-elements-in-nested-collections"><a class="header-anchor" href="#flatMap-and-flattern-processing-elements-in-nested-collections">Â¶</a>flatMap and flattern: processing elements in nested collections</h3>
<p><code>flatMap</code>çš„æ­¥éª¤åˆ†ä¸ºä¸¤æ­¥ï¼Œå³<code>flatten</code>+<code>map</code>ã€‚é¦–å…ˆå°†æ‰€æœ‰å…ƒç´ è¿›è¡Œè½¬æ¢(<code>map</code>)ï¼Œç„¶ååœ¨ç»„åˆ(<code>flattern</code>)ä¸ºä¸€ä¸ªã€‚å®ƒå±äºé›†åˆå†…åµŒæ“ä½œã€‚</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">Book</span>(<span class="keyword">val</span> title: String, <span class="keyword">val</span> authors: List&lt;String&gt;)</span><br></pre></td></tr></table></figure>
<p>è®¡ç®—é›†åˆï¼Œ</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">books.flatMap &#123; it.authors &#125;.toSet()  <span class="comment">// Set of all authors who wrote books in the &quot;books&quot; collection</span></span><br></pre></td></tr></table></figure>
<h2 id="Lazy-collectino-operations-sequences"><a class="header-anchor" href="#Lazy-collectino-operations-sequences">Â¶</a>Lazy collectino operations: sequences</h2>
<p>ç±»ä¼¼äº<code>map</code>å’Œ<code>filter</code>è¿™ä¸€ç±»å‡½æ•°æ‰§è¡Œåç«‹å³è®¡ç®—çš„ç§°ä¸º<code>eagerly</code>ã€‚ç›¸å¯¹äºçš„ç±»ä¼¼äº<code>sequences</code>æä¾›äº†æƒ°æ€§æ±‚å€¼çš„å¯èƒ½ã€‚</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">people.asSequence().map(Person::name).filter &#123; it.startsWith(<span class="string">&quot;A&quot;</span>) &#125;.toList()</span><br></pre></td></tr></table></figure>
<p><code>Sequence</code>åœ¨Kotlin ä¸­ä½œä¸ºæ¥å£ï¼Œæä¾›äº†ä¸°å¯Œçš„apiå’Œè¯­æ³•ç³–ã€‚</p>
<h3 id="Executing-sequence-operations-intermediate-and-terminal-operations"><a class="header-anchor" href="#Executing-sequence-operations-intermediate-and-terminal-operations">Â¶</a>Executing sequence operations: intermediate and terminal operations</h3>
<p>æ“ä½œä¸€ä¸ªsequenceè¢«åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li><code>intermediate operation</code>ï¼Œè¿”å›å¦å¤–ä¸€ä¸ªsequenceå®ä¾‹ï¼Œ</li>
<li><code>terminal operation</code>ï¼Œè¿”å›çœŸå®çš„ç»“æ„ã€‚</li>
</ul>
<p><img src="/img/kotlin-in-action/chapter05/Figure_05_07.png" alt="Figure 5.7"></p>
<p>intermediate operationæ€»æ˜¯lazyçš„ï¼Œè­¬å¦‚ï¼Œ</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; listOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>).asSequence().map &#123; print(<span class="string">&quot;map&#123;<span class="variable">$it</span>) &quot;</span>); it * it &#125;.filter &#123; print(<span class="string">&quot;filter(<span class="variable">$it</span>) &quot;</span>); it % <span class="number">2</span> == <span class="number">0</span> &#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè¯¥ä»£ç ç‰‡æ®µä¸ä¼šåœ¨æ§åˆ¶å°æ‰“å°ä»»ä½•ç»“æœã€‚æ„å‘³ç€<code>map</code>å’Œ<code>filter</code>è¢«å»¶è¿Ÿæ‰§è¡Œ(ä»…å½“terminal operationè¢«è°ƒç”¨æ‰æ‰§è¡Œ)ï¼š</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; listOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>).asSequence().map &#123; print(<span class="string">&quot;map&#123;<span class="variable">$it</span>) &quot;</span>); it * it &#125;.filter &#123; print(<span class="string">&quot;filter(<span class="variable">$it</span>) &quot;</span>); it % <span class="number">2</span> == <span class="number">0</span> &#125;.toList()</span><br><span class="line">map(<span class="number">1</span>) filter(<span class="number">1</span>) map(<span class="number">2</span>) filter(<span class="number">4</span>) map(<span class="number">3</span>) filter(<span class="number">9</span>) map(<span class="number">4</span>) filter(<span class="number">16</span>)</span><br></pre></td></tr></table></figure>
<p>eager(collection) å’Œ lazy(sequences) çš„åŒºåˆ«åœ¨äºï¼ŒæŸäº›è®¡ç®—åœ¨sequenceä¸ä¼šè¢«æ‰§è¡Œï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/img/kotlin-in-action/chapter05/Figure_05_08.png" alt="Figure 5.8"></p>
<p>åœ¨ç¬¬ä¸€ç§caseï¼Œé›†åˆä¸­çš„listä¼šè¢«è½¬æ¢ä¸ºå¦å¤–ä¸€ä¸ªlistï¼Œå› æ­¤<code>map</code>ä¼šä½œç”¨äºæ¯ä¸€ä¸ªå…ƒç´ ï¼ŒåŒ…æ‹¬3å’Œ4ã€‚ä¹‹åï¼Œåœ¨è®¡ç®—å¾—åˆ°4ã€‚</p>
<p>åœ¨ç¬¬äºŒç§caseï¼Œ<code>find</code>çš„å¯¹åŸå§‹å…ƒç´ ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°å¤„ç†ã€‚å¯¹äºåŸæ¥çš„é›†åˆå…ƒç´ ï¼Œä¼šæ‰§è¡Œ<code>map</code>è½¬æ¢ï¼Œå†æ‰§è¡Œ<code>find</code>æ“ä½œã€‚æ‰€ä»¥ï¼Œå½“è¾¾åˆ°2æ—¶ï¼Œæ»¡è¶³æ¡ä»¶ï¼Œè¿”å›ç»“æœï¼Œä¸å¿…å…³ç³»åé¢çš„3ã€4ã€5â€¦ã€‚</p>
<p>è¿™ç§å¯¹å…ƒç´ çš„å¤„ç†é¡ºåºæ“ä½œå¯¹äºæ€§èƒ½æ˜¯æœ‰æ˜æ˜¾å½±å“çš„ã€‚è­¬å¦‚ä¸€ä¸‹ä»£ç ï¼Œ</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="keyword">val</span> people = listOf(Person(<span class="string">&quot;Alice&quot;</span>, <span class="number">29</span>), Person(<span class="string">&quot;Bob&quot;</span>, <span class="number">31</span>), Person(<span class="string">&quot;Charles&quot;</span>, <span class="number">31</span>), Person(<span class="string">&quot;Dan&quot;</span>, <span class="number">21</span>))</span><br><span class="line">&gt;&gt;&gt; println(people.asSequence().map(Person::name).filter &#123; it.length &lt; <span class="number">4</span> &#125;.toList())  <span class="comment">// &quot;map&quot; goes first, then &quot;filter&quot;.</span></span><br><span class="line"></span><br><span class="line">[Bob, Dan]</span><br><span class="line">&gt;&gt;&gt; println(people.asSequence().filter &#123; it.name.length &lt; <span class="number">4</span> &#125;.map(Person::name).toList() <span class="comment">// &quot;map&quot; goes after &quot;filter&quot;.</span></span><br><span class="line"></span><br><span class="line">[Bob, Dan]</span><br></pre></td></tr></table></figure>
<p><img src="/img/kotlin-in-action/chapter05/Figure_05_09.png" alt="Figure 5.9"></p>
<p>å¦‚æœ<code>map</code>å…ˆè¡Œï¼Œæ¯ä¸ªå…ƒç´ éƒ½è¢«è½¬æ¢(transform)äº†ã€‚å¦‚æœ<code>filter</code>å…ˆè¡Œï¼Œä¸æ°å½“çš„å…ƒç´ è¢«å°½å¯èƒ½åœ°filteræ‰ä»¥å‡å°‘è½¬æ¢ã€‚</p>
<h3 id="Creating-sequences"><a class="header-anchor" href="#Creating-sequences">Â¶</a>Creating sequences</h3>
<p>å¤„ç†åœ¨é›†åˆä¸Šä½¿ç”¨<code>asSequence()</code>åˆ›å»ºä¸€ä¸ªsequenceï¼Œè¿˜å¯ä»¥é€šè¿‡<code>generateSequence()</code>å‡½æ•°æ¥åˆ›å»ºã€‚ä¾‹å¦‚ï¼Œ</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="keyword">val</span> naturalNumbers = generateSequence(<span class="number">0</span>) &#123; it + <span class="number">1</span> &#125;</span><br><span class="line">&gt;&gt;&gt; <span class="keyword">val</span> numbersTo100 = naturalNumbers.takeWhile &#123; it &lt;= <span class="number">100</span> &#125;</span><br><span class="line">&gt;&gt;&gt; println(numbersTo100.sum())  <span class="comment">// All the delayed operations are performed when the result &quot;sum&quot; is obtained.</span></span><br><span class="line"><span class="number">5050</span></span><br></pre></td></tr></table></figure>
<h2 id="Using-Java-functional-interfaces"><a class="header-anchor" href="#Using-Java-functional-interfaces">Â¶</a>Using Java functional interfaces</h2>
<p>Kotlinè°ƒç”¨Javaçš„æ¥å£å‡½æ•°æ¯”è¾ƒç®€å•ï¼Œå‡è®¾æœ‰Javaæ¥å£å¦‚ä¸‹ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOnClickListner</span><span class="params">(OnClickListener l)</span> &#123;... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>functional interfaceå£°æ˜å¦‚ä¸‹ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OnClickListener</span> &#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨kotlinä¸­ç›´æ¥ä½¿ç”¨lambdaè¡¨è¾¾å¼ï¼Œ</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">button.setOnClickListener &#123; view -&gt; ... &#125;</span><br></pre></td></tr></table></figure>
<p><img src="/img/kotlin-in-action/chapter05/Figure_05_10.png" alt="Figure 5.10"></p>
<p>ä¹‹æ‰€ä»¥ç”Ÿæ•ˆæ˜¯å› ä¸ºï¼Œæ¥å£<code>OnClickListner</code>ä»…åŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ã€‚è¿™ç§æ¥å£è¢«ç§°ä¸º <em><code>functional interfaces</code></em> æˆ– SAM <em><code>interfaces</code></em> ï¼ŒSAMå°±æ˜¯ <em>single abstract method</em> çš„ç¼©å†™ã€‚Javaçš„æ ‡å‡†APIåŒ…å«å¤§é‡çš„è¿™ç±»æ¥å£ï¼Œè­¬å¦‚å¸¸è§çš„<code>Runnable</code>å’Œ<code>Callable</code>ã€‚</p>
<h3 id="Passing-a-lambda-as-a-parameter-to-a-Java-method"><a class="header-anchor" href="#Passing-a-lambda-as-a-parameter-to-a-Java-method">Â¶</a>Passing a lambda as a parameter to a Java method</h3>
<p>å¯¹äºJavaä¸­åŒ…å«æœ‰functional interfaceçš„æ–¹æ³•å‚æ•°å¯ä»¥ç›´æ¥ä¼ é€’lambdaè¡¨è¾¾å¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">postponeComputation</span><span class="params">(<span class="type">int</span> delay, Runnable computation)</span>;</span><br></pre></td></tr></table></figure>
<p>kotlinä¸­çš„ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ ¹æ®è¡¨è¾¾å¼è¿›è¡Œè½¬æ¢ï¼Œ</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">postponeComputation(<span class="number">1_000</span>) &#123; println(<span class="number">42</span>) &#125;</span><br></pre></td></tr></table></figure>
<p>å®ƒç­‰æ•ˆäºä¸‹é¢çš„å†™æ³•ï¼Œ</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">postponeComputation(<span class="number">1_000</span>, <span class="keyword">object</span> : Runnable &#123;  <span class="comment">// Passes an object expression as an implementation of a functional interface</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">	  println(<span class="number">42</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸åŒçš„æ˜¯ï¼Œå¦‚æœç°å®å£°æ˜ä¸€ä¸ªå¯¹è±¡è¡¨è¾¾å¼ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚å¦‚æœä½¿ç”¨lambdaï¼Œå¹¶ä¸”ä¸æ˜¯é—­åŒ…çš„æƒ…å†µä¸‹ï¼Œå¯¹åº”çš„åŒ¿åå®ä¾‹ä¼šè¢«é‡ç”¨ï¼š</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">postponeComputation(<span class="number">1_000</span>) &#123; println(<span class="number">42</span>) &#125;  <span class="comment">// One instance of Runnable is created for the entire program.</span></span><br></pre></td></tr></table></figure>
<p>å› æ­¤ï¼Œç­‰ä»·çš„å†™æ³•åº”è¯¥å†™ä¸ºï¼Œ</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> runnable = Runnable &#123; println(<span class="number">42</span>) &#125;  <span class="comment">// Compiled to a global variable; only one instance in the program</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">handleComputation</span><span class="params">()</span></span> &#123;</span><br><span class="line">  postponeComputation(<span class="number">1_000</span>, runnable)  <span class="comment">// One object is used for every handleComputation call.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œå¦‚æœå°†lambdaè¡¨è¾¾å¼ä¼ é€’ç»™ä¸€ä¸ªå¸¦æœ‰<code>inline</code>æ ‡è®°çš„å‡½æ•°ï¼Œåˆ™ä¸ä¼šæœ‰åŒ¿åç±»çš„åˆ›å»ºã€‚</p>
<h3 id="SAM-constructors-explicit-conversion-of-lambdas-to-functional-interfaces"><a class="header-anchor" href="#SAM-constructors-explicit-conversion-of-lambdas-to-functional-interfaces">Â¶</a>SAM constructors: explicit conversion of lambdas to functional interfaces</h3>
<p>SAM constructorså…¶å®å°±æ˜¯functional interface!!!</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">createAllDoneRunnable</span><span class="params">()</span></span>: Runnable &#123;</span><br><span class="line">  <span class="keyword">return</span> Runnable &#123; println(<span class="string">&quot;All done!&quot;</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; createAllDoneRunnable().run()</span><br><span class="line">All done!</span><br></pre></td></tr></table></figure>
<p>ç‚’æ¦‚å¿µï¼Œä¸ä½œä»‹ç»ï¼ï¼</p>
<h2 id="Lambdas-with-receivers-â€œwithâ€-and-â€œapplyâ€"><a class="header-anchor" href="#Lambdas-with-receivers-â€œwithâ€-and-â€œapplyâ€">Â¶</a>Lambdas with receivers: â€œwithâ€ and â€œapplyâ€</h2>
<p>kotlin çš„lambdaè¡¨è¾¾å¼ä¸åŒäºJavaï¼Œå¯ä»¥å¸¦receiversã€‚</p>
<h3 id="The-â€œwithâ€-function"><a class="header-anchor" href="#The-â€œwithâ€-function">Â¶</a>The â€œwithâ€ function</h3>
<p><code>with</code>ä¸ºinlineå‡½æ•°ï¼Œåé¢è·Ÿç€çš„receiverç›¸å½“äºè‡ªç”±å˜é‡ï¼Œ</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">alphabet</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">  <span class="keyword">val</span> result = StringBuilder()</span><br><span class="line">  <span class="keyword">for</span> (letter <span class="keyword">in</span> <span class="string">&#x27;A&#x27;</span>..<span class="string">&#x27;Z&#x27;</span>) &#123;</span><br><span class="line">    result.append(letter)</span><br><span class="line">  &#125;</span><br><span class="line">  result.append(<span class="string">&quot;\nNow I know the alphebet!&quot;</span>)</span><br><span class="line">  <span class="keyword">return</span> result.toString()</span><br><span class="line">&#125;</span><br><span class="line">&gt;&gt;&gt; println(alphabet())</span><br><span class="line">ABCDEFGHIJKLMNOPQRSTUVWXYZ</span><br><span class="line">Now I know the alphabet!</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>result</code>è¢«é‡å¤è°ƒç”¨äº†å¾ˆå¤šæ¬¡ã€‚å¯ä»¥ç”¨<code>with</code>é‡å†™ä¸ºï¼Œ</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">alphabet</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">  <span class="keyword">val</span> stringBuilder = StringBuilder()</span><br><span class="line">  <span class="keyword">return</span> with(stringBuilder) &#123;  <span class="comment">// Specifies the receiver value on which you&#x27;re calling the methods</span></span><br><span class="line">    <span class="keyword">for</span> (letter <span class="keyword">in</span> <span class="string">&#x27;A&#x27;</span>..<span class="string">&#x27;Z&#x27;</span>) &#123;</span><br><span class="line">	  <span class="keyword">this</span>.append(letter)  <span class="comment">// Calls a method on the receiver value though an explicit &quot;this&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">	append(<span class="string">&quot;\nNow I know the alphabet!&quot;</span>)  <span class="comment">// Calls a method ommiting &quot;this&quot;</span></span><br><span class="line">	<span class="keyword">this</span>.toString()  <span class="comment">// Returns a value from the lambda</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>with</code>çš„åº•å±‚å®é™…ä¸ºinlineå‡½æ•°ï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š<code>stringBuilder</code>ã€å’Œä¸€ä¸ªlambdaã€‚é€»è¾‘ä¸Šæ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œä»…ä»…ä¸ºäº†æé«˜å¯è¯»æ€§ã€‚ç”šè‡³å¯ä»¥æ›´åŠ ç®€æ´ï¼Œ</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">alphabet</span><span class="params">()</span></span> = with(StringBuilder()) &#123;</span><br><span class="line">  <span class="keyword">for</span> (letter <span class="keyword">in</span> <span class="string">&#x27;A&#x27;</span>..<span class="string">&#x27;Z&#x27;</span>) &#123;</span><br><span class="line">    append(letter)</span><br><span class="line">  &#125;</span><br><span class="line">  append(<span class="string">&quot;\nNow I know the alphabet!&quot;</span>)</span><br><span class="line">  toString()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="The-â€œapplyâ€-function"><a class="header-anchor" href="#The-â€œapplyâ€-function">Â¶</a>The â€œapplyâ€ function</h3>
<p><code>apply</code>å‡½æ•°å’Œ<code>with</code>çš„ç”¨æ³•ç±»ä¼¼ï¼›ä¸åŒåœ¨äºï¼Œ<code>apply</code>æ€»æ˜¯è¿”å›ä¼ é€’è¿›æ¥çš„å‚æ•°å¯¹è±¡ã€‚æˆ‘ä»¬ä½¿ç”¨<code>apply</code>é‡æ„ä¸Šè¿°ä»£ç ï¼Œ</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">alphabet</span><span class="params">()</span></span> = StringBuilder().apply (</span><br><span class="line">  <span class="keyword">for</span> (letter <span class="keyword">in</span> <span class="string">&#x27;A&#x27;</span>..<span class="string">&#x27;Z&#x27;</span>) &#123;</span><br><span class="line">    append(letter)</span><br><span class="line">  &#125;</span><br><span class="line">  append(<span class="string">&quot;\nNow I know the alphabet!&quot;</span>)</span><br><span class="line">&#125;.toString()</span><br></pre></td></tr></table></figure>
<p><code>apply</code>æœ€å¸¸ç”¨åˆ°çš„åœ°æ–¹å°±æ˜¯åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œå¹¶åˆå§‹åŒ–æŸäº›å±æ€§ã€‚è­¬å¦‚ï¼Œ</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">createViewWithCustomAttributes</span><span class="params">(context: <span class="type">Context</span>)</span></span> =</span><br><span class="line">  TextView(context).apply &#123;</span><br><span class="line">    text = <span class="string">&quot;Sample Text&quot;</span></span><br><span class="line">	textSize = <span class="number">20.0</span></span><br><span class="line">	setPadding(<span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p><code>apply</code>ä¼ å…¥çš„lambdaè¡¨è¾¾å¼è¢«æ‰§è¡Œåå°†è¿”å›åˆå§‹åŒ–åçš„å®ä¾‹ã€‚å¦å¤–ï¼Œkotlinæä¾›äº†æ›´ç®€æ´çš„inlineå‡½æ•°ï¼Œ</p>
<figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">alphabet</span><span class="params">()</span></span>: String = buildString &#123;</span><br><span class="line">  <span class="keyword">for</span> (letter <span class="keyword">in</span> <span class="string">&#x27;A&#x27;</span>..<span class="string">&#x27;Z&#x27;</span>) &#123;</span><br><span class="line">    append(letter)</span><br><span class="line">  &#125;</span><br><span class="line">  append(<span class="string">&quot;\nNow I know the alphabet!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Summary"><a class="header-anchor" href="#Summary">Â¶</a>Summary</h2>
<ul>
<li>lambdaå¯ä»¥å°†ä»£ç å—ä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°ã€‚</li>
<li>kotlinå¯ä»¥ä¼ é€’æ— æ‹¬å·çš„lambdaï¼Œå¹¶ç”¨<code>it</code>ä½œä¸ºå¼•ç”¨ã€‚</li>
<li>ä½œä¸ºé—­åŒ…æ—¶ï¼Œlambdaè¡¨è¾¾å¼å¯ä»¥è®¿é—®å’Œä¿®æ”¹å¤–éƒ¨å˜é‡ã€‚</li>
<li>member referenceè¯­æ³•ä½¿ç”¨<code>::</code>è¡¨ç¤ºï¼Œå¯ä»¥å¼•ç”¨æ–¹æ³•ã€æ„é€ å‡½æ•°ã€å±æ€§ã€‚</li>
<li>é›†åˆæä¾›äº†ä¸°å¯Œçš„functional apiï¼Œè­¬å¦‚<code>filter</code>ã€<code>map</code>ã€<code>all</code>ã€<code>any</code>ç­‰ã€‚</li>
<li>Sequences è¡¨ç¤ºé›†åˆçš„æ“ä½œä½œä¸ºä¸­é—´æ“ä½œéƒ¨åˆ†ï¼Œåœ¨çœŸæ­£è°ƒç”¨çš„åœ°æ–¹æŒ‰é¡ºåºæ‰§è¡Œã€‚</li>
<li>functional interfaceå’ŒSAM interfaceä½œä¸ºå‚æ•°çš„ç”¨æ³•ã€‚</li>
<li>lambdaå¸¦æœ‰receiversçš„ç”¨æ³•å†™åœ¨äº†kotlinçš„æ ‡å‡†inline functionä¸­ä½¿ç”¨ã€‚</li>
<li><code>with</code>æ ‡å‡†åº“å‡½æ•°å…è®¸æ–¹æ³•å¯ä»¥å¤šæ¬¡é‡å¤è°ƒç”¨åŒä¸€ä¸ªå®ä¾‹ï¼›<code>apply</code>å¯ä»¥è®©ä½ åˆ›å»ºå®ä¾‹çš„åŒæ—¶å¹¶åˆå§‹åŒ–æˆå‘˜å±æ€§ã€‚</li>
</ul>
</div></article><nav class="article-nav"><div class="article-nav-prev">ğŸ”™<a href="/2021/12/10/kotlin/05_the_kotlin_type_system/">Kotlin çš„ç±»å‹ç³»ç»Ÿ</a></div><div class="article-nav-next">ğŸ”œ<a href="/2021/12/01/concurrency/fibers-beyond-coroutine/">Fibers beyond coroutine beyond goroutine</a></div></nav><div id="base-discus"><div id="disqus_thread"></div><script>var disqus_shortname = 'barudisshu-github-io';
var disqus_identifier = '2021/12/09/kotlin/04_programming_with_lambdas/';
var disqus_title = 'lambdasç¼–ç¨‹';
var disqus_url = 'https://galudisu.info/2021/12/09/kotlin/04_programming_with_lambdas/';
(function () {
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async>  </script></div></div></div><footer class="base-footer"><div class="footer-wrapper"><span>Â©2016 - 2025 <a href="https://galudisu.info">barudisshu</a>, unless otherwise noted.</span></div></footer><div class="dom-ready">
<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>

<link rel="stylesheet" href="//cdn.bootcss.com/pace/1.0.2/themes/green/pace-theme-flash.min.css">

<script src="/js/base.js"></script>

<script src="/js/rabbit-lyrics.js"></script>
</div></body></html>