<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><title>Cassandra å®‰è£…å…¥é—¨</title>
<link rel="stylesheet" href="/css/layout.css">
<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="/css/vendors/rabbit-lyrics.css">
<link rel="shortcut icon" href="/img/favicon.ico"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ç®€å•æ˜“æ‡‚ã®ç°ä»£é­”æ³•" type="application/atom+xml">
</head><body><header class="base-menu"><div class="menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">ç®€å•æ˜“æ‡‚ã®ç°ä»£é­”æ³•</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav></div></header><header class="base-mobile-menu"><div class="mobile-menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">ç®€å•æ˜“æ‡‚ã®ç°ä»£é­”æ³•</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav><div class="toggle-menu" id="mobile-menu-toggle"><span class="menu-bar"></span><span class="menu-bar"> </span><span class="menu-bar"></span></div></div></header><div class="base-content"><div class="base-content-main"><article class="article-main"><h1 class="article-title">Cassandra å®‰è£…å…¥é—¨</h1><div class="article-meta"><p class="meta-item meta-time"><span class="meta-item-title"></span><i class="icon-calendar"> </i>2018-01-10</p><p class="meta-item meta-tag"><span class="meta-item-title"></span><i class="icon-tag"> </i><a class="tag-link" href="/tags/cassandra/">cassandra</a></p></div><div class="article-content"><p>Cassandraæ˜¯Apacheå¼€æºçš„åˆ†å¸ƒå¼æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œè¢«ç”¨äºå¤„ç†å¤§æ•°æ®é‡çš„å•†ç”¨ç¡¬ä»¶æˆ–äº‘è®¾æ–½ä¸Šã€‚Cassandraæä¾›äº†é«˜å¯ç”¨ï¼Œæ— å•ç‚¹æ•…éšœçš„ç‰¹æ€§ã€‚</p>
<p>Cassandraæ”¯æŒä¸åœæœºçš„çº¿æ€§æ‰©å±•æœºå™¨çš„æ–¹å¼ï¼Œå¢åŠ Readå’ŒWriteçš„ååé‡ã€‚</p>
<p>æ¯ä¸ªCassandraèŠ‚ç‚¹åœ¨é›†ç¾¤ä¸­ä¼šæœ‰ç›¸åŒçš„è§’è‰²ã€‚æ•°æ®è¢«åˆ†å¸ƒåœ¨å„ä¸ªé›†ç¾¤èŠ‚ç‚¹ä¸Šã€‚Cassandraæ”¯æŒå¤åˆ¶å’Œå¤šæ•°æ®ä¸­å¿ƒå†—ä½™å¤åˆ¶ï¼Œæ•…éšœè½¬ç§»ï¼Œç¾éš¾æ¢å¤ã€‚</p>
<span id="more"></span>
<h2 id="å•èŠ‚ç‚¹"><a class="header-anchor" href="#å•èŠ‚ç‚¹">Â¶</a>å•èŠ‚ç‚¹</h2>
<p>Apache Cassandraè¦æ±‚ç³»ç»Ÿé¢„å…ˆå®‰è£…Javaï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository -y ppa:webupd8team/java</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get -y install oracle-java8-installer</span><br></pre></td></tr></table></figure>
<p>éªŒè¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure>
<p>å®‰è£…æ—¶è¯·æ³¨æ„Javaç‰ˆæœ¬çš„å…¼å®¹æ€§é—®é¢˜ã€‚</p>
<p>Cassandraçš„å®‰è£…ï¼Œå®˜æ–¹æ¨èçš„æ˜¯åŒ…ç®¡ç†çš„æ–¹å¼ã€‚ä»¥debianä¸ºä¾‹ï¼š</p>
<p>æ·»åŠ ä»“å‚¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;deb http://www.apache.org/dist/cassandra/debian 36x main&quot; | sudo tee -a /etc/apt/sources.list.d/cassandra.list</span><br></pre></td></tr></table></figure>
<p>æ·»åŠ å…¬é’¥ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gpg --keyserver pgp.mit.edu --recv-keys 749D6EEC0353B12C</span><br><span class="line">gpg --export --armor 749D6EEC0353B12C | sudo apt-key add -</span><br></pre></td></tr></table></figure>
<p>å®‰è£…ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install cassandra</span><br></pre></td></tr></table></figure>
<p>è¦æ³¨æ„çš„æ˜¯ï¼Œå®‰è£…æ—¶æœ€å¥½é€‰æ‹©è¦†ç›–å®‰è£…ï¼Œå› ä¸ºæœ‰å¯èƒ½ä½ çš„<code>/etc/cassandra/</code>ä»¥å‰æ›¾ç»ä¿ç•™äº†é…ç½®ã€‚</p>
<p>å¦å¤–ä¸€ç§æ–¹å¼æ˜¯debåŒ…å®‰è£…ï¼Œæ¨èåˆ°<a target="_blank" rel="noopener" href="http://mirrors.ustc.edu.cn">ä¸­ç§‘å¤§</a>ä¸‹è½½å®‰è£…åŒ…ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.ustc.edu.cn/apache/cassandra/debian/pool/main/c/cassandra/cassandra_3.11.1_all.deb</span><br><span class="line">sudo dpkg --force-confmiss -i cassandra_3.11.1_all.deb</span><br></pre></td></tr></table></figure>
<p>å¸è½½ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get purge cassandra</span><br></pre></td></tr></table></figure>
<p>å®‰è£…å®Œæˆä¹‹åï¼ŒæœåŠ¡ä¼šæ·»åŠ åˆ°systemdã€‚æŸ¥çœ‹æœåŠ¡çš„è¿è¡Œæƒ…å†µï¼Œä¸€èˆ¬æ­£å¸¸çš„è¯éƒ½å¤„äºRunningçŠ¶æ€ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service cassandra status</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹ç«¯å£ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo netstat -plntu</span><br></pre></td></tr></table></figure>
<p>cassandraä¸»è¿›ç¨‹çš„å­è¿›ç¨‹ä¼šå¼€å¯å‡ ä¸ªç«¯å£ï¼š</p>
<p><img src="/img/cassandra/ports.png" alt="ç«¯å£å ç”¨æƒ…å†µ"></p>
<p>æ¯ä¸ªportä»£è¡¨ç€ä¸åŒçš„æ„ä¹‰ï¼š</p>
<ul>
<li>7000ï¼šnodeé—´çš„TCP port</li>
<li>7001ï¼šnodeé—´åˆ©ç”¨SSLä¼ è¾“èµ„æ–™çš„port</li>
<li>7199ï¼šJMX</li>
<li>9160ï¼š Clientç«¯Thrift APIç”¨åˆ°çš„port</li>
<li>9042: CQLä½¿ç”¨</li>
<li>1024-65355: JMXè¦æ±‚çš„éšæœºport</li>
</ul>
<p>cassandraè™½ç„¶èƒ½å¯åŠ¨ï¼Œä½†ä¸èƒ½é€šè¿‡é™æ€ipè®¿é—®ï¼Œåªèƒ½å†…éƒ¨è®¿é—®ã€‚æ‰“å¼€<code>/etc/cassandra/cassandra.yaml</code>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cluster_name: &#x27;JCPT Test Cluster&#x27;</span><br><span class="line">listen_address: localhost</span><br><span class="line">start_rpc: true</span><br><span class="line">rpc_address: 0.0.0.0</span><br><span class="line">boardcast_rpc_address: 192.168.2.248</span><br></pre></td></tr></table></figure>
<p>cassandraé›†ç¾¤å®‰è£…æˆåŠŸåï¼Œä½¿ç”¨nodetoolè¿æ¥æœ¬æœºèŠ‚ç‚¹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nodetool status</span><br></pre></td></tr></table></figure>
<p>å‡ºç°ä¸‹é¢å†…å®¹è¯´æ˜æ­£å¸¸ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Datacenter: datacenter1</span><br><span class="line">=======================</span><br><span class="line">Status=Up/Down</span><br><span class="line">|/ State=Normal/Leaving/Joining/Moving</span><br><span class="line">--  Address    Load       Tokens       Owns (effective)  Host ID                               Rack</span><br><span class="line">UN  127.0.0.1  256.6 KiB  256          100.0%            c703e51b-5050-403e-8430-019b768f7dc9  rack1</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼š</p>
<p><code>U</code> - Cluster is <code>U</code>P<br>
<code>N</code> = Cluster is <code>N</code>ormal</p>
<p>ç°åœ¨å¯ä»¥ä½¿ç”¨<code>cqlsh</code>è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢äº†ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cqlsh</span><br></pre></td></tr></table></figure>
<p>å‡ºç°æç¤ºè¯´æ˜cassandraçš„å•æœºèŠ‚ç‚¹éƒ¨ç½²æˆåŠŸäº†ï¼</p>
<h2 id="dockeræ­é…çš„å¤šèŠ‚ç‚¹"><a class="header-anchor" href="#dockeræ­é…çš„å¤šèŠ‚ç‚¹">Â¶</a>dockeræ­é…çš„å¤šèŠ‚ç‚¹</h2>
<p>æ¶è®¾ç¯å¢ƒï¼š3å°host(192.168.0.1, 192.168.0.2, 192.168.0.3)<br>
æƒ…å¢ƒï¼š3å°ç‹¬ç«‹VMï¼Œå„æ¶è®¾ä¸€ä¸ªcassandra nodeï¼Œç»„æˆcassandra clusterã€‚ç¬¬1ï¼Œ2å°hostçš„nodeè®¾ä¸ºseed</p>
<p>ä¸‹è½½cassandra image</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker pull cassandra</span><br></pre></td></tr></table></figure>
<p>åœ¨ç¬¬ä¸€å°VMä¸Šå»ºç«‹cassandraï¼ŒæŒ‡ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run --restart=always --name cassandra-1 -d -e CASSANDRA_BROADCAST_ADDRESS=192.168.0.1 -p 7000:7000 cassandra</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒå°hostä¸Šï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run --restart=always --name cassandra-2 -d -e CASSANDRA_BROADCAST_ADDRESS=192.168.0.2 -p 7000:7000 -e CASSANDRA_SEEDS=192.168.0.1,192.168.0.2 cassandra</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸‰å°hostï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run --restart=always --name cassandra-3 -d -e CASSANDRA_BROADCAST_ADDRESS=192.168.0.3 -p 7000:7000 -e CASSANDRA_SEEDS=192.168.0.1,192.168.0.2 cassandra</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•3ä¸ªhostæ˜¯å¦æ­£å¸¸ï¼š</p>
<p>æµ‹è¯•å‰§æœ¬ï¼šåœ¨<code>cassandra-1</code>å»ºç«‹ test_keyspaceï¼Œåœ¨ <code>cassandra-2</code>ä½¿ç”¨ test_keyspace å»ºç«‹ test_tableï¼Œæœ€ååœ¨ <code>cassandra-3</code> æŸ¥è¯¢ test_table</p>
<p>è¿›å…¥ cassandra-1ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker exec -it 3b39bc bash</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œ<code>cqlsh</code>ï¼Œå»ºç«‹keyspaceï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cqlsh &gt; CREATE KEYSPACE test_keyspace WITH REPLICATION = &#123;</span><br><span class="line">&#x27;class&#x27; : &#x27;SimpleStrategy&#x27;, </span><br><span class="line">&#x27;replication_factor&#x27; : 2 </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>è¿›å…¥ cassandra-2ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker exec -it fc04 bash</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cqlsh:test_keyspace&gt; CREATE TABLE test_table(</span><br><span class="line"> id int PRIMARY KEY,</span><br><span class="line"> name text</span><br><span class="line"> );</span><br></pre></td></tr></table></figure>
<p>è¿›å…¥ cassandra-3ï¼š</p>
<p>æ‰§è¡Œ<code>cqlsh</code>æŸ¥è¯¢ï¼Œ</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> cqlsh &gt; use test_keyspace;</span><br><span class="line">cqlsh:test_keyspace&gt; select * from test_table;</span><br></pre></td></tr></table></figure>
<p>ç›®å‰tableæ˜¯ç©ºçš„ï¼Œæˆ‘ä»¬åŠ ä¸€ç‚¹æ•°æ®ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cqlsh:test_keyspace&gt; insert into test_table (id, name) values (1, &#x27;Doraemon&#x27;);</span><br><span class="line">id | name</span><br><span class="line">----+----------</span><br><span class="line"> 1 | Doraemon</span><br><span class="line"></span><br><span class="line">(1 rows)</span><br></pre></td></tr></table></figure>
<p>å›åˆ° cassandra-1ï¼Œcassandra-2 æŸ¥è¯¢ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cqlsh:test_keyspace&gt; select * from test_table;</span><br><span class="line"></span><br><span class="line">id | name</span><br><span class="line">----+----------</span><br><span class="line"> 1 | Doraemon</span><br><span class="line"></span><br><span class="line">(1 rows)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœ3ä¸ªnodeæŸ¥è¯¢å¾—åˆ°ä¸€æ ·çš„æ•°æ®ï¼Œå°±ä»£è¡¨æˆåŠŸå•¦~</p>
<h2 id="äºŒè¿›åˆ¶éƒ¨ç½²"><a class="header-anchor" href="#äºŒè¿›åˆ¶éƒ¨ç½²">Â¶</a>äºŒè¿›åˆ¶éƒ¨ç½²</h2>
<p>é™¤äº†ä¸Šé¢ä»‹ç»çš„ä¸¤ç§å®‰è£…æ–¹å¼ï¼Œæœ¬äººæ¨èä»¥å‹ç¼©åŒ…æ–¹å¼éƒ¨ç½²ã€‚</p>
<ol>
<li>JDKå®‰è£…</li>
</ol>
<p>é¦–å…ˆç¡®ä¿ä½ çš„ç¯å¢ƒéœ€è¦æœ‰Javaï¼Œ<a target="_blank" rel="noopener" href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">ä¸‹è½½åœ°å€</a>ã€‚</p>
<p>è§£å‹æ”¾åˆ°/usr/java/jdk1.8.0_151/ç›®å½•ï¼Œ</p>
<ol start="2">
<li>æ·»åŠ ç”¨æˆ·</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">groupadd cassandra</span><br><span class="line">useradd -g cassandra cassandra</span><br><span class="line">passwd cassandra</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>ä¸‹è½½</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http://mirrors.shuosc.org/apache/cassandra/3.11.1/apache-cassandra-3.11.1-bin.tar.gz</span><br><span class="line">tar -xvf apache-cassandra-3.11.1-bin.tar.gz</span><br><span class="line">cd apache-cassandra-3.11.1</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>é…ç½®<code>vim conf/cassandra.yaml</code></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cluster_name: &#x27;JCPT Test Cluster&#x27;</span><br><span class="line">- seeds: &quot;10.112.68.186,10.112.68.192&quot;</span><br><span class="line">listen_address: 10.112.68.186</span><br><span class="line">rpc_address: 10.112.68.186</span><br></pre></td></tr></table></figure>
<p>ä¸åŒèŠ‚ç‚¹listen_addressã€rpc_addressä¸åŒï¼Œcluster_nameå’Œseedsæ˜¯ç›¸åŒçš„ã€‚</p>
<ul>
<li>JVMé…ç½®: conf/cassandra-env.shï¼ˆJVM_OPTSï¼‰</li>
<li>æ—¥å¿—é…ç½®ï¼šconf/logback.xml</li>
</ul>
<p>å»ºç«‹æ•°æ®å’Œæ—¥å¿—çš„å­˜å‚¨ç›®å½•ï¼ˆç”Ÿäº§ç¯å¢ƒæ•°æ®å’Œæ—¥å¿—æ”¾åœ¨ä¸åŒåˆ†æœŸï¼‰</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir data</span><br><span class="line">mkdir data/data</span><br><span class="line">mkdir data/commitlog</span><br><span class="line">mkdir data/saved_caches</span><br><span class="line">mkdir data/hints</span><br><span class="line">mkdir logs</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>å¯åŠ¨</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./bin/cassandra -f (å‰ç«¯å¯åŠ¨)</span><br><span class="line">./bin/cassandra</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./bin/nodetool status</span><br><span class="line">./bin/nodetool describecluster</span><br></pre></td></tr></table></figure>
<h2 id="å¤šèŠ‚ç‚¹"><a class="header-anchor" href="#å¤šèŠ‚ç‚¹">Â¶</a>å¤šèŠ‚ç‚¹</h2>
<p>cassandraé»˜è®¤æœ‰ä¸¤ç§å¯åŠ¨æ¨¡å¼ï¼Œ localå’Œremoteæ¨¡å¼ï¼Œå¯ä»¥åœ¨<code>/etc/cassandra-env.sh</code>ä¸­æŸ¥çœ‹å’Œä¿®æ”¹ã€‚é»˜è®¤ä½¿ç”¨localæ¨¡å¼ã€‚è¦æƒ³é€šè¿‡nodetoolå‘½ä»¤è¿æ¥æœ¬æœºèŠ‚ç‚¹æ—¶ï¼Œè¦æ›´æ”¹ä¸ºremoteæ¨¡å¼ã€‚</p>
<p>æ·»åŠ <code>LOCAL_JMX=false</code>å’Œä¿®æ”¹ <code>-Dcom.sun.management.jmxremote.authenticate=false</code>ï¼Œå½“ç„¶ä½ å¯ä»¥å¼€å¯åŠ å¯†æ–¹å¼ã€‚é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">LOCAL_JMX=false</span><br><span class="line">if [ &quot;x$LOCAL_JMX&quot; = &quot;x&quot; ]; then</span><br><span class="line">    LOCAL_JMX=yes</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Specifies the default port over <span class="built_in">which</span> Cassandra will be available <span class="keyword">for</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">JMX connections.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">For security reasons, you should not expose this port to the internet.  Firewall it <span class="keyword">if</span> needed.</span></span><br><span class="line">JMX_PORT=&quot;7199&quot;</span><br><span class="line">if [ &quot;$LOCAL_JMX&quot; = &quot;yes&quot; ]; then</span><br><span class="line">  JVM_OPTS=&quot;$JVM_OPTS -Dcassandra.jmx.local.port=$JMX_PORT&quot;</span><br><span class="line">  JVM_OPTS=&quot;$JVM_OPTS -Dcom.sun.management.jmxremote.authenticate=false&quot;</span><br><span class="line">else</span><br><span class="line">  JVM_OPTS=&quot;$JVM_OPTS -Dcassandra.jmx.remote.port=$JMX_PORT&quot;</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash"><span class="keyword">if</span> ssl is enabled the same port cannot be used <span class="keyword">for</span> both jmx and rmi so either</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">pick another value <span class="keyword">for</span> this property or comment out to use a random port (though see CASSANDRA-7087 <span class="keyword">for</span> origins)</span></span><br><span class="line">  JVM_OPTS=&quot;$JVM_OPTS -Dcom.sun.management.jmxremote.rmi.port=$JMX_PORT&quot;</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">turn on JMX authentication. See below <span class="keyword">for</span> further options</span></span><br><span class="line">  JVM_OPTS=&quot;$JVM_OPTS -Dcom.sun.management.jmxremote.authenticate=false&quot;</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">jmx ssl options</span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">JVM_OPTS=<span class="string">&quot;<span class="variable">$JVM_OPTS</span> -Dcom.sun.management.jmxremote.ssl=true&quot;</span></span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">JVM_OPTS=<span class="string">&quot;<span class="variable">$JVM_OPTS</span> -Dcom.sun.management.jmxremote.ssl.need.client.auth=true&quot;</span></span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">JVM_OPTS=<span class="string">&quot;<span class="variable">$JVM_OPTS</span> -Dcom.sun.management.jmxremote.ssl.enabled.protocols=&lt;enabled-protocols&gt;&quot;</span></span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">JVM_OPTS=<span class="string">&quot;<span class="variable">$JVM_OPTS</span> -Dcom.sun.management.jmxremote.ssl.enabled.cipher.suites=&lt;enabled-cipher-suites&gt;&quot;</span></span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">JVM_OPTS=<span class="string">&quot;<span class="variable">$JVM_OPTS</span> -Djavax.net.ssl.keyStore=/path/to/keystore&quot;</span></span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">JVM_OPTS=<span class="string">&quot;<span class="variable">$JVM_OPTS</span> -Djavax.net.ssl.keyStorePassword=&lt;keystore-password&gt;&quot;</span></span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">JVM_OPTS=<span class="string">&quot;<span class="variable">$JVM_OPTS</span> -Djavax.net.ssl.trustStore=/path/to/truststore&quot;</span></span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">JVM_OPTS=<span class="string">&quot;<span class="variable">$JVM_OPTS</span> -Djavax.net.ssl.trustStorePassword=&lt;truststore-password&gt;&quot;</span></span></span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹é…ç½®ï¼Œé‡å¯OKã€‚</p>
<h2 id="Replicationç­–ç•¥"><a class="header-anchor" href="#Replicationç­–ç•¥">Â¶</a>Replicationç­–ç•¥</h2>
<p>Cassandraåœ¨å¤šä¸ªèŠ‚ç‚¹å­˜å‚¨replicaæ¥ç¡®ä¿å¯é æ€§å’Œå®¹é”™æ€§ã€‚Replicationç­–ç•¥å†³å®šäº†replicaä¿å­˜åˆ°å“ªäº›èŠ‚ç‚¹ã€‚</p>
<p>replicaçš„æ€»æ•°ç”±replication factoræ§åˆ¶ã€‚replication factor 1è¡¨ç¤ºä¸€è¡Œæ•°æ®ï¼Œåªä¼šæœ‰ä¸€ä¸ªreplicaï¼Œè¢«ä¿å­˜åœ¨å”¯ä¸€ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚replication factor 2è¡¨ç¤ºä¸€è¡Œæ•°æ®æœ‰ä¸¤ä¸ªå‰¯æœ¬ï¼Œæ¯ä¸ªå‰¯æœ¬ä¿å­˜åœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šã€‚æ‰€æœ‰çš„replicaåŒç­‰é‡è¦ï¼›æ²¡æœ‰ä¸»æ¬¡replicaä¹‹åˆ†ã€‚ä¸€èˆ¬çš„è§„åˆ™æ˜¯ï¼Œreplication factorä¸åº”è¯¥è¶…è¿‡é›†ç¾¤é‡Œçš„èŠ‚ç‚¹æ•°é‡ã€‚ä¸è¿‡ï¼Œå¯ä»¥å…ˆå¢å¤§replication factorï¼Œå†æ·»åŠ æ›´å¤šèŠ‚ç‚¹ã€‚å¦‚æœreplication factoré…ç½®è¶…è¿‡èŠ‚ç‚¹æ•°é‡ï¼Œå†™æ“ä½œä¼šè¢«æ‹’ç»ã€‚è¯»æ“ä½œä¸å—å½±å“ã€‚</p>
<p>Cassandraå†…ç½®äº†ä¸¤ç§ç±»å‹çš„replicationç­–ç•¥ï¼š</p>
<ul>
<li><code>SimpleStrategy</code>ï¼šç”¨äºå•ä¸ªæ•°æ®ä¸­å¿ƒã€‚å¦‚æœæœ‰å¯èƒ½ä»¥åä¼šæœ‰å¤šä¸ªæ•°æ®ä¸­å¿ƒï¼Œåº”è¯¥ç”¨<code>NetworkTopologyStrategy</code></li>
<li><code>NetworkTopologyStrategy</code>ï¼šå¯¹ç»å¤§å¤šæ•°éƒ¨ç½²æ–¹å¼ï¼Œéƒ½å¼ºçƒˆæ¨èè¯¥ç­–ç•¥ï¼Œå› ä¸ºä»Šåçš„æ‰©å±•æ›´å®¹æ˜“</li>
</ul>
<p>å…³äºæ¯ä¸ªæ•°æ®ä¸­å¿ƒåº”è¯¥é…ç½®å‡ ä¸ªreplicaï¼Œä¸€èˆ¬ä¸»è¦è€ƒè™‘ä»¥ä¸‹ä¸¤ä¸ªå› ç´ ï¼š</p>
<ul>
<li>ä¿è¯è¯»æ“ä½œæ²¡æœ‰è·¨æ•°æ®ä¸­å¿ƒçš„å»¶æ—¶æŸè€—</li>
<li>å¦‚ä½•å¤„ç†ç¡¬ä»¶æ•…éšœçš„æƒ…å½¢</li>
</ul>
<p>å¯¹äºå¤šæ•°æ®ä¸­å¿ƒï¼Œæœ€å¸¸ç”¨çš„ä¸¤ç§é…ç½®replicaçš„ç­–ç•¥æ˜¯ï¼š</p>
<ul>
<li>æ¯ä¸ªæ•°æ®ä¸­å¿ƒ2ä¸ªreplicaï¼šåŸºäºè¿™ç§é…ç½®ï¼Œå¯¹äºæ¯ä¸ªæ•°æ®ä¸­å¿ƒï¼Œå³ä½¿å•ä¸ªèŠ‚ç‚¹æ•…éšœï¼Œè¿˜æ˜¯èƒ½å¤Ÿæ”¯æŒconsistency level ONEçš„æœ¬åœ°è¯»</li>
<li>æ¯ä¸ªæ•°æ®ä¸­å¿ƒ3ä¸ªreplicaï¼šåŸºäºè¿™ç§é…ç½®ï¼Œå¯¹äºæ¯ä¸ªæ•°æ®ä¸­å¿ƒï¼Œå³ä½¿å•ä¸ªèŠ‚ç‚¹æ•…éšœï¼Œè¿˜æ˜¯èƒ½å¤Ÿæ”¯æŒconsistency level LOCAL_QUORUMçš„æœ¬åœ°è¯»ï¼›å³ä½¿2ä¸¤ä¸ªèŠ‚ç‚¹æ•…éšœï¼Œè¿˜æ˜¯èƒ½å¤Ÿæ”¯æŒconsistency level ONEçš„æœ¬åœ°è¯»</li>
</ul>
<p>cassandraé»˜è®¤å»ºkeyspaceçš„æ—¶å€™ï¼Œéœ€è¦å®šåˆ¶æ‹“æ‰‘ç­–ç•¥çš„ï¼Œé»˜è®¤æ˜¯<code>SimpleStrategy</code>ï¼Œä¿®æ”¹ <code>conf/cassandra.yaml</code>é‡Œé¢çš„<code>endpoint_snitch</code>ï¼Œå°†å…¶æ›´æ”¹ä¸º<code>GossipingPropertyFileSnitch</code>ã€‚è¡¨ç¤ºå¤šæ•°æ®ä¸­å¿ƒç­–ç•¥ã€‚</p>
<ul>
<li><code>SimpleSnitch</code>ï¼šé»˜è®¤çš„ï¼Œå•æ•°æ®ä¸­å¿ƒéƒ¨ç½²ï¼Œå¯ä»¥åœ¨ç¦ç”¨è¯»ä¿®å¤æ—¶æé«˜ç¼“å­˜ä½ç½®ã€‚</li>
<li><code>GossipingPropertyFileSnitch</code>ï¼šå®˜æ–¹æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œæœ¬èŠ‚ç‚¹çš„rackå’Œdcåå­—ä¿å­˜åœ¨cassandra-rackdc.propertiesï¼Œå¹¶ä¸”ä¼šé€šè¿‡gossipè¿™ä¸ªp2påè®®ä¼ æ’­åˆ°æ‰€æœ‰èŠ‚ç‚¹ä¸Šå»<br>
å¦‚æœcassandra-topology.propertiesæ–‡ä»¶å­˜åœ¨ï¼Œcassandraä¼šæŠŠä¸¤ä¸ªpropertiesæ–‡ä»¶çš„ç»“æœåˆå¹¶ï¼Œå¦‚æœä¸¤ä¸ªpropertiesæ–‡ä»¶é‡Œé¢æœ‰æœ‰åŒä¸€ä¸ªèŠ‚ç‚¹çš„é…ç½®ï¼Œä»¥cassandra-rackdc.propertiesçš„é…ç½®ä¸ºå‡†ã€‚</li>
<li><code>PropertyFileSnitch</code>ï¼šdcå’Œracké€šè¿‡æ˜¾å¼çš„å®šä¹‰åœ¨cassandra-topology.propertiesæ–‡ä»¶é‡Œé¢ã€‚</li>
<li><code>Ec2Snitch</code>ï¼šé€‚åˆå•ä¸ªåŒºåŸŸ(æ•°æ®ä¸­å¿ƒ)çš„EC2éƒ¨ç½²ã€‚</li>
<li><code>Ec2MultiRegionSnitch</code>ï¼šé›†ç¾¤è·¨å¤šä¸ªåŒºåŸŸ(æ•°æ®ä¸­å¿ƒ)çš„EC2éƒ¨ç½²ã€‚</li>
<li><code>RackInferringSnitch</code>ï¼šé€šè¿‡æœ¬æœºIPåœ°å€åˆ¤æ–­èŠ‚ç‚¹æ•°æ®å“ªä¸ªæ•°æ®ä¸­å¿ƒå“ªä¸ªrackã€‚IPç¬¬2æ®µç›¸åŒä¸ºåŒä¸€ä¸ªæ•°æ®ä¸­å¿ƒï¼ŒIPç¬¬3æ®µç›¸åŒä¸ºä¸€ä¸ªRackã€‚å¦‚ä¸‹å›¾ï¼š</li>
</ul>
<p><img src="/img/cassandra/rack-inferring-snitch.jpg" alt="åˆ†æ®µrack"></p>
<h2 id="å®‰è£…MX4Jé›†ç¾¤ç›‘æ§"><a class="header-anchor" href="#å®‰è£…MX4Jé›†ç¾¤ç›‘æ§">Â¶</a>å®‰è£…MX4Jé›†ç¾¤ç›‘æ§</h2>
<p>cassandraç›‘æ§æœ‰è®¸å¤šæ–¹æ¡ˆï¼ŒDataStaxçš„Opscenteræ˜¯æ¯”è¾ƒè€—çš„ç›‘æ§è§£å†³æ–¹æ¡ˆã€‚å¯æƒœOpscenter6.0ç‰ˆæœ¬åå·²ç»ä¸å†æ”¯æŒå¼€æºcassandraç‰ˆæœ¬ã€‚Opscenter5.xç‰ˆæœ¬æ”¯æŒåˆ°cassandra2.1ã€‚æœ€å¥½ä½¿ç”¨cassandraè‡ªèº«æ”¯æŒçš„<a target="_blank" rel="noopener" href="http://mx4j.sourceforge.net/">MX4J</a>è¿›è¡Œç›‘æ§ã€‚</p>
<p>è§£å‹åå°†mx4j-tools.jaræ‹·è´åˆ°cassandraçš„å®‰è£…ç›®å½•çš„libæ–‡ä»¶å¤¹ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unzip mx4j-3.0.2.zip</span><br><span class="line">cp mx4j-3.0.2/lib/mx4j-tools.jar apache-cassandra-3.11.1/lib/</span><br></pre></td></tr></table></figure>
<p>é…ç½®mx4j</p>
<p>ç¼–è¾‘ <code>vim /etc/cassandra/cassandra-env.sh</code>ï¼Œå»é™¤æ³¨é‡Š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MX4J_ADDRESS=&quot;-Dmx4jaddress=10.112.68.186&quot;</span><br><span class="line">MX4J_PORT=&quot;-Dmx4jport=8081&quot;</span><br></pre></td></tr></table></figure>
<p>ç„¶åé‡å¯cassandra</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart cassandra</span><br></pre></td></tr></table></figure>
<p>æµè§ˆå™¨è¾“å…¥åœ°å€ <a target="_blank" rel="noopener" href="http://10.112.68.186:8081">http://10.112.68.186:8081</a></p>
<div id="footnotes"><hr><div id="footnotelist"><ol><li id="fn:1"><a target="_blank" rel="noopener" href="https://www.howtoforge.com/tutorial/how-to-install-apache-cassandra-on-centos-7/">https://www.howtoforge.com/tutorial/how-to-install-apache-cassandra-on-centos-7/</a><a href="#fnref:1" rev="footnote"> â†©</a></li></ol></div></div></div></article><nav class="article-nav"><div class="article-nav-prev">ğŸ”™<a href="/2018/04/10/pattern/futures/Execute-Scala-Futures-in-serial-one-after-the-other-non-blocking/">éé˜»å¡æ–¹å¼å¤„ç†è¿­ä»£Futureé—®é¢˜</a></div><div class="article-nav-next">ğŸ”œ<a href="/2017/12/29/philosophy/circuit-breaker/">Circuit Breaker</a></div></nav><div id="base-discus"><div id="disqus_thread"></div><script>var disqus_shortname = 'barudisshu-github-io';
var disqus_identifier = '2018/01/10/cassandra/cassandra-beginning/';
var disqus_title = 'Cassandra å®‰è£…å…¥é—¨';
var disqus_url = 'https://galudisu.info/2018/01/10/cassandra/cassandra-beginning/';
(function () {
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async>  </script></div></div></div><footer class="base-footer"><div class="footer-wrapper"><span>Â©2016 - 2025 <a href="https://galudisu.info">barudisshu</a>, unless otherwise noted.</span></div></footer><div class="dom-ready">
<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>

<link rel="stylesheet" href="//cdn.bootcss.com/pace/1.0.2/themes/green/pace-theme-flash.min.css">

<script src="/js/base.js"></script>

<script src="/js/rabbit-lyrics.js"></script>
</div></body></html>