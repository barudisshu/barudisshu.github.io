<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><title>MongoDB分片集群搭建</title>
<link rel="stylesheet" href="/css/layout.css">
<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="/css/vendors/rabbit-lyrics.css">
<link rel="shortcut icon" href="/img/favicon.ico"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="简单易懂の现代魔法" type="application/atom+xml">
</head><body><header class="base-menu"><div class="menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">简单易懂の现代魔法</a></li><li class="menu-item"><a class="menu-link" href="/maths/">Maths</a></li><li class="menu-item"><a class="menu-link" href="/projects/">Projects</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav></div></header><header class="base-mobile-menu"><div class="mobile-menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">简单易懂の现代魔法</a></li><li class="menu-item"><a class="menu-link" href="/maths/">Maths</a></li><li class="menu-item"><a class="menu-link" href="/projects/">Projects</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav><div class="toggle-menu" id="mobile-menu-toggle"><span class="menu-bar"></span><span class="menu-bar"> </span><span class="menu-bar"></span></div></div></header><div class="base-content"><div class="base-content-main"><article class="article-main"><h1 class="article-title">MongoDB分片集群搭建</h1><div class="article-meta"><p class="meta-item meta-time"><span class="meta-item-title"></span><i class="icon-calendar"> </i>2018-10-31</p><p class="meta-item meta-tag"><span class="meta-item-title"></span><i class="icon-tag"> </i><a class="tag-link" href="/tags/mongo/">mongo</a></p></div><div class="article-content"><span id="more"></span>
<h2 id="环境"><a class="header-anchor" href="#环境">¶</a>环境</h2>
<ul>
<li>
<p>CentOS 7.5</p>
</li>
<li>
<p>MongoDB 4.0.1</p>
</li>
<li>
<p>shard分片主机：</p>
<ul>
<li>shard1：IP：192.168.50.211</li>
<li>shard2：IP：192.168.50.212</li>
<li>shard3：IP：192.168.50.213<br>
三台主机分别启动三个mongod实例：
<ul>
<li>mongod1：端口：27017</li>
<li>mongod2：端口：27018</li>
<li>mongod3：端口：27019</li>
</ul>
</li>
</ul>
</li>
<li>
<p>configsrv主机：</p>
<ul>
<li>IP：192.168.50.214
<ul>
<li>mongod1：端口：27019</li>
<li>mongod2：端口：37018</li>
<li>mongod3：端口：47019</li>
</ul>
</li>
</ul>
</li>
<li>
<p>route主机：192.168.50.215</p>
<ul>
<li>mongods：端口：27017</li>
</ul>
</li>
</ul>
<h2 id="准备工作"><a class="header-anchor" href="#准备工作">¶</a>准备工作</h2>
<ol>
<li>在所有节点安装mongodb-4 并创建相关文件夹</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; /etc/yum.repos.d/mongodb.repo</span><br><span class="line">[mongodb-org-4.0]</span><br><span class="line">name=MongoDB 4.0 Repository</span><br><span class="line">baseurl=https://mirrors.aliyun.com/mongodb/yum/redhat/\$releasever/mongodb-org/4.0/\$basearch/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">yum install -y mongodb-org</span><br><span class="line"></span><br><span class="line">mkdir -p /var/run/mongodb</span><br><span class="line">mkdir -p /data/mongod&#123;1..3&#125;</span><br><span class="line">mkdir -p /etc/mongo</span><br><span class="line">mkdir -p /tmp/mongod&#123;1..3&#125;</span><br><span class="line"></span><br><span class="line">chown -R mongod.mongod /data</span><br><span class="line">chown -R mongod.mongod /var/run/mongodb</span><br><span class="line">chown -R mongod.mongod /tmp/mongod&#123;1..3&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>生成key并复制至所有主机</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在192.168.50.211主机执行</span></span><br><span class="line"></span><br><span class="line">openssl rand -base64 756 &gt; /etc/mongo/mongo.key</span><br><span class="line">chown -R mongod.mongod /etc/mongo</span><br><span class="line">chmod -R 600 /etc/mongo</span><br><span class="line"></span><br><span class="line">scp -r /etc/mongo 192.168.50.212:/etc/</span><br><span class="line">scp -r /etc/mongo 192.168.50.213:/etc/</span><br><span class="line">scp -r /etc/mongo 192.168.50.214:/etc/</span><br><span class="line">scp -r /etc/mongo 192.168.50.215:/etc/</span><br></pre></td></tr></table></figure>
<h2 id="配置configsvr"><a class="header-anchor" href="#配置configsvr">¶</a>配置configsvr</h2>
<ol>
<li>在configsvr主机(IP：192.168.50.214)操作</li>
<li>生成三个configsvr的配置文件：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">configsvr1的配置文件</span></span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF &gt; /etc/mongo/configsvc1.conf</span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /var/log/mongodb/mongod1.log</span><br><span class="line"></span><br><span class="line">storage:</span><br><span class="line">  dbPath: /data/mongod1</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line">  wiredTiger:</span><br><span class="line">    engineConfig:</span><br><span class="line">      directoryForIndexes: true</span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">  fork: true  # fork and run in background</span><br><span class="line">  pidFilePath: /var/run/mongodb/mongod1.pid  # location of pidfile</span><br><span class="line">  timeZoneInfo: /usr/share/zoneinfo</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 27019</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">bindIp: 0.0.0.0  <span class="comment"># Enter 0.0.0.0,:: to bind to all IPv4 and IPv6 addresses or, alternatively, use the net.bindIpAll setting.</span></span></span><br><span class="line">  bindIpAll: true</span><br><span class="line">  maxIncomingConnections: 500</span><br><span class="line">  unixDomainSocket:</span><br><span class="line">    enabled: true</span><br><span class="line">    pathPrefix: /tmp/mongod1</span><br><span class="line">    filePermissions: 0700</span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">  keyFile: /etc/mongo/mongo.key</span><br><span class="line">  authorization: enabled</span><br><span class="line"></span><br><span class="line">replication:</span><br><span class="line">  replSetName: BigBoss</span><br><span class="line">sharding:</span><br><span class="line">  clusterRole: configsvr</span><br><span class="line"></span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">configsvr2的配置文件</span></span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF &gt; /etc/mongo/configsvc2.conf</span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /var/log/mongodb/mongod2.log</span><br><span class="line"></span><br><span class="line">storage:</span><br><span class="line">  dbPath: /data/mongod2</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line">  wiredTiger:</span><br><span class="line">    engineConfig:</span><br><span class="line">      directoryForIndexes: true</span><br><span class="line">processManagement:</span><br><span class="line">  fork: true  # fork and run in background</span><br><span class="line">  pidFilePath: /var/run/mongodb/mongod2.pid  # location of pidfile</span><br><span class="line">  timeZoneInfo: /usr/share/zoneinfo</span><br><span class="line">net:</span><br><span class="line">  port: 37019</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">bindIp: 0.0.0.0  <span class="comment"># Enter 0.0.0.0,:: to bind to all IPv4 and IPv6 addresses or, alternatively, use the net.bindIpAll setting.</span></span></span><br><span class="line">  bindIpAll: true</span><br><span class="line">  maxIncomingConnections: 500</span><br><span class="line">  unixDomainSocket:</span><br><span class="line">    enabled: true</span><br><span class="line">    pathPrefix: /tmp/mongod2</span><br><span class="line">    filePermissions: 0700</span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">  keyFile: /etc/mongo/mongo.key</span><br><span class="line">  authorization: enabled</span><br><span class="line"></span><br><span class="line">replication:</span><br><span class="line">  replSetName: BigBoss</span><br><span class="line">sharding:</span><br><span class="line">  clusterRole: configsvr</span><br><span class="line"></span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">configsvr3的配置文件</span></span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF &gt; /etc/mongo/configsvc3.conf</span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /var/log/mongodb/mongod3.log</span><br><span class="line"></span><br><span class="line">storage:</span><br><span class="line">  dbPath: /data/mongod3</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line">  wiredTiger:</span><br><span class="line">    engineConfig:</span><br><span class="line">      directoryForIndexes: true</span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">  fork: true  # fork and run in background</span><br><span class="line">  pidFilePath: /var/run/mongodb/mongod3.pid  # location of pidfile</span><br><span class="line">  timeZoneInfo: /usr/share/zoneinfo</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 47019</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">bindIp: 0.0.0.0  <span class="comment"># Enter 0.0.0.0,:: to bind to all IPv4 and IPv6 addresses or, alternatively, use the net.bindIpAll setting.</span></span></span><br><span class="line">  bindIpAll: true</span><br><span class="line">  maxIncomingConnections: 500</span><br><span class="line">  unixDomainSocket:</span><br><span class="line">    enabled: true</span><br><span class="line">    pathPrefix: /tmp/mongod3</span><br><span class="line">    filePermissions: 0700</span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">  keyFile: /etc/mongo/mongo.key</span><br><span class="line">  authorization: enabled</span><br><span class="line"></span><br><span class="line">replication:</span><br><span class="line">  replSetName: BigBoss</span><br><span class="line">sharding:</span><br><span class="line">  clusterRole: configsvr</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>启动mongod：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mongod -f /etc/mongo/configsvc1.conf</span><br><span class="line">mongod -f /etc/mongo/configsvc2.conf</span><br><span class="line">mongod -f /etc/mongo/configsvc3.conf</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>初始化configsrv副本集群</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">mongo --port 27019</span><br><span class="line"></span><br><span class="line">rs.initiate(</span><br><span class="line">&#123;</span><br><span class="line">  _id: &quot;BigBoss&quot;,</span><br><span class="line">  version: 1,</span><br><span class="line">  protocolVersion: 1,</span><br><span class="line">  writeConcernMajorityJournalDefault: true,</span><br><span class="line">  configsvr: true,</span><br><span class="line">  members: [</span><br><span class="line">    &#123;</span><br><span class="line">      _id: 0,</span><br><span class="line">      host: &quot;192.168.50.214:27019&quot;,</span><br><span class="line">      arbiterOnly: false,</span><br><span class="line">      buildIndexes: true,</span><br><span class="line">      hidden: false,</span><br><span class="line">      priority: 66,</span><br><span class="line">      tags: &#123;</span><br><span class="line">        BigBoss: &quot;YES&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      slaveDelay: 0,</span><br><span class="line">      votes: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      _id: 1,</span><br><span class="line">      host: &quot;192.168.50.214:37019&quot;,</span><br><span class="line">      arbiterOnly: false,</span><br><span class="line">      buildIndexes: true,</span><br><span class="line">      hidden: false,</span><br><span class="line">      priority: 55,</span><br><span class="line">      tags: &#123;</span><br><span class="line">        BigBoss: &quot;NO&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      slaveDelay: 0,</span><br><span class="line">      votes: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      _id: 2,</span><br><span class="line">      host: &quot;192.168.50.214:47019&quot;,</span><br><span class="line">      arbiterOnly: false,</span><br><span class="line">      buildIndexes: true,</span><br><span class="line">      hidden: false,</span><br><span class="line">      priority: 33,</span><br><span class="line">      tags: &#123;</span><br><span class="line">        BigBoss: &quot;NO&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      slaveDelay: 0,</span><br><span class="line">      votes: 1</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  settings: &#123;</span><br><span class="line">    chainingAllowed : true,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看副本集状态</span></span><br><span class="line">rs.status()</span><br></pre></td></tr></table></figure>
<h2 id="配置shard1副本集"><a class="header-anchor" href="#配置shard1副本集">¶</a>配置shard1副本集</h2>
<ol>
<li>在shard1主机(IP：192.68.50.211)操作</li>
<li>生成三个mongod的配置文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">mongod1.conf配置文件:</span></span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF &gt; /etc/mongo/mongod1.conf</span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /var/log/mongodb/mongod1.log</span><br><span class="line"></span><br><span class="line">storage:</span><br><span class="line">  dbPath: /data/mongod1</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line">  wiredTiger:</span><br><span class="line">    engineConfig:</span><br><span class="line">      directoryForIndexes: true     </span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">  fork: true  # fork and run in background</span><br><span class="line">  pidFilePath: /var/run/mongodb/mongod1.pid  # location of pidfile</span><br><span class="line">  timeZoneInfo: /usr/share/zoneinfo</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 27017</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">bindIp: 0.0.0.0  <span class="comment"># Enter 0.0.0.0,:: to bind to all IPv4 and IPv6 addresses or, alternatively, use the net.bindIpAll setting.</span></span></span><br><span class="line">  bindIpAll: true</span><br><span class="line">  maxIncomingConnections: 500</span><br><span class="line">  unixDomainSocket:</span><br><span class="line">    enabled: true</span><br><span class="line">    pathPrefix: /tmp/mongod1</span><br><span class="line">    filePermissions: 0700</span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">  keyFile: /etc/mongo/mongo.key</span><br><span class="line">  authorization: enabled</span><br><span class="line"></span><br><span class="line">replication:</span><br><span class="line">  replSetName: shard1</span><br><span class="line">sharding:</span><br><span class="line">  clusterRole: shardsvr</span><br><span class="line"></span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">mongod2.conf配置文件:</span></span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF &gt; /etc/mongo/mongod2.conf</span><br><span class="line"></span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /var/log/mongodb/mongod2.log</span><br><span class="line"></span><br><span class="line">storage:</span><br><span class="line">  dbPath: /data/mongod2</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line">  wiredTiger:</span><br><span class="line">    engineConfig:</span><br><span class="line">      directoryForIndexes: true     </span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">  fork: true  # fork and run in background</span><br><span class="line">  pidFilePath: /var/run/mongodb/mongod2.pid  # location of pidfile</span><br><span class="line">  timeZoneInfo: /usr/share/zoneinfo</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 27018</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">bindIp: 0.0.0.0  <span class="comment"># Enter 0.0.0.0,:: to bind to all IPv4 and IPv6 addresses or, alternatively, use the net.bindIpAll setting.</span></span></span><br><span class="line">  bindIpAll: true</span><br><span class="line">  maxIncomingConnections: 500</span><br><span class="line">  unixDomainSocket:</span><br><span class="line">    enabled: true</span><br><span class="line">    pathPrefix: /tmp/mongod2</span><br><span class="line">    filePermissions: 0700</span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">  keyFile: /etc/mongo/mongo.key</span><br><span class="line">  authorization: enabled</span><br><span class="line"></span><br><span class="line">replication:</span><br><span class="line">  replSetName: shard1</span><br><span class="line"></span><br><span class="line">sharding:</span><br><span class="line">  clusterRole: shardsvr</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">mongod3.conf配置文件:</span></span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF &gt; /etc/mongo/mongod3.conf</span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /var/log/mongodb/mongod3.log</span><br><span class="line"></span><br><span class="line">storage:</span><br><span class="line">  dbPath: /data/mongod3</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line">  wiredTiger:</span><br><span class="line">    engineConfig:</span><br><span class="line">      directoryForIndexes: true     </span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">  fork: true  # fork and run in background</span><br><span class="line">  pidFilePath: /var/run/mongodb/mongod3.pid  # location of pidfile</span><br><span class="line">  timeZoneInfo: /usr/share/zoneinfo</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 27019</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">bindIp: 0.0.0.0  <span class="comment"># Enter 0.0.0.0,:: to bind to all IPv4 and IPv6 addresses or, alternatively, use the net.bindIpAll setting.</span></span></span><br><span class="line">  bindIpAll: true</span><br><span class="line">  maxIncomingConnections: 500</span><br><span class="line">  unixDomainSocket:</span><br><span class="line">    enabled: true</span><br><span class="line">    pathPrefix: /tmp/mongod3</span><br><span class="line">    filePermissions: 0700</span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">  keyFile: /etc/mongo/mongo.key</span><br><span class="line">  authorization: enabled</span><br><span class="line"></span><br><span class="line">replication:</span><br><span class="line">  replSetName: shard1</span><br><span class="line"></span><br><span class="line">sharding:</span><br><span class="line">  clusterRole: shardsvr</span><br><span class="line"></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>启动mongod</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mongod -f /etc/mongo/mongod1.conf</span><br><span class="line">mongod -f /etc/mongo/mongod2.conf</span><br><span class="line">mongod -f /etc/mongo/mongod3.conf</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>初始化shard1副本集</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">mongo</span><br><span class="line"></span><br><span class="line">rs.initiate(</span><br><span class="line">&#123;</span><br><span class="line">  _id: &quot;shard1&quot;,</span><br><span class="line">  version: 1,</span><br><span class="line">  protocolVersion: 1,</span><br><span class="line">  writeConcernMajorityJournalDefault: true,</span><br><span class="line">  members: [</span><br><span class="line">    &#123;</span><br><span class="line">      _id: 0,</span><br><span class="line">      host: &quot;192.168.50.211:27017&quot;,</span><br><span class="line">      arbiterOnly: false,</span><br><span class="line">      buildIndexes: true,</span><br><span class="line">      hidden: false,</span><br><span class="line">      priority: 66,</span><br><span class="line">      tags: &#123;</span><br><span class="line">        BigBoss: &quot;YES&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      slaveDelay: 0,</span><br><span class="line">      votes: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      _id: 1,</span><br><span class="line">      host: &quot;192.168.50.211:27018&quot;,</span><br><span class="line">      arbiterOnly: false,</span><br><span class="line">      buildIndexes: true,</span><br><span class="line">      hidden: false,</span><br><span class="line">      priority: 55,</span><br><span class="line">      tags: &#123;</span><br><span class="line">        BigBoss: &quot;NO&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      slaveDelay: 0,</span><br><span class="line">      votes: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      _id: 2,</span><br><span class="line">      host: &quot;192.168.50.211:27019&quot;,</span><br><span class="line">      arbiterOnly: false,</span><br><span class="line">      buildIndexes: true,</span><br><span class="line">      hidden: false,</span><br><span class="line">      priority: 33,</span><br><span class="line">      tags: &#123;</span><br><span class="line">        BigBoss: &quot;NO&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      slaveDelay: 0,</span><br><span class="line">      votes: 1</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  settings: &#123;</span><br><span class="line">    chainingAllowed : true,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看副本集状态</span></span><br><span class="line">rs.status()</span><br></pre></td></tr></table></figure>
<h2 id="配置shard2副本集"><a class="header-anchor" href="#配置shard2副本集">¶</a>配置shard2副本集</h2>
<ol>
<li>在shard2主机(IP：192.168.50.212)操作</li>
<li>生成三个mongod的配置文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">mongod1.conf配置文件:</span></span><br><span class="line">cat &lt;&lt; EOF &gt; /etc/mongo/mongod1.conf</span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /var/log/mongodb/mongod1.log</span><br><span class="line"></span><br><span class="line">storage:</span><br><span class="line">  dbPath: /data/mongod1</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line">  wiredTiger:</span><br><span class="line">    engineConfig:</span><br><span class="line">      directoryForIndexes: true     </span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">  fork: true  # fork and run in background</span><br><span class="line">  pidFilePath: /var/run/mongodb/mongod1.pid  # location of pidfile</span><br><span class="line">  timeZoneInfo: /usr/share/zoneinfo</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 27017</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">bindIp: 0.0.0.0  <span class="comment"># Enter 0.0.0.0,:: to bind to all IPv4 and IPv6 addresses or, alternatively, use the net.bindIpAll setting.</span></span></span><br><span class="line">  bindIpAll: true</span><br><span class="line">  maxIncomingConnections: 500</span><br><span class="line">  unixDomainSocket:</span><br><span class="line">    enabled: true</span><br><span class="line">    pathPrefix: /tmp/mongod1</span><br><span class="line">    filePermissions: 0700</span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">  keyFile: /etc/mongo/mongo.key</span><br><span class="line">  authorization: enabled</span><br><span class="line"></span><br><span class="line">replication:</span><br><span class="line">  replSetName: shard2</span><br><span class="line">sharding:</span><br><span class="line">  clusterRole: shardsvr</span><br><span class="line"></span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">mongod2.conf配置文件:</span></span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF &gt; /etc/mongo/mongod2.conf</span><br><span class="line"></span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /var/log/mongodb/mongod2.log</span><br><span class="line"></span><br><span class="line">storage:</span><br><span class="line">  dbPath: /data/mongod2</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line">  wiredTiger:</span><br><span class="line">    engineConfig:</span><br><span class="line">      directoryForIndexes: true     </span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">  fork: true  # fork and run in background</span><br><span class="line">  pidFilePath: /var/run/mongodb/mongod2.pid  # location of pidfile</span><br><span class="line">  timeZoneInfo: /usr/share/zoneinfo</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 27018</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">bindIp: 0.0.0.0  <span class="comment"># Enter 0.0.0.0,:: to bind to all IPv4 and IPv6 addresses or, alternatively, use the net.bindIpAll setting.</span></span></span><br><span class="line">  bindIpAll: true</span><br><span class="line">  maxIncomingConnections: 500</span><br><span class="line">  unixDomainSocket:</span><br><span class="line">    enabled: true</span><br><span class="line">    pathPrefix: /tmp/mongod2</span><br><span class="line">    filePermissions: 0700</span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">  keyFile: /etc/mongo/mongo.key</span><br><span class="line">  authorization: enabled</span><br><span class="line"></span><br><span class="line">replication:</span><br><span class="line">  replSetName: shard2</span><br><span class="line"></span><br><span class="line">sharding:</span><br><span class="line">  clusterRole: shardsvr</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">mongod3.conf配置文件:</span></span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF &gt; /etc/mongo/mongod3.conf</span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /var/log/mongodb/mongod3.log</span><br><span class="line"></span><br><span class="line">storage:</span><br><span class="line">  dbPath: /data/mongod3</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line">  wiredTiger:</span><br><span class="line">    engineConfig:</span><br><span class="line">      directoryForIndexes: true     </span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">  fork: true  # fork and run in background</span><br><span class="line">  pidFilePath: /var/run/mongodb/mongod3.pid  # location of pidfile</span><br><span class="line">  timeZoneInfo: /usr/share/zoneinfo</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 27019</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">bindIp: 0.0.0.0  <span class="comment"># Enter 0.0.0.0,:: to bind to all IPv4 and IPv6 addresses or, alternatively, use the net.bindIpAll setting.</span></span></span><br><span class="line">  bindIpAll: true</span><br><span class="line">  maxIncomingConnections: 500</span><br><span class="line">  unixDomainSocket:</span><br><span class="line">    enabled: true</span><br><span class="line">    pathPrefix: /tmp/mongod3</span><br><span class="line">    filePermissions: 0700</span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">  keyFile: /etc/mongo/mongo.key</span><br><span class="line">  authorization: enabled</span><br><span class="line"></span><br><span class="line">replication:</span><br><span class="line">  replSetName: shard2</span><br><span class="line"></span><br><span class="line">sharding:</span><br><span class="line">  clusterRole: shardsvr</span><br><span class="line"></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>启动mongod</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mongod -f /etc/mongo/mongod1.conf</span><br><span class="line">mongod -f /etc/mongo/mongod2.conf</span><br><span class="line">mongod -f /etc/mongo/mongod3.conf</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>初始化shard2副本集</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">mongo</span><br><span class="line"></span><br><span class="line">rs.initiate(</span><br><span class="line">&#123;</span><br><span class="line">  _id: &quot;shard2&quot;,</span><br><span class="line">  version: 1,</span><br><span class="line">  protocolVersion: 1,</span><br><span class="line">  writeConcernMajorityJournalDefault: true,</span><br><span class="line">  members: [</span><br><span class="line">    &#123;</span><br><span class="line">      _id: 0,</span><br><span class="line">      host: &quot;192.168.50.212:27017&quot;,</span><br><span class="line">      arbiterOnly: false,</span><br><span class="line">      buildIndexes: true,</span><br><span class="line">      hidden: false,</span><br><span class="line">      priority: 66,</span><br><span class="line">      tags: &#123;</span><br><span class="line">        BigBoss: &quot;YES&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      slaveDelay: 0,</span><br><span class="line">      votes: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      _id: 1,</span><br><span class="line">      host: &quot;192.168.50.212:27018&quot;,</span><br><span class="line">      arbiterOnly: false,</span><br><span class="line">      buildIndexes: true,</span><br><span class="line">      hidden: false,</span><br><span class="line">      priority: 55,</span><br><span class="line">      tags: &#123;</span><br><span class="line">        BigBoss: &quot;NO&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      slaveDelay: 0,</span><br><span class="line">      votes: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      _id: 2,</span><br><span class="line">      host: &quot;192.168.50.212:27019&quot;,</span><br><span class="line">      arbiterOnly: false,</span><br><span class="line">      buildIndexes: true,</span><br><span class="line">      hidden: false,</span><br><span class="line">      priority: 33,</span><br><span class="line">      tags: &#123;</span><br><span class="line">        BigBoss: &quot;NO&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      slaveDelay: 0,</span><br><span class="line">      votes: 1</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  settings: &#123;</span><br><span class="line">    chainingAllowed : true,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看shard2副本集状态</span></span><br><span class="line"></span><br><span class="line">rs.status()</span><br></pre></td></tr></table></figure>
<h2 id="配置shard3副本集"><a class="header-anchor" href="#配置shard3副本集">¶</a>配置shard3副本集</h2>
<ol>
<li>在shard3主机(IP：192.168.50.203)操作</li>
<li>生成三个mongod的配置文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">mongod1.conf配置文件:</span></span><br><span class="line">cat &lt;&lt; EOF &gt; /etc/mongo/mongod1.conf</span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /var/log/mongodb/mongod1.log</span><br><span class="line"></span><br><span class="line">storage:</span><br><span class="line">  dbPath: /data/mongod1</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line">  wiredTiger:</span><br><span class="line">    engineConfig:</span><br><span class="line">      directoryForIndexes: true     </span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">  fork: true  # fork and run in background</span><br><span class="line">  pidFilePath: /var/run/mongodb/mongod1.pid  # location of pidfile</span><br><span class="line">  timeZoneInfo: /usr/share/zoneinfo</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 27017</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">bindIp: 0.0.0.0  <span class="comment"># Enter 0.0.0.0,:: to bind to all IPv4 and IPv6 addresses or, alternatively, use the net.bindIpAll setting.</span></span></span><br><span class="line">  bindIpAll: true</span><br><span class="line">  maxIncomingConnections: 500</span><br><span class="line">  unixDomainSocket:</span><br><span class="line">    enabled: true</span><br><span class="line">    pathPrefix: /tmp/mongod1</span><br><span class="line">    filePermissions: 0700</span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">  keyFile: /etc/mongo/mongo.key</span><br><span class="line">  authorization: enabled</span><br><span class="line"></span><br><span class="line">replication:</span><br><span class="line">  replSetName: shard3</span><br><span class="line">sharding:</span><br><span class="line">  clusterRole: shardsvr</span><br><span class="line"></span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">mongod2.conf配置文件:</span></span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF &gt; /etc/mongo/mongod2.conf</span><br><span class="line"></span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /var/log/mongodb/mongod2.log</span><br><span class="line"></span><br><span class="line">storage:</span><br><span class="line">  dbPath: /data/mongod2</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line">  wiredTiger:</span><br><span class="line">    engineConfig:</span><br><span class="line">      directoryForIndexes: true     </span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">  fork: true  # fork and run in background</span><br><span class="line">  pidFilePath: /var/run/mongodb/mongod2.pid  # location of pidfile</span><br><span class="line">  timeZoneInfo: /usr/share/zoneinfo</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 27018</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">bindIp: 0.0.0.0  <span class="comment"># Enter 0.0.0.0,:: to bind to all IPv4 and IPv6 addresses or, alternatively, use the net.bindIpAll setting.</span></span></span><br><span class="line">  bindIpAll: true</span><br><span class="line">  maxIncomingConnections: 500</span><br><span class="line">  unixDomainSocket:</span><br><span class="line">    enabled: true</span><br><span class="line">    pathPrefix: /tmp/mongod2</span><br><span class="line">    filePermissions: 0700</span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">  keyFile: /etc/mongo/mongo.key</span><br><span class="line">  authorization: enabled</span><br><span class="line"></span><br><span class="line">replication:</span><br><span class="line">  replSetName: shard3</span><br><span class="line"></span><br><span class="line">sharding:</span><br><span class="line">  clusterRole: shardsvr</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">mongod3.conf配置文件:</span></span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF &gt; /etc/mongo/mongod3.conf</span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /var/log/mongodb/mongod3.log</span><br><span class="line"></span><br><span class="line">storage:</span><br><span class="line">  dbPath: /data/mongod3</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line">  wiredTiger:</span><br><span class="line">    engineConfig:</span><br><span class="line">      directoryForIndexes: true     </span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">  fork: true  # fork and run in background</span><br><span class="line">  pidFilePath: /var/run/mongodb/mongod3.pid  # location of pidfile</span><br><span class="line">  timeZoneInfo: /usr/share/zoneinfo</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 27019</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">bindIp: 0.0.0.0  <span class="comment"># Enter 0.0.0.0,:: to bind to all IPv4 and IPv6 addresses or, alternatively, use the net.bindIpAll setting.</span></span></span><br><span class="line">  bindIpAll: true</span><br><span class="line">  maxIncomingConnections: 500</span><br><span class="line">  unixDomainSocket:</span><br><span class="line">    enabled: true</span><br><span class="line">    pathPrefix: /tmp/mongod3</span><br><span class="line">    filePermissions: 0700</span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">  keyFile: /etc/mongo/mongo.key</span><br><span class="line">  authorization: enabled</span><br><span class="line"></span><br><span class="line">replication:</span><br><span class="line">  replSetName: shard3</span><br><span class="line"></span><br><span class="line">sharding:</span><br><span class="line">  clusterRole: shardsvr</span><br><span class="line"></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>启动mongod</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mongod -f /etc/mongo/mongod1.conf</span><br><span class="line">mongod -f /etc/mongo/mongod2.conf</span><br><span class="line">mongod -f /etc/mongo/mongod3.conf</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>初始化shard3副本集</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">mongo</span><br><span class="line"></span><br><span class="line">rs.initiate(</span><br><span class="line">&#123;</span><br><span class="line">  _id: &quot;shard3&quot;,</span><br><span class="line">  version: 1,</span><br><span class="line">  protocolVersion: 1,</span><br><span class="line">  writeConcernMajorityJournalDefault: true,</span><br><span class="line">  members: [</span><br><span class="line">    &#123;</span><br><span class="line">      _id: 0,</span><br><span class="line">      host: &quot;192.168.50.213:27017&quot;,</span><br><span class="line">      arbiterOnly: false,</span><br><span class="line">      buildIndexes: true,</span><br><span class="line">      hidden: false,</span><br><span class="line">      priority: 66,</span><br><span class="line">      tags: &#123;</span><br><span class="line">        BigBoss: &quot;YES&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      slaveDelay: 0,</span><br><span class="line">      votes: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      _id: 1,</span><br><span class="line">      host: &quot;192.168.50.213:27018&quot;,</span><br><span class="line">      arbiterOnly: false,</span><br><span class="line">      buildIndexes: true,</span><br><span class="line">      hidden: false,</span><br><span class="line">      priority: 55,</span><br><span class="line">      tags: &#123;</span><br><span class="line">        BigBoss: &quot;NO&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      slaveDelay: 0,</span><br><span class="line">      votes: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      _id: 2,</span><br><span class="line">      host: &quot;192.168.50.213:27019&quot;,</span><br><span class="line">      arbiterOnly: false,</span><br><span class="line">      buildIndexes: true,</span><br><span class="line">      hidden: false,</span><br><span class="line">      priority: 33,</span><br><span class="line">      tags: &#123;</span><br><span class="line">        BigBoss: &quot;NO&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      slaveDelay: 0,</span><br><span class="line">      votes: 1</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  settings: &#123;</span><br><span class="line">    chainingAllowed : true,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看shard3副本集状态</span></span><br><span class="line"></span><br><span class="line">rs.status()</span><br></pre></td></tr></table></figure>
<h2 id="配置route"><a class="header-anchor" href="#配置route">¶</a>配置route</h2>
<ol>
<li>创建mongos配置文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">route是无状态的，在任何一台主机启动都行，只要能够连接至configsrv即可</span></span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF &gt; /etc/mongo/route.conf</span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /var/log/mongodb/mongod.log</span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">  fork: true  # fork and run in background</span><br><span class="line">  pidFilePath: /var/run/mongodb/mongod.pid  # location of pidfile</span><br><span class="line">  timeZoneInfo: /usr/share/zoneinfo</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  bindIpAll: true</span><br><span class="line">  maxIncomingConnections: 500</span><br><span class="line">  unixDomainSocket:</span><br><span class="line">    enabled: true</span><br><span class="line">    pathPrefix: /tmp</span><br><span class="line">    filePermissions: 0700</span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">  keyFile: /etc/mongo/mongo.key</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> authorization: enabled</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">replication:</span></span><br><span class="line"></span><br><span class="line">sharding:</span><br><span class="line">  configDB: BigBoss/192.168.50.214:27019,192.168.50.214:37019,192.168.50.214:47019</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>启动mongos并设置一个连接的账号密码</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动</span></span><br><span class="line">mongos -f /etc/mongo/route.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">连接</span></span><br><span class="line">mongo</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设置管理员账号密码</span></span><br><span class="line">use admin</span><br><span class="line"></span><br><span class="line">db.createUser(</span><br><span class="line">&#123;</span><br><span class="line">    user: &quot;root&quot;,</span><br><span class="line">    pwd: &quot;123456&quot;,</span><br><span class="line">    roles: [ &#123; role: &quot;__system&quot;, db: &quot;admin&quot; &#125; ]</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">exit</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>重连至mongodb</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">mongo -uroot -p123456  --authenticationDatabase admin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">添加分片主机至集群中</span></span><br><span class="line">sh.addShard(&quot;shard1/192.168.50.211:27017,192.168.50.211:27018,192.168.50.211:27019&quot;)</span><br><span class="line">sh.addShard(&quot;shard2/192.168.50.212:27017,192.168.50.212:27018,192.168.50.212:27019&quot;)</span><br><span class="line">sh.addShard(&quot;shard3/192.168.50.213:27017,192.168.50.213:27018,192.168.50.213:27019&quot;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看状态</span></span><br><span class="line">sh.status()</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">###为了展示出效果，修改一下默认的chunksize大小,这里修改为1M</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认的chunksize大小为64M，示例修改命令如下：</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">use config</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">db.settings.save( &#123; _id:<span class="string">&quot;chunksize&quot;</span>, value: &lt;sizeInMB&gt; &#125; )</span></span><br><span class="line"></span><br><span class="line">use config</span><br><span class="line">db.settings.save( &#123; _id:&quot;chunksize&quot;, value: 1 &#125; )</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">为<span class="built_in">test</span>数据库开启分片</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">选择一个片键age并指定一个集合mycoll对其进行分片</span></span><br><span class="line"></span><br><span class="line">sh.enableSharding(&quot;test&quot;)</span><br><span class="line">sh.shardCollection(&quot;test.mycoll&quot;, &#123;&quot;age&quot;: 1&#125;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">测试分片，写入数据到数据库中</span></span><br><span class="line"></span><br><span class="line">use test</span><br><span class="line">for (i = 1; i &lt;= 10000; i++) db.mycoll.insert(&#123;age:(i%100), name:&quot;bigboss_user&quot;+i, address:i+&quot;, Some Road, Zhengzhou, Henan&quot;, country:&quot;China&quot;, course:&quot;cousre&quot;+&quot;(i%12)&quot;&#125;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">写入完成之后就可以查看分片信息了</span></span><br><span class="line"></span><br><span class="line">sh.status()</span><br></pre></td></tr></table></figure>
</div></article><nav class="article-nav"><div class="article-nav-prev"><a href="/2018/10/31/mongo/deploying-mongodb-shared-cluster-on-centos-7/">How to Deploy a MongoDB Sharded Cluster on CentOS 7</a></div><div class="article-nav-next"><a href="/2018/10/26/ideal/ideal-reference/">Akka技术架构的一些架构建议</a></div></nav><div id="base-discus"><div id="disqus_thread"></div><script>var disqus_shortname = 'barudisshu-github-io';
var disqus_identifier = '2018/10/31/mongo/mongo-cluster-sharding/';
var disqus_title = 'MongoDB分片集群搭建';
var disqus_url = 'https://galudisu.info/2018/10/31/mongo/mongo-cluster-sharding/';
(function () {
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async>  </script></div></div></div><footer class="base-footer"><div class="footer-wrapper"><span>©2016 - 2025 <a href="https://galudisu.info">barudisshu</a>, unless otherwise noted.</span></div></footer><div class="dom-ready">
<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>

<link rel="stylesheet" href="//cdn.bootcss.com/pace/1.0.2/themes/green/pace-theme-flash.min.css">

<script src="/js/base.js"></script>

<script src="/js/rabbit-lyrics.js"></script>
</div></body></html>