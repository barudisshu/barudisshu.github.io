<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><title>å®è·µMySQLä¸»ä»å¤åˆ¶(Master-Slave)çš„æ“ä½œæµç¨‹ï¼</title>
<link rel="stylesheet" href="/css/layout.css">
<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="/css/vendors/rabbit-lyrics.css">
<link rel="shortcut icon" href="/img/favicon.ico"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ç®€å•æ˜“æ‡‚ã®ç°ä»£é­”æ³•" type="application/atom+xml">
</head><body><header class="base-menu"><div class="menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">ç®€å•æ˜“æ‡‚ã®ç°ä»£é­”æ³•</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav></div></header><header class="base-mobile-menu"><div class="mobile-menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">ç®€å•æ˜“æ‡‚ã®ç°ä»£é­”æ³•</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav><div class="toggle-menu" id="mobile-menu-toggle"><span class="menu-bar"></span><span class="menu-bar"> </span><span class="menu-bar"></span></div></div></header><div class="base-content"><div class="base-content-main"><article class="article-main"><h1 class="article-title">å®è·µMySQLä¸»ä»å¤åˆ¶(Master-Slave)çš„æ“ä½œæµç¨‹ï¼</h1><div class="article-meta"><p class="meta-item meta-time"><span class="meta-item-title"></span><i class="icon-calendar"> </i>2018-07-16</p><p class="meta-item meta-tag"><span class="meta-item-title"></span><i class="icon-tags"> </i><a class="tag-link" href="/tags/mysql/">mysql<span class="tag">, </span></a><a class="tag-link" href="/tags/lvs/">lvs</a></p></div><div class="article-content"><p>å¯¹äºå‘å±•å¾ˆå°çš„å…¬å¸æ¥è¯´ï¼Œå•å°æœåŠ¡å™¨æ”¯æ’‘æ•´ä¸ªå…¬å¸çš„è¿è½¬æ˜¯å¸¸è§çš„äº‹æƒ…ã€‚ä½†æ˜¯éšç€ç”¨æˆ·é‡çš„å¢åŠ ï¼Œéšä¹‹è€Œæ¥çš„æ•°æ®é‡ä¹Ÿä¼šè·Ÿç€å¢åŠ ï¼Œè¿™å°±å¯¼è‡´æ›´å¤šåœ°ç”¨æˆ·ä¼šä½¿ç”¨æŸ¥è¯¢selectæˆ‘ä»¬çš„æ•°æ®åº“ï¼Œä»è€Œå¯¼è‡´æ€§èƒ½æ€¥å‰§çš„ä¸‹é™ã€‚ä¾‹å¦‚ï¼ŒæŸ¥è¯¢ç¼“æ…¢ï¼Œç”¨æˆ·ç­‰å¾…æ—¶é—´é•¿ç­‰ç­‰ï¼Œé«˜å¹¶å‘ï¼Œå¤§æ•°æ®ï¼Œè´Ÿè½½å‡è¡¡ç”šè‡³æ˜¯é›†ç¾¤ï¼Œè¿™äº›æ–¹æ¡ˆéƒ½æ˜¯å°å…¬å¸ä¸ä¼šé‡‡ç”¨çš„ï¼Œä¸€æ–¹é¢æˆæœ¬æé«˜ï¼Œéœ€è¦è¿ç»´ç»´æŠ¤ï¼Œè¿™å·²ç»æŠµnä¸ªç¨‹åºçŒ¿çš„å·¥èµ„äº†ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ä¼šé‡‡ç”¨è¿™ç§æ¨¡å¼ã€‚</p>
<p>ä»”ç»†çš„åˆ†æä¸€ä¸‹ï¼Œè¿™ç§æƒ…å†µï¼Œå…¶å®æ›´å¤šåœ°æ˜¯æ¥æºäºæ•°æ®åº“mysqlçš„æ‰¿å—èƒ½åŠ›å˜å¤§ï¼Œä¸€æ–¹é¢éœ€è¦è¯»æ“ä½œï¼Œå¦ä¸€æ–¹é¢æœ‰éœ€è¦å¢åˆ æ”¹æ“ä½œï¼Œé‚£ä¹ˆå¤šäººåŒæ—¶è¯·æ±‚è‚¯å®šå—ä¸äº†å•¦ï¼<br>
æœ‰äººè¯´ä½¿ç”¨ç¼“å­˜ï¼Œä½†æ˜¯å†æƒ³æƒ³mysqlçš„ç¼“å­˜æ˜¯æœ‰é™åˆ¶çš„ï¼Œå¹¶ä¸æ˜¯ä¸€å‘³çš„å»ç¼“å­˜å°±å¯ä»¥ï¼Œåˆæœ‰äººè¯´ä½¿ç”¨redisç¼“å­˜ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œç„¶è€Œäº‹å®ä¸Šè¿è½¬çš„æ—¶å€™redisç¼“å­˜å¹¶ä¸èƒ½å…¨éƒ¨ç»™ä½ ç¼“å­˜ï¼Œæœ‰äº›æ•°æ®éœ€è¦å®æ—¶çš„æŸ¥çœ‹ï¼Œè€Œä¸”redisç¼“å­˜è¿‡å¤šï¼Œå¯¼è‡´cpuç›´æ¥ä¸Šæ¶¨ï¼Œä¸¥é‡çš„è¯ï¼Œæœºå™¨ç›´æ¥è¿è½¬åœæ­¢ã€‚</p>
<span id="more"></span>
<h2 id="mysqlä¸»ä»å¤åˆ¶çš„è§£ææè¿°"><a class="header-anchor" href="#mysqlä¸»ä»å¤åˆ¶çš„è§£ææè¿°">Â¶</a>mysqlä¸»ä»å¤åˆ¶çš„è§£ææè¿°</h2>
<p>ä¸»ä»å¤åˆ¶æ˜¯æŒ‡ä¸€å°æœåŠ¡å™¨å……å½“ä¸»æ•°æ®åº“æœåŠ¡å™¨ï¼ˆmasterï¼‰ï¼Œå¦ä¸€å°æˆ–å¤šå°æœåŠ¡å™¨å……å½“ä»æ•°æ®åº“æœåŠ¡å™¨ï¼ˆslaveï¼‰ï¼Œä¸»æœåŠ¡å™¨ä¸­çš„æ•°æ®è‡ªåŠ¨å¤åˆ¶åˆ°ä»æœåŠ¡å™¨ä¹‹ä¸­ã€‚å¯¹äºå¤šçº§å¤åˆ¶ï¼Œæ•°æ®åº“æœåŠ¡å™¨å³å¯å……å½“ä¸»æœºï¼Œä¹Ÿå¯å……å½“ä»æœºã€‚MySQLä¸»ä»å¤åˆ¶çš„åŸºç¡€æ˜¯ä¸»æœåŠ¡å™¨å¯¹æ•°æ®åº“ä¿®æ”¹è®°å½•äºŒè¿›åˆ¶æ—¥å¿—ï¼Œä»æœåŠ¡å™¨é€šè¿‡ä¸»æœåŠ¡å™¨çš„äºŒè¿›åˆ¶æ—¥å¿—è‡ªåŠ¨æ‰§è¡Œæ›´æ–°ã€‚<br>
è¯·æ³¨æ„ï¼šå½“ä½ è¿›è¡Œå¤åˆ¶æ—¶ï¼Œæ‰€æœ‰å¯¹å¤åˆ¶ä¸­çš„è¡¨çš„æ›´æ–°å¿…é¡»åœ¨ä¸»æœåŠ¡å™¨ä¸Šè¿›è¡Œã€‚å¦åˆ™ï¼Œä½ å¿…é¡»è¦å°å¿ƒï¼Œä»¥é¿å…ç”¨æˆ·å¯¹ä¸»æœåŠ¡å™¨ä¸Šçš„è¡¨è¿›è¡Œçš„æ›´æ–°ä¸å¯¹ä»æœåŠ¡å™¨ä¸Šçš„è¡¨æ‰€è¿›è¡Œçš„æ›´æ–°ä¹‹é—´çš„å†²çªã€‚</p>
<p>é¦–å…ˆå‡†å¤‡ç¯å¢ƒï¼š<br>
1 ä¸¤å°æœåŠ¡å™¨ï¼ˆè¿™é‡Œè¿˜æ˜¯ä»¥è™šæ‹Ÿæœºåšï¼‰</p>
<ul>
<li>ä¸»æœåŠ¡å™¨IPï¼š192.168.200.139</li>
<li>ä»æœåŠ¡å™¨IPï¼š192.168.153.140<br>
å®‰è£…çš„mysqlï¼ˆå®‰è£…è¿‡ç¨‹ä¸åœ¨å™è¿°ï¼‰ï¼šç‰ˆæœ¬å·å°½å¯èƒ½çš„ä¿æŒä¸€è‡´æ€§ æœ¬æœºå®‰è£…ç‰ˆæœ¬æ˜¯ï¼šmysql5.7.21</li>
</ul>
<p>ä¸€ã€ä¿®æ”¹ä¸»æœåŠ¡å™¨çš„mysqlé…ç½®æ–‡ä»¶</p>
<ol>
<li>æœ¬æœºçš„ä¸»æœåŠ¡å™¨mysqlé…ç½®æ–‡ä»¶åœ°å€åœ¨ï¼š<code>etc/my.cnf</code></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—</span></span><br><span class="line">log-bin=master-bin</span><br><span class="line">log-bin-index=master-bin.index</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®server-id</span></span><br><span class="line">server-id=1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å…³é—­åç§°è§£æ</span></span><br><span class="line">skip-name-resolve</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>åˆ›å»ºä»æœåŠ¡å™¨ç™»å½•ä¸»æœåŠ¡å™¨çš„è´¦å·</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br><span class="line"></span><br><span class="line">mysql -uroot -p</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºç”¨æˆ·</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">create user <span class="string">&#x27;galudisu&#x27;</span>@<span class="string">&#x27;192.168.200.%&#x27;</span> identified by <span class="string">&#x27;password&#x27;</span>;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ†é…æƒé™</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">grant replication slave on *.* to <span class="string">&#x27;galudisu&#x27;</span>@<span class="string">&#x27;192.168.200.%&#x27;</span>;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ·æ–°æƒé™</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">flush privileges;</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>æŸ¥çœ‹ä¸»æœåŠ¡å™¨(master)äºŒè¿›åˆ¶æ—¥å¿—çŠ¶æ€</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show master status;</span></span><br><span class="line">+-------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| File              | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+-------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| master-bin.000001 |      567 |              |                  |                   |</span><br><span class="line">+-------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt;</span></span><br></pre></td></tr></table></figure>
<p>è§£æä¸‹å‚æ•°ï¼š<br>
<i class="conum" data-value="1"></i> File-&gt;mysql-bin.000001 è¡¨ç¤ºè®°å½•äºŒè¿›åˆ¶æ–‡ä»¶åç§°<br>
<i class="conum" data-value="2"></i> Position-&gt;948 æ‰€åœ¨ä½ç½®<br>
<i class="conum" data-value="3"></i> Binlog_Do_DB æŒ‡å®šmysqlçš„binlogæ—¥å¿—è®°å½•å“ªä¸ªdb<br>
<i class="conum" data-value="4"></i> Binlog_Ignore_DB å‘Šè¯‰masterï¼Œå¦‚æœå½“å‰çš„æ•°æ®åº“æ˜¯db_nameï¼ˆå°±æ˜¯Binlog_Ignore_DBè¿™ä¸ªå¯¹åº”çš„å€¼ï¼‰ï¼Œä¸åº”å°†æ›´æ–°ä¿å­˜åˆ°äºŒè¿›åˆ¶æ—¥å¿—ä¸­<br>
<i class="conum" data-value="5"></i> Executed_Gtid_Set mysql5.7ä»¥ä¸Šæ–°å¢å‚æ•° å…·ä½“ç”¨æ³• è‡ªè¡Œç™¾åº¦ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸åŒæ­¥å“ªäº›æ•°æ®åº“</span></span><br><span class="line">binlog-ignore-db=mysql</span><br><span class="line">binlog-ignore-db=test</span><br><span class="line">binlog-ignore-db=information_schema</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åªåŒæ­¥å“ªäº›æ•°æ®åº“ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå…¶å®ƒä¸åŒæ­¥</span></span><br><span class="line">binlog-do-db=shop</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—çŠ¶æ€</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show binlog events \G</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">   Log_name: master-bin.000001</span><br><span class="line">        Pos: 4</span><br><span class="line"> Event_type: Format_desc</span><br><span class="line">  Server_id: 1</span><br><span class="line">End_log_pos: 123</span><br><span class="line">       Info: Server ver: 5.7.22-log, Binlog ver: 4</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">   Log_name: master-bin.000001</span><br><span class="line">        Pos: 123</span><br><span class="line"> Event_type: Previous_gtids</span><br><span class="line">  Server_id: 1</span><br><span class="line">End_log_pos: 154</span><br><span class="line">       Info: </span><br><span class="line">*************************** 3. row ***************************</span><br><span class="line">   Log_name: master-bin.000001</span><br><span class="line">        Pos: 154</span><br><span class="line"> Event_type: Anonymous_Gtid</span><br><span class="line">  Server_id: 1</span><br><span class="line">End_log_pos: 219</span><br><span class="line">       Info: SET @@SESSION.GTID_NEXT= &#x27;ANONYMOUS&#x27;</span><br><span class="line">*************************** 4. row ***************************</span><br><span class="line">   Log_name: master-bin.000001</span><br><span class="line">        Pos: 219</span><br><span class="line"> Event_type: Query</span><br><span class="line">  Server_id: 1</span><br><span class="line">End_log_pos: 415</span><br><span class="line">       Info: CREATE USER &#x27;galudisu&#x27;@&#x27;192.168.200.%&#x27; IDENTIFIED WITH &#x27;mysql_native_password&#x27; AS &#x27;*6BB4837EB74329105EE4568DDA7DC67ED2CA2AD9&#x27;</span><br><span class="line">*************************** 5. row ***************************</span><br><span class="line">   Log_name: master-bin.000001</span><br><span class="line">        Pos: 415</span><br><span class="line"> Event_type: Anonymous_Gtid</span><br><span class="line">  Server_id: 1</span><br><span class="line">End_log_pos: 480</span><br><span class="line">       Info: SET @@SESSION.GTID_NEXT= &#x27;ANONYMOUS&#x27;</span><br><span class="line">*************************** 6. row ***************************</span><br><span class="line">   Log_name: master-bin.000001</span><br><span class="line">        Pos: 480</span><br><span class="line"> Event_type: Query</span><br><span class="line">  Server_id: 1</span><br><span class="line">End_log_pos: 567</span><br><span class="line">       Info: flush privileges</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt;</span></span><br></pre></td></tr></table></figure>
<p>äºŒã€é…ç½®ä»æœåŠ¡å™¨ï¼ˆslaveï¼‰</p>
<ol>
<li>åŒæ ·çš„é…ç½®æ–‡ä»¶è·¯å¾„ <code>etc/my.cnf</code></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é…ç½®server-idï¼Œè®©ä»æœåŠ¡å™¨åˆå”¯ä¸€IDå·</span></span><br><span class="line">server-id=5</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰“å¼€MySQLæ—¥å¿—ï¼Œæ—¥å¿—æ ¼å¼ä¸ºäºŒè¿›åˆ¶</span></span><br><span class="line">relay_log=relay-bin</span><br><span class="line">relay_log_index=relay-bin.index</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®åˆ¶åº¦æƒé™</span></span><br><span class="line">read_only=1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¼€å¯ä»æœåŠ¡å™¨äºŒè¿›åˆ¶æ—¥å¿—</span></span><br><span class="line">log_bin=slave-bin</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä½¿å¾—æ›´æ–°çš„æ•°æ®å†™å…¥äºŒè¿›åˆ¶æ—¥å¿—ä¸­</span></span><br><span class="line">log_slave_updates=1</span><br></pre></td></tr></table></figure>
<p>PSï¼šä¸Šé¢æœªæ‰“å¼€é€‰é¡¹æ˜¯é…ç½®æ–‡ä»¶ä¸­å¯èƒ½éœ€è¦ç”¨åˆ°çš„å‚æ•°ï¼Œç›®å‰åªåšæ¼”ç¤ºä¸»ä» æ‰€ä»¥æ˜¯éœ€è¦ä½¿ç”¨server-id=5 è¿™ä¸ªå‚æ•°å°±è¡Œäº†ã€‚</p>
<ol start="2">
<li>å¯åŠ¨ä»æœåŠ¡å™¨å¤åˆ¶çº¿ç¨‹æœºåˆ¶<br>
è¿›å…¥ä»æœåŠ¡å™¨çš„æ•°æ®åº“ä¸­ï¼š</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">msyql -uroot -p**</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">change master to</span></span><br><span class="line"><span class="meta prompt_">	-&gt; </span><span class="language-bash">master_host=<span class="string">&#x27;192.168.200.139&#x27;</span>, <span class="comment"># ä¸»æœåŠ¡å™¨ipåœ°å€</span></span></span><br><span class="line"><span class="meta prompt_">	-&gt; </span><span class="language-bash">master_user=<span class="string">&#x27;galudisu&#x27;</span>, <span class="comment"># ä¸»æœåŠ¡å™¨åˆ›å»ºçš„æˆæƒç”¨æˆ·(åˆ‡è®°è¿™ä¸ªæ˜¯ç»™ä»æœåŠ¡å™¨ç™»å½•çš„è´¦å·)</span></span></span><br><span class="line"><span class="meta prompt_">	-&gt; </span><span class="language-bash">master_password=<span class="string">&#x27;123456&#x27;</span>, <span class="comment"># ä¸»æœåŠ¡å™¨åˆ›å»ºç”¨æˆ·çš„å¯†ç </span></span></span><br><span class="line"><span class="meta prompt_">	-&gt; </span><span class="language-bash">master_log_file=<span class="string">&#x27;mysql-bin.000001&#x27;</span>, <span class="comment"># ä¸»æœåŠ¡å™¨çš„äºŒè¿›åˆ¶æ–‡ä»¶åç§°</span></span></span><br><span class="line"><span class="meta prompt_">	-&gt; </span><span class="language-bash">master_log_pos=567; <span class="comment"># å¼€å§‹è®°å½•çš„ä½ç½®</span></span></span><br><span class="line">å›è½¦å‡ºç°ï¼š</span><br><span class="line">Query OK, 0 rows affected, 2 warnings(0.03 sec)</span><br></pre></td></tr></table></figure>
<p>PSï¼šä¸Šé¢çš„sqlè¯­å¥æ˜¯ä»å¤´å¼€å§‹å¤åˆ¶ç¬¬ä¸€ä¸ªbinlogï¼Œå¦‚æœæƒ³ä»æŸä¸ªä½ç½®å¼€å§‹å¤åˆ¶binlogï¼Œå°±éœ€è¦åœ¨change master toæ—¶æŒ‡å®šè¦å¼€å§‹çš„binlogæ–‡ä»¶åå’Œè¯­å¥åœ¨æ–‡ä»¶ä¸­çš„èµ·ç‚¹ä½ç½®ï¼Œå‚æ•°ä¸ºï¼šmaster_log_fileå’Œmaster_log_posè¿™ä¸¤ä¸ªå‚æ•°å“¦ã€‚</p>
<ol start="3">
<li>å¯åŠ¨slaveåŒæ­¥è¿›ç¨‹ï¼š</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">start slave;</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>æŸ¥çœ‹çŠ¶æ€æ˜¯å¦å·²å¯åŠ¨å¤åˆ¶åŠŸèƒ½</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show slave status\G;</span></span><br><span class="line"></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 192.168.200.139</span><br><span class="line">                  Master_User: galudisu</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: master-bin.000001</span><br><span class="line">          Read_Master_Log_Pos: 931</span><br><span class="line">               Relay_Log_File: relay-bin.000004</span><br><span class="line">                Relay_Log_Pos: 321</span><br><span class="line">        Relay_Master_Log_File: master-bin.000001</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 931</span><br><span class="line">              Relay_Log_Space: 522</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: 1</span><br><span class="line">                  Master_UUID: 14739182-88be-11e8-ba6a-000c292e5d5b</span><br><span class="line">             Master_Info_File: /var/lib/mysql/master.info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: </span><br><span class="line">            Executed_Gtid_Set: </span><br><span class="line">                Auto_Position: 0</span><br><span class="line">         Replicate_Rewrite_DB: </span><br><span class="line">                 Channel_Name: </span><br><span class="line">           Master_TLS_Version: </span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR: </span><br><span class="line">No query specified</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>Slave_IO_Running: Yes</code><br>
<code>Slave_SQL_Running: Yes</code></p>
<p>è¿™ä¸¤é¡¹å¿…é¡»ä¸ºYesæ‰æ˜¯æˆåŠŸ,æˆªå›¾å‡ºç°é—®é¢˜ æ²¡æœ‰æˆªå›¾ï¼ˆæŠ±æ­‰ï¼‰ã€‚</p>
<p>å¦‚æœä½¿ç”¨äº†å¤åˆ¶çš„è™šæ‹Ÿæœº, mysqlæœåŠ¡çš„uuidå¯èƒ½ä¼šä¸€æ ·Slave_IO_Runing=No, éœ€è¦æŠŠä»æœåŠ¡å™¨mysqlç›®å½•ä¸‹çš„auto.cnfåˆ æ‰ç„¶åé‡å¯mysqlæœåŠ¡ã€‚<br>
ä¾‹å¦‚æˆ‘ä»æœåŠ¡å™¨çš„mysqlåœ°å€æ˜¯ï¼š/var/lib/mysql åˆ‡æ¢åˆ°ä¸‹é¢åˆ é™¤auto.cnfå³å¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf auto.cnf</span><br></pre></td></tr></table></figure>
<p>å¦å¤–ï¼Œå¦‚æœæœ‰é˜²ç«å¢™ï¼Œéœ€è¦æ·»åŠ 3306ç«¯å£åˆ°iptablesã€‚</p>
<p>ä¸‰ã€æµ‹è¯•ä¸€ä¸‹å–½</p>
<p>åœ¨ä¸»æœåŠ¡å™¨(master)ä¸Šï¼Œè¿›å…¥æ•°æ®åº“ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show databases;</span></span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">4 rows in set (0.11 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">create database shop;</span></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨ä»æœåŠ¡å™¨(slave)ä¸Šï¼Œçœ‹çœ‹æ˜¯å¦æœ‰ç›¸åº”çš„æ•°æ®åº“ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show databases;</span></span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| shop               |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">5 rows in set (0.12 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ—¶å€™ä»åº“å°±å‡ºç°è¿™æ¡æ•°æ®äº†ã€‚</p>
<p>å¥½äº†åˆ°è¿™é‡ŒåŸºæœ¬ä¸Šå·²ç»OKäº†ï¼Œå¦‚æœæœ‰ç»†èŠ‚æœªå¤„ç†ï¼Œå¤§å®¶å°±å¯ä»¥è‡ªè¡Œè¡¥å……ã€‚</p>
</div></article><nav class="article-nav"><div class="article-nav-prev">ğŸ”™<a href="/2018/07/24/algorithm/ga/genetic-algorithm/">åŸºäºé—ä¼ ç®—æ³•å®ç°æ’è¯¾ç³»ç»Ÿ</a></div><div class="article-nav-next">ğŸ”œ<a href="/2018/07/12/slick/slick3-with-code-generator/">Slick 3 ä»£ç ç”Ÿæˆå®æˆ˜</a></div></nav><div id="base-discus"><div id="disqus_thread"></div><script>var disqus_shortname = 'barudisshu-github-io';
var disqus_identifier = '2018/07/16/mysql/mysql-master-slave-config/';
var disqus_title = 'å®è·µMySQLä¸»ä»å¤åˆ¶(Master-Slave)çš„æ“ä½œæµç¨‹ï¼';
var disqus_url = 'https://galudisu.info/2018/07/16/mysql/mysql-master-slave-config/';
(function () {
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async>  </script></div></div></div><footer class="base-footer"><div class="footer-wrapper"><span>Â©2016 - 2025 <a href="https://galudisu.info">barudisshu</a>, unless otherwise noted.</span></div></footer><div class="dom-ready">
<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>

<link rel="stylesheet" href="//cdn.bootcss.com/pace/1.0.2/themes/green/pace-theme-flash.min.css">

<script src="/js/base.js"></script>

<script src="/js/rabbit-lyrics.js"></script>
</div></body></html>