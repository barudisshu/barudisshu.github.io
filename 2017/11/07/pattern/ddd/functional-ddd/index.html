<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><title>Domain Design Relish</title>
<link rel="stylesheet" href="/css/layout.css">
<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="/css/vendors/rabbit-lyrics.css">
<link rel="shortcut icon" href="/img/favicon.ico"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="简单易懂の现代魔法" type="application/atom+xml">
</head><body><header class="base-menu"><div class="menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">简单易懂の现代魔法</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav></div></header><header class="base-mobile-menu"><div class="mobile-menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">简单易懂の现代魔法</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav><div class="toggle-menu" id="mobile-menu-toggle"><span class="menu-bar"></span><span class="menu-bar"> </span><span class="menu-bar"></span></div></div></header><div class="base-content"><div class="base-content-main"><article class="article-main"><h1 class="article-title">Domain Design Relish</h1><div class="article-meta"><p class="meta-item meta-time"><span class="meta-item-title"></span><i class="icon-calendar"> </i>2017-11-07</p><p class="meta-item meta-tag"><span class="meta-item-title"></span><i class="icon-tag"> </i><a class="tag-link" href="/tags/ddd/">ddd</a></p></div><div class="article-content"><p>More formally, a domain model is a blueprint of the relationships between the various entities of the problem domain and sketches out other important details, such as the following:</p>
<ul>
<li>Objects that belong to the domain</li>
<li>Behaviors that those objects demonstrate in interacting among themselves</li>
<li>The language that the domain speaks</li>
<li>The context within which the model operates</li>
</ul>
<span id="more"></span>
<p>With a modular system, each component is self-contained in functionality and interacts with other components only through explicitly defined contracts. With this arrangement, you can manage complexity better than with a monolithic system.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Lifecycle of a domain object</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Domain</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">type</span> <span class="title">E</span></span></span><br><span class="line">  <span class="class"><span class="keyword">type</span> <span class="title">H</span></span></span><br><span class="line">  <span class="class"><span class="keyword">type</span> <span class="title">P</span></span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Every object (entity or value object) in any model must have a definite lifecycle pattern</span></span><br><span class="line">  <span class="comment">// thus events will be using repeatedly in various contexts of domain modeling.</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">creation</span></span>: <span class="type">E</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">behaviors</span></span>: <span class="type">H</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">persistence</span></span>: <span class="type">P</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Bank is also an entity,</span></span><br><span class="line"><span class="comment">  * an entity can contain other entities or value objects</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Bank</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// attributes of bank</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">debit</span></span>: <span class="type">Unit</span>   <span class="comment">// 贷款</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">issue</span></span>: <span class="type">Unit</span>   <span class="comment">// 转账</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * In fact, [[Account]] is a aggregate root</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Account</span> </span>&#123;                     <span class="comment">// Basic contract of an Account aggregate</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">no</span></span>: <span class="type">String</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">name</span></span>: <span class="type">String</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">bank</span></span>: <span class="type">Bank</span>                    <span class="comment">// Reference to another entity</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">address</span></span>: <span class="type">Address</span>              <span class="comment">// Address is a value object.</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">dateOfOpening</span></span>: <span class="type">Date</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">dateOfClose</span></span>: <span class="type">Option</span>[<span class="type">Date</span>]</span><br><span class="line">  <span class="comment">// ..</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Factory Pattern be used</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">  <span class="comment">// define apply method</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">CheckingAccount</span>(<span class="params">         <span class="comment">// 具体实现</span></span></span></span><br><span class="line"><span class="params"><span class="class">  no: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">  name: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">  bank: <span class="type">Bank</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">  address: <span class="type">Address</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">  dateOfOpening: <span class="type">Date</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">  dateOfClose: <span class="type">Option</span>[<span class="type">Date</span>]</span></span></span><br><span class="line"><span class="params"><span class="class">  <span class="comment">// ..</span></span></span></span><br><span class="line"><span class="params"><span class="class"></span>) <span class="keyword">extends</span> <span class="title">Account</span></span></span><br></pre></td></tr></table></figure>
<p>In reality, when you design aggregates, you may find that for performance and consistency of operations you have to optimize away many composing entities from the aggregate and have only the root along with the value objects. For example, you may choose to keep a bank ID instead of the entire Bank entity as part of the Account aggregate.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">SavingsAccount</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="class"> no: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="class"> name: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="class"> bank: <span class="type">Bank</span>,</span></span></span><br><span class="line"><span class="params"><span class="class"> address: <span class="type">Address</span>,</span></span></span><br><span class="line"><span class="params"><span class="class"> dateOfOpening: <span class="type">Date</span>,</span></span></span><br><span class="line"><span class="params"><span class="class"> dateOfClose: <span class="type">Option</span>[<span class="type">Date</span>],</span></span></span><br><span class="line"><span class="params"><span class="class"></span></span></span><br><span class="line"><span class="params"><span class="class">  <span class="comment">// ..</span></span></span></span><br><span class="line"><span class="params"><span class="class">  rateOfInterest: <span class="type">BigDecimal</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">  <span class="comment">// ..</span></span></span></span><br><span class="line"><span class="params"><span class="class"></span>) <span class="keyword">extends</span> <span class="title">Account</span></span></span><br></pre></td></tr></table></figure>
<p>A domain model is a blueprint of the relationships between the various entities of the problem domain and sketches out other important details, such as following:</p>
<ul>
<li>Objects that belong to the domain</li>
<li>Behaviors that those objects demonstrate in interacting among themselves</li>
<li>The language that the domain speaks</li>
<li>The context within which the model operates</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line">  <span class="class"><span class="keyword">type</span> <span class="title">Amount</span> </span>= <span class="type">BigDecimal</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">transfer</span></span>(from: <span class="type">Account</span>, to: <span class="type">Account</span>, amount: <span class="type">Amount</span>): <span class="type">Option</span>[<span class="type">Amount</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Repository doesn&#x27;t have any knowledge of the nature of the underlying persistent store.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">AccountRepository</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">query</span></span>(accountNo: <span class="type">String</span>): <span class="type">Option</span>[<span class="type">Account</span>]</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">query</span></span>(criteria: <span class="type">Criteria</span>[<span class="type">Account</span>]): <span class="type">Seq</span>[<span class="type">Account</span>]</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">write</span></span>(accounts: <span class="type">Seq</span>[<span class="type">Account</span>]): <span class="type">Boolean</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">delete</span></span>(account: <span class="type">Account</span>): <span class="type">Boolean</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>supply a bunch of arguments to the factory and get back an aggregate(such as <code>Account</code>).</li>
<li>use the aggregate as your contract through all behaviors that you implement through services.</li>
<li>use the aggregate to persist the entity in the repository</li>
</ol>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * [[AccountServiceImpl]] respect the qualities of understandability</span></span><br><span class="line"><span class="comment">  * 1. The function body doesn&#x27;t contain any irrelevant details. It just encapsulates the domain logic</span></span><br><span class="line"><span class="comment">  * 2. The implementation used terms from the domain of banking, so business domain doesn&#x27;t know anything about</span></span><br><span class="line"><span class="comment">  * the underlying implementation platform, it is reference transparent.</span></span><br><span class="line"><span class="comment">  * 3. The implementation narrates use method composing and monadic and takes care of any exceptions in the sequence of execution.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">AccountServiceImpl</span> <span class="keyword">extends</span> <span class="title">AccountService</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// These methods call `Ubiquitous language`</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">debit</span></span>(a: <span class="type">Account</span>, amount: <span class="type">Amount</span>): <span class="type">Try</span>[<span class="type">Account</span>]</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">credit</span></span>(a: <span class="type">Account</span>, amount: <span class="type">Amount</span>): <span class="type">Try</span>[<span class="type">Account</span>]</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">transfer</span></span>(from: <span class="type">Account</span>, to: <span class="type">Account</span>, amount: <span class="type">Amount</span>): <span class="type">Try</span>[(<span class="type">Account</span>,<span class="type">Account</span>)] = <span class="keyword">for</span> &#123;</span><br><span class="line">    d &lt;- debit(from, amount)</span><br><span class="line">    c &lt;- credit(to, amount)</span><br><span class="line">  &#125; <span class="keyword">yield</span> (d,c)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article><nav class="article-nav"><div class="article-nav-prev">🔙<a href="/2017/11/13/pattern/ddd/dddfs/">An Akka DDD from scratch</a></div><div class="article-nav-next">🔜<a href="/2017/11/06/philosophy/cap-theorem/">CAP理论</a></div></nav><div id="base-discus"><div id="disqus_thread"></div><script>var disqus_shortname = 'barudisshu-github-io';
var disqus_identifier = '2017/11/07/pattern/ddd/functional-ddd/';
var disqus_title = 'Domain Design Relish';
var disqus_url = 'https://galudisu.info/2017/11/07/pattern/ddd/functional-ddd/';
(function () {
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async>  </script></div></div></div><footer class="base-footer"><div class="footer-wrapper"><span>©2016 - 2025 <a href="https://galudisu.info">barudisshu</a>, unless otherwise noted.</span></div></footer><div class="dom-ready">
<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>

<link rel="stylesheet" href="//cdn.bootcss.com/pace/1.0.2/themes/green/pace-theme-flash.min.css">

<script src="/js/base.js"></script>

<script src="/js/rabbit-lyrics.js"></script>
</div></body></html>