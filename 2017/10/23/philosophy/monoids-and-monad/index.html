<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><title>Monoids and Monads</title>
<link rel="stylesheet" href="/css/layout.css">
<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="/css/vendors/rabbit-lyrics.css">
<link rel="shortcut icon" href="/img/favicon.ico"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ç®€å•æ˜“æ‡‚ã®ç°ä»£é­”æ³•" type="application/atom+xml">
</head><body><header class="base-menu"><div class="menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">ç®€å•æ˜“æ‡‚ã®ç°ä»£é­”æ³•</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav></div></header><header class="base-mobile-menu"><div class="mobile-menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">ç®€å•æ˜“æ‡‚ã®ç°ä»£é­”æ³•</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav><div class="toggle-menu" id="mobile-menu-toggle"><span class="menu-bar"></span><span class="menu-bar"> </span><span class="menu-bar"></span></div></div></header><div class="base-content"><div class="base-content-main"><article class="article-main"><h1 class="article-title">Monoids and Monads</h1><div class="article-meta"><p class="meta-item meta-time"><span class="meta-item-title"></span><i class="icon-calendar"> </i>2017-10-23</p><p class="meta-item meta-tag"><span class="meta-item-title"></span><i class="icon-tag"> </i><a class="tag-link" href="/tags/scala-fp/">scala, fp</a></p></div><div class="article-content"><blockquote>
<p>Haskellç”±äºä½¿ç”¨äº†Monadè¿™ç§è¾ƒè´¹è§£çš„æ¦‚å¿µæ¥æ§åˆ¶å‰¯ä½œç”¨è€Œé­åˆ°äº†ä¸€äº›æ‰¹è¯„æ„è§ã€‚Wadlerè¯•å›¾å¹³æ¯è¿™äº›è´¨ç–‘ï¼Œä»–è§£é‡Šè¯´ï¼šâ€œä¸€ä¸ªå•å­ï¼ˆMonadï¼‰è¯´ç™½äº†ä¸è¿‡å°±æ˜¯è‡ªå‡½å­èŒƒç•´ä¸Šçš„ä¸€ä¸ªå¹ºåŠç¾¤è€Œå·²ï¼Œè¿™æœ‰ä»€ä¹ˆéš¾ä»¥ç†è§£çš„ï¼Ÿâ€<br>
A monad is just a monoid in the category of endofunctors, whatâ€™s the problem?</p>
</blockquote>
<p>è¿™ä¸€å¥è¯åŒ…å«äº†å¥½å‡ ä¸ªæ¦‚å¿µï¼šå•å­(monad)ï¼Œè‡ªå‡½å­(Endo-Functor)ï¼Œå¹ºåŠç¾¤(Monoid)ï¼ŒèŒƒç•´(category)ã€‚</p>
<span id="more"></span>
<h2 id="Monoid"><a class="header-anchor" href="#Monoid">Â¶</a>Monoid</h2>
<p>å‡½æ•°å¼ç¼–ç¨‹çš„Monoidå½¢å¼å®šä¹‰ä¸ºï¼š</p>
<ul>
<li>ç»™å®šçš„ç±»å‹ <code>T</code></li>
<li>ä¸€ä¸ªäºŒå…ƒæ“ä½œï¼Œ<code>Op: (T,T) =&gt; T</code>	ä½¿å¾—ä»»æ„çš„ x, y, z âˆˆ Tï¼Œæ»¡è¶³ op(op(x,y), z) == op(x, op(y,z))</li>
<li>å…ƒå•ä½ <code>Zero: T</code>					ä½¿å¾—ä»»æ„çš„ x âˆˆ Tï¼Œæ»¡è¶³ op(x, zero) == x and op(zero, x) == x</li>
</ul>
<p>æ»¡è¶³ä»¥ä¸Šå…³ç³»çš„ä»£æ•°æ•°æ®ç»“æ„ï¼Œå­˜åœ¨ä¸€ç§æ™®éå­˜åœ¨å½¢å¼ï¼š</p>
<ol>
<li>è‹¥Tä¸ºæ•´æ•°ï¼Œåˆ™æœ‰ <code>(a+b)+c == a+(b+c)</code>ã€<code>0+n == n+0 == n</code>; <code>(a*b)*c == a*(b*c)</code>ã€<code>1*n == n*1 == n</code></li>
<li>è‹¥Tä¸ºå­—ç¬¦ä¸²ï¼Œåˆ™æœ‰ <code>a+(b+c)==(a+b)+c; &quot;&quot;+s==s</code>ã€<code>s+&quot;&quot; == s</code></li>
<li>è‹¥Tä¸ºæ•°ç»„ï¼Œåˆ™æœ‰ <code>List(1,2)+List(3,4) == List(1,2,3,4)</code></li>
<li>è‹¥Tä¸ºé›†åˆï¼Œåˆ™æœ‰ <code>Set(1,2,3)+Set(2,4) == Set(1,2,3,4)</code></li>
</ol>
<p>å¯ä»¥çœ‹å‡ºï¼Œæ•´æ•°æ—¶æ˜æ˜¾æ»¡è¶³äº† â€œåŠ æ³•äº¤æ¢å¾‹å’Œä¹˜æ³•åˆ†é…å¾‹ï¼ŒåŒ…å«ä¸€ä¸ªå•ä½å…ƒ<code>e</code>â€ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªçº¿æ€§ç©ºé—´ã€‚å°½ç®¡å…¶å®ƒæ•°æ®ç±»å‹æ²¡æœ‰ç‰¹åˆ«æ˜æ˜¾ï¼Œæˆ‘ä»¬è¦æ„é€ ç›¸åº”çš„å®šä¹‰å…³ç³»ï¼Œåœ¨å…¶æ˜ å°„å…³ç³»ä¸Šæ„é€ ä¸€ä¸ªå¹ºåŠç¾¤(Monoid)ã€‚</p>
<p>ä¸€ä¸ªç¾¤çš„å®šä¹‰ä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ï¼ˆ1ï¼‰å°é—­æ€§ï¼ˆClosureï¼‰ï¼šå¯¹äºä»»æ„aï¼ŒbâˆˆGï¼Œæœ‰a*bâˆˆG</span><br><span class="line">ï¼ˆ2ï¼‰ç»“åˆå¾‹ï¼ˆAssociativityï¼‰ï¼šå¯¹äºä»»æ„aï¼Œbï¼ŒcâˆˆGï¼Œæœ‰ï¼ˆa*bï¼‰*c=a*ï¼ˆb*cï¼‰</span><br><span class="line">ï¼ˆ3ï¼‰å¹ºå…ƒ ï¼ˆIdentityï¼‰ï¼šå­˜åœ¨å¹ºå…ƒeï¼Œä½¿å¾—å¯¹äºä»»æ„aâˆˆGï¼Œe*a=a*e=a</span><br><span class="line">ï¼ˆ4ï¼‰é€†å…ƒï¼šå¯¹äºä»»æ„aâˆˆGï¼Œå­˜åœ¨é€†å…ƒa^-1ï¼Œä½¿å¾—a^-1*a=a*a^-1=e</span><br></pre></td></tr></table></figure>
<p>åˆ™ç§° (G, *) æ˜¯ç¾¤ï¼Œç®€ç§°Gæ˜¯ç¾¤ã€‚</p>
<p>å¦‚æœä»…æ»¡è¶³å°é—­æ€§å’Œç»“åˆå¾‹ï¼Œåˆ™ç§°Gæ˜¯ä¸€ä¸ªåŠç¾¤ï¼ˆSemigroupï¼‰ï¼›å¦‚æœä»…æ»¡è¶³å°é—­æ€§ã€ç»“åˆå¾‹å¹¶ä¸”æœ‰å¹ºå…ƒï¼Œåˆ™ç§°Gæ˜¯ä¸€ä¸ªå«å¹ºåŠç¾¤ï¼ˆMonoidï¼‰ã€‚</p>
<p>æ‰€ä»¥ä¸€ä¸ªåŠç¾¤(semigroup)çš„å®šä¹‰æ˜¯ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">SemiGroup</span>[<span class="type">T</span>] </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">op</span></span>(a1: <span class="type">T</span>, a2: <span class="type">T</span>): <span class="type">T</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŒ…å«å•ä½å…ƒæˆ–å¹ºå…ƒçš„åŠç¾¤ï¼Œä¸ºå¹ºåŠç¾¤(monoid)ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Monoid</span>[<span class="type">T</span>] </span>&#123;</span><br><span class="line">  <span class="comment">// äºŒå…ƒæ“ä½œ</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">op</span></span>(a1: <span class="type">T</span>, a2: <span class="type">T</span>): <span class="type">T</span></span><br><span class="line">  <span class="comment">// å•ä½å…ƒ</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">zero</span></span>: <span class="type">T</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ–</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Monoid</span>[<span class="type">T</span>] <span class="keyword">extends</span> <span class="title">SemiGroup</span>[<span class="type">T</span>] </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">zero</span></span>: <span class="type">T</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŒ‰ç…§è¯­ä¹‰ï¼Œå±äºç¾¤çš„ä»»æ„é›†åˆè¦æ»¡è¶³å®šä¹‰å…³ç³»ï¼Œæ‰€ä»¥ä»»æ„é›†åˆçš„å½¢å¼ä¸ºï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">IntMonoid</span> <span class="keyword">extends</span> <span class="title">Monoid</span>[<span class="type">Int</span>] </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">op</span></span>(a1: <span class="type">Int</span>, a2: <span class="type">Int</span>) = a1 + a2</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">zero</span> </span>= <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ–</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> stringMonoid = <span class="keyword">new</span> <span class="type">Monoid</span>[<span class="type">String</span>] &#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">op</span></span>(a1: <span class="type">String</span>, a2: <span class="type">String</span>) = a1 + a2</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">zero</span> </span>= <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ–</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">listMonoid</span></span>[<span class="type">A</span>] = <span class="keyword">new</span> <span class="type">Monoid</span>[<span class="type">List</span>[<span class="type">A</span>]] &#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">op</span></span>(a1: <span class="type">List</span>[<span class="type">A</span>], a2: <span class="type">List</span>[<span class="type">A</span>]) = a1 ++ a2</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">zero</span> </span>= <span class="type">Nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆè¿™ç§å®šä¹‰åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿå‡½æ•°çš„æŠ½è±¡æ€§åœ¨äºï¼Œæˆ‘ä»¬å¯ä»¥æŠ½è±¡ä¸€ç§ç±»å‹ï¼Œå®ç°é«˜é˜¶å‡½æ•°ã€‚å¹ºåŠç¾¤(Monoid)çš„æŠ½è±¡å®é™…æ˜¯ä¸€ä¸ªåŸŸ(Domain)ï¼Œå¯¹åº”Scalaçš„ç±»å‹ç³»ç»Ÿ(type class)ã€‚æˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜Monoidè¿™ç§ç±»å‹ç±»å¸¦æ¥çš„å‡½æ•°å¼ç¼–ç¨‹é­…åŠ›ã€‚</p>
<p>Monoidå¸¦æ¥ä¸¤ä¸ªé‡è¦æ³•åˆ™ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">associativeLaw</span></span>[<span class="type">A</span>](x: <span class="type">A</span>, y: <span class="type">A</span>, z: <span class="type">A</span>)(<span class="keyword">implicit</span> m: <span class="type">Monoid</span>[<span class="type">A</span>]): <span class="type">Boolean</span> = m.op(x, m.op(y, z)) == m.op(m.op(x, y), z)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">identityLaw</span></span>[<span class="type">A</span>](x: <span class="type">A</span>)(<span class="keyword">implicit</span> m: <span class="type">Monoid</span>[<span class="type">A</span>]): <span class="type">Boolean</span> = &#123;</span><br><span class="line">  (m.op(x, m.zero) == x) &amp;&amp;</span><br><span class="line">	(m.op(m.zero, x) == x)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Monoid</span>[<span class="type">A</span>] </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">f</span></span>(a1: <span class="type">A</span>, a2: <span class="type">A</span>): <span class="type">A</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">zero</span></span>: <span class="type">A</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">implicit</span> <span class="keyword">val</span> intMonoid = <span class="keyword">new</span> <span class="type">Monoid</span>[<span class="type">Int</span>] &#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">f</span></span>(a: <span class="type">Int</span>, b: <span class="type">Int</span>):<span class="type">Int</span> = a + b</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">zero</span> </span>= <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span></span>[<span class="type">A</span>](ts: <span class="type">List</span>[<span class="type">A</span>])(<span class="keyword">implicit</span> m: <span class="type">Monoid</span>[<span class="type">A</span>]): <span class="type">A</span> = ts.foldLeft(m.zero)(m.f)</span><br></pre></td></tr></table></figure>
<h2 id="èŒƒç•´"><a class="header-anchor" href="#èŒƒç•´">Â¶</a>èŒƒç•´</h2>
<p>èŒƒç•´ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p>
<blockquote>
<p>ï¼ˆ1ï¼‰ä¸€ç»„å¯¹è±¡<br>
ï¼ˆ2ï¼‰ä¸€ç»„æ€å°„ï¼ˆmorphismsï¼‰ã€‚æ¯ä¸ªæ€å°„ä¼šç»‘å®šä¸¤ä¸ªå¯¹è±¡ï¼Œå‡å¦‚fæ˜¯ä»æºå¯¹è±¡Aåˆ°ç›®æ ‡å¯¹è±¡Bçš„æ€å°„ï¼Œè®°ä½œï¼š<code>fï¼šA -&gt; B</code><br>
ï¼ˆ3ï¼‰æ€å°„ç»„åˆã€‚å‡å¦‚hæ˜¯æ€å°„få’Œgçš„ç»„åˆï¼Œè®°ä½œï¼š<code>h = g o f</code></p>
</blockquote>
<p>ä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ªç®€å•çš„èŒƒç•´ï¼Œè¯¥èŒƒç•´ç”±å¯¹è±¡ <code>A</code>, <code>B</code> å’Œ <code>C</code> ç»„æˆï¼Œæœ‰ä¸‰ä¸ªå•ä½æ€å°„ <code>id_A</code>, <code>id_B</code> å’Œ <code>id_C</code> ï¼Œè¿˜æœ‰å¦å¤–ä¸¤ä¸ªæ€å°„ <code>f : C =&gt; B</code> å’Œ <code>g : A =&gt; B </code></p>
<p><img src="/img/philosophy/fcp/category.png" alt="Simple-cat"></p>
<p>æ€å°„æˆ‘ä»¬å¯ä»¥ç®€å•çš„ç†è§£ä¸ºå‡½æ•°ï¼Œå‡å¦‚åœ¨æŸèŒƒç•´ä¸­å­˜åœ¨ä¸€ä¸ªæ€å°„ï¼Œå®ƒå¯ä»¥æŠŠèŒƒç•´ä¸­ä¸€ä¸ªIntå¯¹è±¡è½¬åŒ–ä¸ºStringå¯¹è±¡ã€‚åœ¨Scalaä¸­æˆ‘ä»¬å¯ä»¥è¿™æ ·å®šä¹‰è¿™ä¸ªæ€å°„ï¼š<code>f : Int =&gt; String = ...</code>ã€‚æ‰€ä»¥æ€å°„çš„ç»„åˆä¹Ÿå°±æ˜¯å‡½æ•°çš„ç»„åˆï¼Œè§ä»£ç ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; <span class="keyword">val</span> f1: <span class="type">Int</span> =&gt; <span class="type">Int</span> = i =&gt; i + <span class="number">1</span></span><br><span class="line">f1: <span class="type">Int</span> =&gt; <span class="type">Int</span> = &lt;function1&gt;</span><br><span class="line"></span><br><span class="line">scala&gt; <span class="keyword">val</span> f2: <span class="type">Int</span> =&gt; <span class="type">Int</span> = i =&gt; i + <span class="number">2</span></span><br><span class="line">f2: <span class="type">Int</span> =&gt; <span class="type">Int</span> = &lt;function1&gt;</span><br><span class="line"></span><br><span class="line">scala&gt; <span class="keyword">val</span> f3 = f1 compose f2</span><br><span class="line">f3: <span class="type">Int</span> =&gt; <span class="type">Int</span> = &lt;function1&gt;</span><br></pre></td></tr></table></figure>
<h4 id="èŒƒç•´å…¬ç†"><a class="header-anchor" href="#èŒƒç•´å…¬ç†">Â¶</a>èŒƒç•´å…¬ç†</h4>
<p>èŒƒç•´éœ€è¦æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªå…¬ç†ã€‚</p>
<blockquote>
<p>ï¼ˆ1ï¼‰æ€å°„çš„ç»„åˆæ“ä½œè¦æ»¡è¶³ç»“åˆå¾‹ã€‚è®°ä½œï¼š<code>f o (g o h) = (f o g) o h</code><br>
ï¼ˆ2ï¼‰å¯¹ä»»ä½•ä¸€ä¸ªèŒƒç•´ Cï¼Œå…¶ä¸­ä»»ä½•ä¸€ä¸ªå¯¹è±¡Aä¸€å®šå­˜åœ¨ä¸€ä¸ªå•ä½æ€å°„ï¼Œ<code>id_A: A =&gt; A</code>ã€‚å¹¶ä¸”å¯¹äºæ€å°„<code>gï¼šA =&gt; B</code> æœ‰ <code>id_B o g = g = g o id_A</code>ã€‚<br>
ï¼ˆ3ï¼‰æ€å°„åœ¨ç»„åˆæ“ä½œä¸‹æ˜¯é—­åˆçš„ã€‚æ‰€ä»¥å¦‚æœå­˜åœ¨æ€å°„<code>f: A =&gt; B</code> å’Œ<code>g: B =&gt; C</code>ï¼Œé‚£ä¹ˆèŒƒç•´ä¸­å¿…å®šå­˜åœ¨æ€å°„ <code>h: A =&gt; C</code> ä½¿å¾— <code>h = g o f</code>ã€‚</p>
</blockquote>
<p><img src="/img/philosophy/fcp/composition-ex.png" alt="Composition-ex"></p>
<p><code>f</code> å’Œ <code>g</code> éƒ½æ˜¯æ€å°„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€å®šèƒ½å¤Ÿå¯¹å®ƒä»¬è¿›è¡Œç»„åˆå¹¶å¾—åˆ°èŒƒç•´ä¸­çš„å¦ä¸€ä¸ªæ€å°„ã€‚é‚£ä¹ˆå“ªä¸€ä¸ªæ˜¯æ€å°„ <code>f o g</code> å‘¢ï¼Ÿå”¯ä¸€çš„é€‰æ‹©å°±æ˜¯ <code>id_A</code> äº†ã€‚ç±»ä¼¼åœ°ï¼Œ<code>g o f=id_B</code> ã€‚</p>
<h2 id="å‡½å­-Functor"><a class="header-anchor" href="#å‡½å­-Functor">Â¶</a>å‡½å­(Functor)</h2>
<h4 id="å‡½å­å®šä¹‰"><a class="header-anchor" href="#å‡½å­å®šä¹‰">Â¶</a>å‡½å­å®šä¹‰</h4>
<p>å‡½å­æœ‰ä¸€ç§èƒ½åŠ›ï¼ŒæŠŠä¸¤ä¸ªèŒƒç•´å…³è”åœ¨ä¸€èµ·ã€‚å‡½å­æœ¬è´¨ä¸Šæ˜¯èŒƒç•´ä¹‹é—´çš„è½¬æ¢ã€‚æ¯”å¦‚å¯¹äºèŒƒç•´ C å’Œ D ï¼Œå‡½å­<code>F : C =&gt; D</code> èƒ½å¤Ÿï¼šå°† C ä¸­ä»»æ„å¯¹è±¡a è½¬æ¢ä¸º D ä¸­çš„ F(A); å°† C ä¸­çš„æ€å°„<code>f : A =&gt; B</code> è½¬æ¢ä¸º D ä¸­çš„ <code>F(f) : F(A) =&gt; F(B)</code></p>
<p>ä¸‹å›¾è¡¨ç¤ºä»èŒƒç•´Cåˆ°èŒƒç•´Dçš„å‡½å­ã€‚å›¾ä¸­çš„æ–‡å­—æè¿°äº†å¯¹è±¡ A å’Œ B è¢«è½¬æ¢åˆ°äº†èŒƒç•´ D ä¸­åŒä¸€ä¸ªå¯¹è±¡ï¼Œå› æ­¤ï¼Œæ€å°„ g å°±è¢«è½¬æ¢æˆäº†ä¸€ä¸ªæºå¯¹è±¡å’Œç›®æ ‡å¯¹è±¡ç›¸åŒçš„æ€å°„ï¼ˆä¸ä¸€å®šæ˜¯å•ä½æ€å°„ï¼‰ï¼Œè€Œä¸” id_A å’Œ id_B å˜æˆäº†ç›¸åŒçš„æ€å°„ã€‚å¯¹è±¡ä¹‹é—´çš„è½¬æ¢æ˜¯ç”¨æµ…é»„è‰²çš„è™šçº¿ç®­å¤´è¡¨ç¤ºï¼Œæ€å°„ä¹‹é—´çš„è½¬æ¢æ˜¯ç”¨è“ç´«è‰²çš„ç®­å¤´è¡¨ç¤ºã€‚</p>
<p><img src="/img/philosophy/fcp/Functor.png" alt="Functor"></p>
<h4 id="å•ä½å‡½å­"><a class="header-anchor" href="#å•ä½å‡½å­">Â¶</a>å•ä½å‡½å­</h4>
<p>æ¯ä¸€ä¸ªèŒƒç•´Céƒ½å¯ä»¥å®šä¹‰ä¸€ä¸ªå•ä½å‡½å­ï¼š<code>Idï¼š C =&gt; C</code>ã€‚å®ƒå°†å¯¹è±¡å’Œæ€å°„ç›´æ¥è½¬æ¢æˆå®ƒä»¬è‡ªå·±ï¼š<code>Id[A] = A; f: A =&gt; B, Id[f] = f</code>ã€‚</p>
<h4 id="å‡½å­å…¬ç†"><a class="header-anchor" href="#å‡½å­å…¬ç†">Â¶</a>å‡½å­å…¬ç†</h4>
<blockquote>
<p>ï¼ˆ1ï¼‰ç»™å®šä¸€ä¸ªå¯¹è±¡ A ä¸Šçš„å•ä½æ€å°„Id_A ï¼Œ F(Id_A) å¿…é¡»ä¹Ÿæ˜¯ F(A) ä¸Šçš„å•ä½æ€å°„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š<code>F(Id_A) = Id_(F(A))</code><br>
ï¼ˆ2ï¼‰å‡½å­åœ¨æ€å°„ç»„åˆä¸Šå¿…é¡»æ»¡è¶³åˆ†é…å¾‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š<code>F(f o g) = F(f) o F(g)</code></p>
</blockquote>
<p>ä¸€ä¸ªå‡½å­<code>Functor</code>è¡¨ç¤ºèŒƒç•´Aåˆ°èŒƒç•´Bä¹‹é—´çš„æ˜ å°„ã€‚å‡½å­å’Œå‡½æ•°éƒ½è¡¨ç¤ºä¸€ç§æ˜ å°„å…³ç³»ï¼Œä½†æ˜¯é’ˆå¯¹çš„ç±»å‹ä¸åŒã€‚</p>
<ol>
<li>å‡½æ•°è¡¨è¾¾çš„æ˜ å°„å…³ç³»åœ¨ç±»å‹ä¸Šä½“ç°åœ¨**ç‰¹å®šç±»å‹(proper type)**ä¸Šã€‚</li>
</ol>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Int =&gt; String</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span></span>(i:<span class="type">Int</span>): <span class="type">String</span> = i.toString</span><br><span class="line"></span><br><span class="line"><span class="comment">// List[Int] =&gt; List[String]</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span></span>(l:<span class="type">List</span>[<span class="type">Int</span>]): <span class="type">List</span>[<span class="type">String</span>] = l.map(_.toString)</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>å‡½å­è¡¨è¾¾çš„æ˜ å°„å…³ç³»ï¼Œåˆ™ä½“ç°åœ¨**é«˜é˜¶å‡½æ•°(high-order function)**ä¸Š(ç¡®åˆ‡æ¥è¯´æ˜¯èŒƒç•´)ã€‚</li>
</ol>
<p>æ€ä¹ˆç”¨ä»£ç æ¥æè¿°å‡½å­ï¼Ÿæ ¹æ®å®šä¹‰ï¼Œå®ƒåŒ…å«ä¸¤ä¸ªå±‚é¢çš„æ˜ å°„å…³ç³»ï¼š</p>
<blockquote>
<ol>
<li>å°†C1ä¸­çš„ç±»å‹ T æ˜ å°„ä¸º C2 ä¸­çš„ <code>List[T] :  T =&gt; List[T]</code></li>
<li>å°†C1ä¸­çš„å‡½æ•° f æ˜ å°„ä¸º C2 ä¸­çš„ å‡½æ•°<code>fm :  (A =&gt; B) =&gt; (List[A] =&gt; List[B])</code></li>
</ol>
</blockquote>
<p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç±»å‹æ„é€ å™¨</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Functor</span>[<span class="type">F</span>[_]] </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">typeMap</span></span>[<span class="type">A</span>]: <span class="type">F</span>[<span class="type">A</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">funcMap</span></span>[<span class="type">A</span>,<span class="type">B</span>](f: <span class="type">A</span>=&gt;<span class="type">B</span>): <span class="type">F</span>[<span class="type">A</span>]=&gt;<span class="type">F</span>[<span class="type">B</span>] </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŠŠè¿™é¡¹å®šä¹‰å†ç®€åŒ–</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Functor</span>[<span class="type">F</span>[_]] </span>&#123;</span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">map</span></span>[<span class="type">A</span>, <span class="type">B</span>](a: <span class="type">F</span>[<span class="type">A</span>])(f: <span class="type">A</span> =&gt; <span class="type">B</span>): <span class="type">F</span>[<span class="type">B</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//list Functorçš„å®ç°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">listFunctor</span> </span>= <span class="keyword">new</span> <span class="type">Functor</span>[<span class="type">List</span>] &#123;</span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">map</span></span>[<span class="type">A</span>, <span class="type">B</span>](a: <span class="type">List</span>[<span class="type">A</span>])(f: (<span class="type">A</span>) =&gt; <span class="type">B</span>) = a.map(f)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ç”¨å½’çº³è¯æ˜çš„æ–¹æ³•æ¥é˜è¿°<code>Functor[F[_]]</code>æ˜¯å¦æ»¡è¶³å®šä¹‰å…³ç³»ã€‚<code>f: A =&gt; B</code> æ˜¯ä¸€ä¸ªæ€å°„ï¼Œå®ƒæ„æˆäº†<code>A=&gt;B =&gt; F[A] =&gt; F[B]</code> çš„ä¸€ä¸ªæ˜ å°„å…³ç³»ã€‚<code>map[Int, Int](List(1, 2, 3))(_ + 1)</code>ï¼Œå¯¹äºmap å®ƒçš„å…¥å‚æ˜¯<code>List(1,2,3)</code>ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­è¢«æ˜ å°„è¯¥å‡½æ•° <code>_: Int + 1</code>ï¼Œå¾—åˆ°ç»“æœ List(2,3,4)ã€‚å¯¹äºListèŒƒç•´æ¥è¯´ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯ï¼š<code>List[Int] =&gt; List[Int]</code>ã€‚å®ƒå°±æ˜¯Int åˆ° List èŒƒç•´çš„å‡½å­ï¼Œå³ <code>Int =&gt; Int =&gt; List[Int] =&gt; List[Int]</code>ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">èŒƒç•´Int				èŒƒç•´List[_]</span><br><span class="line">+------------+            +----------------+</span><br><span class="line">|            |            |                |</span><br><span class="line">|    Int     |    map     |   List[Int]    |</span><br><span class="line">|     â†“      |   =====&gt;   |       â†“        |</span><br><span class="line">|    Int     |   f:A=&gt;B   |   List[Int]    |</span><br><span class="line">|            |            |                |</span><br><span class="line">+------------+            +----------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åœ¨haskellé‡ŒæŠŠè¿™ä¸¤ä¸ªè¡Œä¸ºå«åšæå‡(lift)ï¼Œç›¸å½“äºæŠŠç±»å‹å’Œå‡½æ•°æ”¾åˆ°å®¹å™¨é‡Œã€‚</p>
<h2 id="è‡ªå‡½å­-Endofunctor"><a class="header-anchor" href="#è‡ªå‡½å­-Endofunctor">Â¶</a>è‡ªå‡½å­(Endofunctor)</h2>
<p>è‡ªå‡½å­æ˜¯ä¸€ç±»æ¯”è¾ƒç‰¹æ®Šçš„å‡½å­ï¼Œå®ƒæ˜¯ä¸€ç§å°†èŒƒç•´æ˜ å°„åˆ°è‡ªèº«çš„å‡½å­ (A functor that maps a category to itself)ã€‚ä¾‹å¦‚Int =&gt; Int, String =&gt; Stringç­‰ã€‚</p>
<p>è‡ªå‡½å­çš„æ˜ å°„ç»“æœæ˜¯è‡ªèº«ï¼Œå› æ­¤ï¼Œå¯¹äºè‡ªå‡½å­Fï¼Œ<code>F[Int]</code> çš„ç»“æœæ˜¯ <code>Int</code>ï¼Œ<code>F[Int =&gt; String]</code> çš„ç»“æœä»æ˜¯ <code>Int =&gt; String</code></p>
<h2 id="Monad"><a class="header-anchor" href="#Monad">Â¶</a>Monad</h2>
<p>é‚£ä¹ˆå›è¿‡å¤´æ¥çœ‹çœ‹å®šä¹‰ï¼Œ<strong>â€œä¸€ä¸ªå•å­ï¼ˆMonadï¼‰è¯´ç™½äº†ä¸è¿‡å°±æ˜¯è‡ªå‡½å­èŒƒç•´ä¸Šçš„ä¸€ä¸ªå¹ºåŠç¾¤è€Œå·²ï¼Œæœ‰ä»€ä¹ˆéš¾ä»¥ç†è§£çš„ã€‚â€</strong></p>
<p>é¦–å…ˆï¼Œè‡ªå‡½å­æ˜¯é•¿è¿™æ ·çš„ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Functor</span>[<span class="type">F</span>[_]] </span>&#123;</span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">map</span></span>[<span class="type">A</span>, <span class="type">B</span>](a: <span class="type">F</span>[<span class="type">A</span>])(f: <span class="type">A</span> =&gt; <span class="type">B</span>): <span class="type">F</span>[<span class="type">B</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¹ºåŠç¾¤æ˜¯é•¿è¿™æ ·çš„ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Monoid</span>[<span class="type">A</span>] </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">f</span></span>(a1: <span class="type">A</span>, a2: <span class="type">A</span>): <span class="type">A</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">zero</span></span>: <span class="type">A</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è‡ªå‡½å­ä¸Šçš„å¹ºåŠç¾¤æ˜¯å•¥ï¼Ÿé¦–å…ˆå®ƒæ˜¯ä¸€ä¸ªè‡ªå‡½å­ï¼Œæ‰€ä»¥å®ƒåº”è¯¥åŒ…å«ç±»å‹<code>[M[_]]</code>ï¼Œè‡ªå‡½å­æ»¡è¶³ <code>A =&gt; B â†’ M[A] =&gt; M[B]</code> çš„å…³ç³»ï¼Œæ‰€ä»¥å®ƒåŒ…å«æœ‰ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Monad</span>[<span class="type">F</span>[_]] </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">flatMap</span></span>[<span class="type">A</span>, <span class="type">B</span>](value: <span class="type">F</span>[<span class="type">A</span>])(func: <span class="type">A</span> =&gt; <span class="type">F</span>[<span class="type">B</span>]): <span class="type">F</span>[<span class="type">B</span>]</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¥½åƒè¿˜æ¼ç‚¹ä»€ä¹ˆï¼Ÿå¹ºå…ƒ(å•ä½å…ƒ)ï¼è¡¥å…¨ä¹‹åï¼Œ</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Monad</span>[<span class="type">F</span>[_]] </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">flatMap</span></span>[<span class="type">A</span>, <span class="type">B</span>](value: <span class="type">F</span>[<span class="type">A</span>])(func: <span class="type">A</span> =&gt; <span class="type">F</span>[<span class="type">B</span>]): <span class="type">F</span>[<span class="type">B</span>]</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">unit</span></span>[<span class="type">A</span>](a: <span class="type">A</span>): <span class="type">F</span>[<span class="type">A</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Monadçš„ç¡®åˆ‡å®šä¹‰ä¸ºï¼š</p>
<blockquote>
<p>Monadæ˜¯ä¸€ä¸ªå‡½å­ï¼šM: C -&gt; Cï¼Œå¹¶ä¸”å¯¹Cä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡xä»¥ä¸‹ä¸¤ä¸ªæ€å°„ï¼š</p>
<ol>
<li><code>unit: x -&gt; M[x]</code></li>
<li><code>join/bind: M[M[x]] -&gt; M[x]</code></li>
</ol>
</blockquote>
<p>ç¬¬ä¸€ä¸ªæ€å°„æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œå®ƒå°±æ˜¯å­å‡½æ•°çš„å¹ºå…ƒï¼›ç¬¬äºŒä¸ªå°±æ˜¯æˆ‘ä»¬æè¿°çš„è‡ªå‡½å­ï¼æŒ‰ç…§å®šä¹‰å®ç°çš„Monadï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Monad</span>[<span class="type">M</span>[_]] </span>&#123;</span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">unit</span></span>[<span class="type">A</span>](a: <span class="type">A</span>): <span class="type">M</span>[<span class="type">A</span>]   <span class="comment">//identity</span></span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">join</span></span>[<span class="type">A</span>](mma: <span class="type">M</span>[<span class="type">M</span>[<span class="type">A</span>]]): <span class="type">M</span>[<span class="type">A</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®ƒå®é™…ä¸Šå’Œç¬¬ä¸€ç§Monadå®šä¹‰æ˜¯ç­‰ä»·çš„ï¼ï¼ä¸è¿‡å®ƒè¿˜æœ‰æ›´å¤šçš„æ¨å¯¼å½¢å¼â€¦</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">join</span></span>[<span class="type">A</span>](mma: <span class="type">M</span>[<span class="type">M</span>[<span class="type">A</span>]]): <span class="type">M</span>[<span class="type">A</span>] = flatMap(mma)(ma =&gt; ma)</span><br></pre></td></tr></table></figure>
<p>ä¾‹å­ï¼šæˆ‘ä»¬å®ç°ä¸‹å›¾çš„ä¸€ä¸ªè£…ç®±æ“ä½œï¼š</p>
<p><img src="/img/philosophy/fcp/Monad.png" alt="Monad"></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Monad</span>[<span class="type">F</span>[_]] </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">flatMap</span></span>[<span class="type">A</span>, <span class="type">B</span>](value: <span class="type">F</span>[<span class="type">A</span>])(func: <span class="type">A</span> =&gt; <span class="type">F</span>[<span class="type">B</span>]): <span class="type">F</span>[<span class="type">B</span>]</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">unit</span></span>[<span class="type">A</span>](a: <span class="type">A</span>): <span class="type">F</span>[<span class="type">A</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Monadåœ¨ç±»åº“ä¸­æ€»æ˜¯å’Œ<code>implicity</code>ä¸€èµ·ä½¿ç”¨ï¼Œæˆ‘ä»¬ä¸åšè¿™ä¹ˆå¤æ‚ï¼Œå‡è®¾è‡ªå‡½å­èŒƒç•´æ˜¯<code>List</code>ï¼Œå®ç°ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> <span class="type">ListMonad</span> = <span class="keyword">new</span> <span class="type">Monad</span>[<span class="type">List</span>] &#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">flatMap</span></span>[<span class="type">A</span>, <span class="type">B</span>](value: <span class="type">List</span>[<span class="type">A</span>])(func: <span class="type">A</span> =&gt; <span class="type">List</span>[<span class="type">B</span>]): <span class="type">List</span>[<span class="type">B</span>] = &#123;</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">fun</span></span>: (<span class="type">List</span>[<span class="type">A</span>]) =&gt; <span class="type">List</span>[<span class="type">B</span>] = &#123;</span><br><span class="line">	  <span class="keyword">case</span> <span class="type">Nil</span> =&gt; <span class="type">Nil</span></span><br><span class="line">	  <span class="keyword">case</span> x :: xs =&gt; func(x) ::: fun(xs)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fun(value)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">unit</span></span>[<span class="type">A</span>](a: <span class="type">A</span>) = <span class="type">List</span>(a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯¹è¯¥å¹ºåŠç¾¤åšè‡ªå‡½å­çš„æ˜ å°„ï¼Œå³æ¯ä¸ªå…ƒç´ åŠ 3</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logger info <span class="string">s&quot;<span class="subst">$&#123;ListMonad.flatMap(List(1, 2, 3))(x =&gt; x + 3 :: Nil) &#125;</span>&quot;</span></span><br></pre></td></tr></table></figure>
<p>ä¸€ç‚¹æ”¹è¿›ï¼šå°¾é€’å½’å®ç°ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> listMonad = <span class="keyword">new</span> <span class="type">Monad</span>[<span class="type">List</span>] &#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">flatMap</span></span>[<span class="type">A</span>, <span class="type">B</span>](value: <span class="type">List</span>[<span class="type">A</span>])(func: <span class="type">A</span> =&gt; <span class="type">List</span>[<span class="type">B</span>]): <span class="type">List</span>[<span class="type">B</span>] = &#123;</span><br><span class="line">	<span class="meta">@tailrec</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">fun</span></span>(a: <span class="type">List</span>[<span class="type">A</span>], b: <span class="type">List</span>[<span class="type">B</span>]): <span class="type">List</span>[<span class="type">B</span>] = a <span class="keyword">match</span> &#123;</span><br><span class="line">	  <span class="keyword">case</span> <span class="type">Nil</span> =&gt; b</span><br><span class="line">	  <span class="keyword">case</span> x :: xs =&gt; fun(xs, b ::: func(x))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fun(value, <span class="type">Nil</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">unit</span></span>[<span class="type">A</span>](a: <span class="type">A</span>) = <span class="type">List</span>(a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¾—ç›ŠäºèŒƒç•´è®ºçš„æ¨ç†æ€»æ˜¯è¾£ä¹ˆçš„å¤šï¼ŒMonadæœ‰å‡ ä¸ªå¸¸è§çš„æ¨å¯¼ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Monad</span>[<span class="type">F</span>[_]] </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">flatMap</span></span>[<span class="type">A</span>, <span class="type">B</span>](v: <span class="type">F</span>[<span class="type">A</span>])(f: <span class="type">A</span> =&gt; <span class="type">F</span>[<span class="type">B</span>]): <span class="type">F</span>[<span class="type">B</span>]</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">unit</span></span>[<span class="type">A</span>](a: <span class="type">A</span>): <span class="type">F</span>[<span class="type">A</span>]</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">compose</span></span>[<span class="type">A</span>, <span class="type">B</span>, <span class="type">C</span>](f: <span class="type">A</span> =&gt; <span class="type">F</span>[<span class="type">B</span>], g: <span class="type">B</span> =&gt; <span class="type">F</span>[<span class="type">C</span>]): <span class="type">A</span> =&gt; <span class="type">F</span>[<span class="type">C</span>] = a =&gt; flatMap(f(a))(g)</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">join</span></span>[<span class="type">A</span>, <span class="type">B</span>](mma: <span class="type">F</span>[<span class="type">F</span>[<span class="type">A</span>]]): <span class="type">F</span>[<span class="type">A</span>] = flatMap(mma)(ma =&gt; ma)</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">map</span></span>[<span class="type">A</span>,<span class="type">B</span>](ma: <span class="type">F</span>[<span class="type">A</span>])(f: <span class="type">A</span> =&gt; <span class="type">B</span>): <span class="type">F</span>[<span class="type">B</span>] = flatMap(ma)(a =&gt; unit(f(a)))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div id="footnotes"><hr><div id="footnotelist"><ol><li id="fn:1">ã€ŠAdvanced Scala with Catsã€‹, underscore.<a href="#fnref:1" rev="footnote"> â†©</a></li><li id="fn:2">Scalaå’ŒèŒƒç•´è®º, <a target="_blank" rel="noopener" href="http://www.jianshu.com/p/31377066bf97">http://www.jianshu.com/p/31377066bf97</a><a href="#fnref:2" rev="footnote"> â†©</a></li><li id="fn:3"><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/3870088/a-monad-is-just-a-monoid-in-the-category-of-endofunctors-whats-the-problem">http://stackoverflow.com/questions/3870088/a-monad-is-just-a-monoid-in-the-category-of-endofunctors-whats-the-problem</a><a href="#fnref:3" rev="footnote"> â†©</a></li></ol></div></div></div></article><nav class="article-nav"><div class="article-nav-prev">ğŸ”™<a href="/2017/11/06/philosophy/cap-theorem/">CAPç†è®º</a></div><div class="article-nav-next">ğŸ”œ<a href="/2017/10/09/pattern/magent/scala-method-overloading-and-default-argument-values/">Scala Method Overloading and Default Argument Values</a></div></nav><div id="base-discus"><div id="disqus_thread"></div><script>var disqus_shortname = 'barudisshu-github-io';
var disqus_identifier = '2017/10/23/philosophy/monoids-and-monad/';
var disqus_title = 'Monoids and Monads';
var disqus_url = 'https://galudisu.info/2017/10/23/philosophy/monoids-and-monad/';
(function () {
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async>  </script></div></div></div><footer class="base-footer"><div class="footer-wrapper"><span>Â©2016 - 2025 <a href="https://galudisu.info">barudisshu</a>, unless otherwise noted.</span></div></footer><div class="dom-ready">
<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>

<link rel="stylesheet" href="//cdn.bootcss.com/pace/1.0.2/themes/green/pace-theme-flash.min.css">

<script src="/js/base.js"></script>

<script src="/js/rabbit-lyrics.js"></script>
</div></body></html>