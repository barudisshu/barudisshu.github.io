<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><title>kubernetes 设计理念及主要概念之Pod(二)</title>
<link rel="stylesheet" href="/css/layout.css">
<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="/css/vendors/rabbit-lyrics.css">
<link rel="shortcut icon" href="/img/favicon.ico"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="简单易懂の现代魔法" type="application/atom+xml">
</head><body><header class="base-menu"><div class="menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">简单易懂の现代魔法</a></li><li class="menu-item"><a class="menu-link" href="/maths/">Maths</a></li><li class="menu-item"><a class="menu-link" href="/projects/">Projects</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav></div></header><header class="base-mobile-menu"><div class="mobile-menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">简单易懂の现代魔法</a></li><li class="menu-item"><a class="menu-link" href="/maths/">Maths</a></li><li class="menu-item"><a class="menu-link" href="/projects/">Projects</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav><div class="toggle-menu" id="mobile-menu-toggle"><span class="menu-bar"></span><span class="menu-bar"> </span><span class="menu-bar"></span></div></div></header><div class="base-content"><div class="base-content-main"><article class="article-main"><h1 class="article-title">kubernetes 设计理念及主要概念之Pod(二)</h1><div class="article-meta"><p class="meta-item meta-time"><span class="meta-item-title"></span><i class="icon-calendar"> </i>2019-02-04</p><p class="meta-item meta-tag"><span class="meta-item-title"></span><i class="icon-tag"> </i><a class="tag-link" href="/tags/kubernetes/">kubernetes</a></p></div><div class="article-content"><p>Kubernetes使用共享网络将多个物理机或虚拟机汇集到一个集群中，在各服务器之间进行通信，该集群时配置Kubernetes的所有组件、功能和工作负载的物理平台。集群中一台服务器(或高可用部署中的一组服务器)作为Master，负责管理整个集群，其余作为Worker Node，集群中的主机可以是物理服务器，也可以是虚拟机(包括云VPS)。</p>
<span id="more"></span>
<h2 id="集群概念"><a class="header-anchor" href="#集群概念">¶</a>集群概念</h2>
<ol>
<li>Master节点</li>
</ol>
<p>Master是集群的网关和中枢，负责为用户和客户端暴露API、状态信息、管理和调度负责，以及编排其它组件之间的通信等任务。单个Master节点可以完成所有功能，实际生产环境由于负载均衡等目的，需要协同部署多个Master节点。</p>
<ol start="2">
<li>Node节点</li>
</ol>
<p>Node节点属于Worker节点，由多个主机构建。Worker节点不暴露任何信息，不对外开发接口。</p>
<h2 id="主要概念"><a class="header-anchor" href="#主要概念">¶</a>主要概念</h2>
<p>Kubernetes由很多技术概念，同时对应很多API对象，API对象是k8s集群中的管理操作单元。</p>
<p>每个API对象都有3大类属性：元数据metadat、规范spec和状态status。元数据是用来表示API对象的，每个对象至少有3个元数据：namespace、name和uid；除此之外还有各种各样的标签label是用来标识和匹配不同的对象。规范spec描述了用户期望k8s集群中的分布式系统达到的理想状态(desired State)，状态status描述了系统实际当前达到的状态(Status)。</p>
<p>k8s中的API对象设计理念之一，是所有操作都是声明式的(Declarative)。所以你会发现会有很多yaml配置。声明式操作在分布式系统中的好处是稳定，不怕丢失操作或运行多次。</p>
<p>下面简述一些常见的API对象。</p>
<h2 id="Pod"><a class="header-anchor" href="#Pod">¶</a>Pod</h2>
<p>Pod是k8s的最小调度单元，同一个Pod中的容器共享网络名称空间和存储资源，这些容器可经本地回环节口lo直接通信，但彼此又在Mount、User及PID等名称空间上保持隔离。</p>
<p>特性：</p>
<ul>
<li>包含多个共享IPC、Network和UTC namespace的容器，可直接本地通信</li>
<li>所有Pod内容器都可以访问共享的Volume，可以访问共享数据</li>
<li>Pod一旦调度后就跟Node绑定，即使Node挂掉也不会重新调度，推荐使用Deployments、Daemonsets等控制器来容错</li>
<li>优雅终止：Pod删除的时候先给其内的进程发送SIGTERM，等待一段时间(grace period)后才强制停止运行的进程</li>
<li>特权容器(通过SecurityContext配置)具有改变系统配置的权限</li>
</ul>
<p><img src="/img/kubernetes/module_03_pods.svg" alt="Pod"></p>
<p>通过yaml或接送描述Pod和其内Container的运行环境以及期望状态，比如一个最简单的nginx pod可以定义为，</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">sepc:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">	<span class="attr">ports:</span></span><br><span class="line">	<span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>
<p>volume可以为容器提供持久化存储，比如，</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">	<span class="attr">volumeMounts:</span></span><br><span class="line">	<span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-storage</span></span><br><span class="line">	  <span class="attr">mountPath:</span> <span class="string">/data/redis</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-storage</span></span><br><span class="line">    <span class="attr">emptyDir:</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>重启机制，RestartPolicy</p>
<p>目前支持三种RestartPolicy</p>
<ul>
<li>Always: 只要退出就重启</li>
<li>OnFailure: 失败退出时重启</li>
<li>Never: 只要退出就不再重启</li>
</ul>
<p>这里的重启指在Pod所在Node本地重启，它不会调度到其它Node上去。</p>
<p>环境变量为容器提供了一些重要的资源，包括容器和Pod的基本信息以及集群中服务的信息等，</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span> </span><br><span class="line">  <span class="attr">name:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-container</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">gcr.io/google_containers/busybox</span></span><br><span class="line">	<span class="attr">command:</span> [ <span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>]</span><br><span class="line">	<span class="attr">args:</span></span><br><span class="line">	<span class="bullet">-</span> <span class="string">env</span></span><br><span class="line">	<span class="attr">resource:</span></span><br><span class="line">	  <span class="attr">requests:</span></span><br><span class="line">	    <span class="attr">memory:</span> <span class="string">&quot;32Mi&quot;</span></span><br><span class="line">		<span class="attr">cpu:</span> <span class="string">&quot;125m&quot;</span></span><br><span class="line">	  <span class="attr">limits:</span></span><br><span class="line">	    <span class="attr">memory:</span> <span class="string">&quot;64Mi&quot;</span></span><br><span class="line">		<span class="attr">cpu:</span> <span class="string">&quot;250m&quot;</span></span><br><span class="line">	<span class="attr">env:</span></span><br><span class="line">	  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MY_NODE_NAME</span></span><br><span class="line">	    <span class="attr">valueFrom:</span></span><br><span class="line">		  <span class="attr">fieldRef:</span></span><br><span class="line">		    <span class="attr">fieldPath:</span> <span class="string">sepc.nodeName</span></span><br><span class="line">	  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MY_POD_NAME</span></span><br><span class="line">	  <span class="attr">valueFrom:</span></span><br><span class="line">	    <span class="attr">fieldRef:</span></span><br><span class="line">		  <span class="attr">fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line">	  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MY_POD_NAMESPACE</span></span><br><span class="line">	    <span class="attr">valueFrom:</span></span><br><span class="line">		  <span class="attr">fieldRef:</span></span><br><span class="line">		    <span class="attr">fieldPath:</span> <span class="string">metadata.namespace</span></span><br><span class="line">	  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MY_POD_SERVICE_ACCOUNT</span></span><br><span class="line">	    <span class="attr">valueFrom:</span></span><br><span class="line">		  <span class="attr">fieldRef:</span></span><br><span class="line">		    <span class="attr">fieldPath:</span> <span class="string">spec.serviceAccountName</span></span><br><span class="line">	  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MY_CPU_REQUEST</span></span><br><span class="line">	    <span class="attr">valueFrom:</span></span><br><span class="line">		<span class="attr">resourceFieldRef:</span></span><br><span class="line">		  <span class="attr">containerName:</span> <span class="string">test-container</span></span><br><span class="line">		  <span class="attr">resource:</span> <span class="string">requests.cpu</span></span><br><span class="line">	  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MY_CPU_LIMIT</span></span><br><span class="line">	    <span class="attr">valueFrom:</span></span><br><span class="line">		  <span class="attr">resourceFieldRef:</span></span><br><span class="line">		    <span class="attr">containerName:</span> <span class="string">test-container</span></span><br><span class="line">			<span class="attr">resource:</span> <span class="string">limits.cpu</span></span><br><span class="line">	  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MY_MEM_REQUEST</span></span><br><span class="line">	    <span class="attr">valueFrom:</span></span><br><span class="line">		  <span class="attr">resourceFieldRef:</span></span><br><span class="line">		    <span class="attr">containerName:</span> <span class="string">test-container</span></span><br><span class="line">			<span class="attr">resource:</span> <span class="string">requests.memory</span></span><br><span class="line">	  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MY_MEM_LIMIT</span></span><br><span class="line">	    <span class="attr">valueFrom:</span></span><br><span class="line">		  <span class="attr">resourceFieldRef:</span></span><br><span class="line">		    <span class="attr">containerName:</span> <span class="string">test-container</span></span><br><span class="line">			<span class="attr">resource:</span> <span class="string">limits.memory</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Never</span></span><br></pre></td></tr></table></figure>
<p>ImagePullPolicy策略，</p>
<ul>
<li>Always: 不管镜像是否存在都会进行一次拉取。</li>
<li>Never：不管镜像是否存在都不会进行拉取。</li>
<li>IfNotPresent: 镜像不存在时，才进行拉取。</li>
</ul>
<p>注意，</p>
<ul>
<li>默认为IfNotPresent，但<code>:latest</code>标签的镜像默认为<code>Always</code>。</li>
<li>拉取镜像时docker会进行MD5校验，如果镜像中的MD5没变，不会拉取镜像数据。</li>
<li>生产环境中应该尽量避免使用<code>:latest</code>标签，而开发环境可以借助<code>:latest</code>标签自动拉取最新的镜像。</li>
</ul>
<p>访问DNS策略，</p>
<p>通过设置dnsPolicy参数，设置Pod中容器访问DNS的策略</p>
<ul>
<li>ClusterFirst: 优先基于cluster domain后缀，通过kube-dns查询</li>
<li>Default：首先从kubelet中配置的DNS查询</li>
</ul>
<p>默认是ClusterFirst</p>
<p>通过hostIPC设置参数为Ture，使用主机的IPC明明空间，默认为False。</p>
<p>通过hostNetwork设置参数为True，使用主机的命名空间，默认为False。</p>
<p>通过hostPID设置参数为True，使用主机的PID命名空间，默认为False。</p>
<p>通过subdomain参数设置Pod的子域名，默认为空</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">busybox2</span></span><br><span class="line"><span class="attr">labels:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">hostname:</span> <span class="string">busybox-2</span></span><br><span class="line"><span class="attr">subdomain:</span> <span class="string">default-subdomain</span></span><br><span class="line"><span class="attr">containers:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">  <span class="attr">command:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">sleep</span></span><br><span class="line">	<span class="bullet">-</span> <span class="string">&quot;3600&quot;</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">busybox</span></span><br></pre></td></tr></table></figure>
<p>kubernetes通过cgroups限制容器的CPU和内存等计算资源，包括requests和limits等：</p>
<ul>
<li><code>spec.containers[].resources.limits.cpu</code>：CPU上限，可以短暂超过，容器也不会被停止</li>
<li><code>spec.containers[].resources.limits.memory</code>：内存上限，不可以超过；如果超过，容器可能会被停止或调度到其它资源充足的机器上</li>
<li><code>spec.containers[].resources.requests.cpu</code>：CPU请求，可以超过</li>
<li><code>spec.containers[].resources.requests.memory</code>：内存请求，可以超过；但如果超过，容器可能会在Node内存不足时清理</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiServersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">	<span class="attr">resources:</span></span><br><span class="line">	  <span class="attr">requests:</span></span><br><span class="line">	    <span class="attr">cpu:</span> <span class="string">&quot;300m&quot;</span></span><br><span class="line">		<span class="attr">memory:</span> <span class="string">&quot;56Mi&quot;</span></span><br><span class="line">	  <span class="attr">limits:</span></span><br><span class="line">	    <span class="attr">cpu:</span> <span class="string">&quot;500m&quot;</span></span><br><span class="line">		<span class="attr">memory:</span> <span class="string">&quot;128Mi&quot;</span></span><br></pre></td></tr></table></figure>
<p>为了保证容器在部署后确实处在正常运行状态，Kubernetes提供了两种探针(probe，支持exec、tcp和httpGet方式)来探测容器的状态：</p>
<ul>
<li>LivenessProbe：探测应用是否处于健康状态，如果不健康则删除重建容器</li>
<li>ReadinessProbe：探测应用是否启动完成并且处于正常服务状态，如果不正常则更新容器状态</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">imagePullPolicy:</span> <span class="string">Always</span></span><br><span class="line">	<span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">	<span class="attr">livenessProbe:</span></span><br><span class="line">	  <span class="attr">httpGet:</span></span><br><span class="line">	  <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">	  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">	  <span class="attr">initialDelaySeconds:</span> <span class="number">15</span></span><br><span class="line">	  <span class="attr">timeoutSeconds:</span> <span class="number">1</span></span><br><span class="line">	<span class="attr">readinessProbe:</span></span><br><span class="line">	  <span class="attr">httpGet:</span></span><br><span class="line">	  <span class="attr">path:</span> <span class="string">/ping</span></span><br><span class="line">	  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">	  <span class="attr">initialDelaySeconds:</span> <span class="number">5</span></span><br><span class="line">	  <span class="attr">timeoutSeconds:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>initContainers在容器执行前运行，常用来初始化容器操作，</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">init-demo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">	<span class="attr">ports:</span></span><br><span class="line">	<span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">	<span class="attr">volumeMounts:</span></span><br><span class="line">	<span class="bullet">-</span> <span class="attr">name:</span> <span class="string">workdir</span></span><br><span class="line">	  <span class="attr">mountPath:</span> <span class="string">/usr/share/nginx/html</span></span><br><span class="line">  <span class="attr">initContainers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busygox</span></span><br><span class="line">	<span class="attr">command:</span></span><br><span class="line">	<span class="bullet">-</span> <span class="string">wget</span></span><br><span class="line">	<span class="bullet">-</span> <span class="string">&quot;-O&quot;</span></span><br><span class="line">	<span class="bullet">-</span> <span class="string">&quot;/work-dir/index.html&quot;</span></span><br><span class="line">	<span class="bullet">-</span> <span class="string">http://kubernetes.io</span></span><br><span class="line">	<span class="attr">volumeMounts:</span></span><br><span class="line">	<span class="bullet">-</span> <span class="attr">name:</span> <span class="string">workdir</span></span><br><span class="line">	  <span class="attr">mountPath:</span> <span class="string">&quot;/work-dir&quot;</span></span><br><span class="line">  <span class="attr">dnsPolicy:</span> <span class="string">Default</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">workdir</span></span><br><span class="line">    <span class="attr">emptyDir:</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>容器生命周期钩子(Container Lifecycle Hooks)监听容器生命周期的特定事件，并在事件发生时执行已注册的回调函数。支持两种钩子：</p>
<ul>
<li>postStart：容器启动后执行，注意由于一步执行，它无法保证一定在ENTRYPOINT之后运行。如果失败，容器会被杀死，并根据RestartPolicy决定是否重启</li>
<li>preStop：容器停止前执行，常用于资源清理。如果失败，容器同样也会被杀死</li>
</ul>
<p>钩子的回调函数支持两种方式：</p>
<ul>
<li>exec: 在容器内执行命令</li>
<li>httpGet：向指定URL发起GET请求</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">lifecycle-demo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">lifecycle-demo-container</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">	<span class="attr">lifecycle:</span></span><br><span class="line">	  <span class="attr">postStart:</span></span><br><span class="line">	    <span class="attr">exec:</span></span><br><span class="line">		  <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span> <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;echo Hello from the postStart handler &gt; /usr/share/message&quot;</span>]</span><br><span class="line">	  <span class="attr">preStop:</span></span><br><span class="line">	    <span class="attr">exec:</span></span><br><span class="line">		  <span class="attr">command:</span> [<span class="string">&quot;/usr/sbin/nginx&quot;</span>, <span class="string">&quot;-s&quot;</span>, <span class="string">&quot;quit&quot;</span>]</span><br></pre></td></tr></table></figure>
<p>默认情况下，容器都是以非特权容器方式运行。比如，不能再容器中创建虚拟网卡、配置虚拟网络。</p>
<p>Kubernetes提供了修改Capabilities的机制，</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">hello-world</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">friendly-container</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">&quot;alpine:3.4&quot;</span></span><br><span class="line">	<span class="attr">command:</span> [<span class="string">&quot;/bin/echo&quot;</span>, <span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>]</span><br><span class="line">	<span class="attr">securityContext:</span></span><br><span class="line">	  <span class="attr">capabilities:</span></span><br><span class="line">	    <span class="attr">add:</span></span><br><span class="line">		<span class="bullet">-</span> <span class="string">NET_ADMIN</span></span><br><span class="line">		<span class="attr">drop:</span></span><br><span class="line">		<span class="bullet">-</span> <span class="string">KILL</span></span><br></pre></td></tr></table></figure>
<p>可以通过给Pod增加 <code>kubernetes.io/ingressbandwidth</code> 和 <code>kubernetes.io/egress-bandwidth</code> 这两个annotation来限制Pod的网络带宽</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">qos</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress-bandwidth:</span> <span class="string">3M</span></span><br><span class="line">	<span class="attr">kubernetes.io/egress-bandwidth:</span> <span class="string">4M</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">iperf3</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">networkstatic/iperf3</span></span><br><span class="line">	<span class="attr">command:</span></span><br><span class="line">	<span class="bullet">-</span> <span class="string">iperf3</span></span><br><span class="line">	<span class="bullet">-</span> <span class="string">-s</span></span><br></pre></td></tr></table></figure>
<p>可以通过nodeSelector、nodeAffinity、podAffinity以及Taints和tolerations等来讲Pod调度到需要的Node上。</p>
<p>也可以通过设置nodeName参数，将Pod调度到制定node节点上。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">env:</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">spec:</span></span><br><span class="line">    <span class="attr">containers:</span></span><br><span class="line">	<span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">	  <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">	  <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">  <span class="attr">nodeSelector:</span></span><br><span class="line">    <span class="attr">disktype:</span> <span class="string">ssd</span></span><br></pre></td></tr></table></figure>
<p>默认情况下，容器的<code>/etc/hosts</code>时kubelet自动生成的，并且仅包含localhost和podName等。不建议直接修改<code>/etc/hosts</code>文件，因为在Pod启动或重启时会被覆盖。</p>
<p>默认的<code>/etc/hosts</code>文件格式如下，其中<code>nginx-4217019353-fb2c5</code>是podName：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl exec nginx-app-5dd4f9fd4d-nm4sx -- cat /etc/hosts</span><br></pre></td></tr></table></figure>
<p><img src="/img/kubernetes/cat-etc-hosts.png" alt="executor"></p>
<p>从v1.7开始，可以通过<code>pod.Spec.HostAliases</code>来增加hosts内容，如，</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">hostaliases-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">hostAliases:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">ip:</span> <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">    <span class="attr">hostnames:</span></span><br><span class="line">	<span class="bullet">-</span> <span class="string">&quot;foo.local&quot;</span></span><br><span class="line">	<span class="bullet">-</span> <span class="string">&quot;bar.local&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">ip:</span> <span class="string">&quot;10.1.2.3&quot;</span></span><br><span class="line">    <span class="attr">hostnames:</span></span><br><span class="line">	<span class="bullet">-</span> <span class="string">&quot;foo.remote&quot;</span></span><br><span class="line">	<span class="bullet">-</span> <span class="string">&quot;bar.remote&quot;</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cat-hosts</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">	<span class="attr">command:</span></span><br><span class="line">	<span class="bullet">-</span> <span class="string">cat</span></span><br><span class="line">	<span class="attr">args:</span></span><br><span class="line">	<span class="bullet">-</span> <span class="string">&quot;/etc/hosts&quot;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs hostaliases-pod</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Kubernetes-managed hosts file.</span></span><br><span class="line">127.0.0.1	localhost</span><br><span class="line">::1	localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0	ip6-localnet</span><br><span class="line">fe00::0	ip6-mcastprefix</span><br><span class="line">fe00::1	ip6-allnodes</span><br><span class="line">fe00::2	ip6-allrouters</span><br><span class="line">10.244.1.35	hostaliases-pod</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Entries added by HostAliases.</span></span><br><span class="line">127.0.0.1	foo.local	bar.local</span><br><span class="line">10.1.2.3	foo.remote	bar.remote</span><br></pre></td></tr></table></figure>
<h2 id="Namespace"><a class="header-anchor" href="#Namespace">¶</a>Namespace</h2>
<p>Namespace是对一组资源和对象的抽象集合，比如可以用来将系统内部的对象划分为不同的项目组或用户组。常见的pods，services，replication controller和deployments等都是属于某一个namespace的(默认是default)，而node，persistentVolumes等则不属于任何namespace。</p>
<p>Namespace常用来隔离不同的用户，比如Kubernetes自带的服务一般运行在<code>kube-system namespace</code>中。</p>
<ol>
<li>查询</li>
</ol>
<p>名称空间的选项可以用<code>--namespace</code>或<code>-n</code>来指定，不指定默认就是<code>default</code>。也可以通过<code>--all-namespace=true</code>来查看所有namespace下的资源。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl get namespaces</span><br><span class="line">NAME          STATUS   AGE</span><br><span class="line">default       Active   32h</span><br><span class="line">kube-public   Active   32h</span><br><span class="line">kube-system   Active   32h</span><br></pre></td></tr></table></figure>
<p>注意：<code>kubectl get namespace</code>等效；namespace包含两种状态“Active”和“Terminating”。在namespace删除过程中，namespace状态被设置成“Terminating”。</p>
<ol start="2">
<li>创建</li>
</ol>
<p>命令行直接创建，</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create namespace new-namespace</span><br></pre></td></tr></table></figure>
<p>通过文件创建，</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">new-namespace</span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f ./my-namespace.yaml</span><br></pre></td></tr></table></figure>
<p>注意：namespace的name满足正则表达式<code>[a-z0-9]([-a-z0-9]*[a-z0-9])?</code>，最大长度为63位，</p>
<ol start="3">
<li>删除</li>
</ol>
<ul>
<li>删除一个namespace会自动删除所有属于该namespace的资源</li>
<li><code>default</code>和<code>kube-system</code>名称空间不可删除</li>
<li>PersistentVolumes是不属于任何namespace的，但PersistentVolumeClaim是属于某个特定namespace的</li>
<li>Events是否属于namespace取决于产生events的对象</li>
</ul>
<h2 id="Node"><a class="header-anchor" href="#Node">¶</a>Node</h2>
<p>Node是Pod真正运行的主机，可以是物理机，也可以是虚拟机。为了管理Pod，每个Node节点上至少运行container runtime(比如docker或rkt)、<code>kubelet</code>和<code>kube-proxy</code>服务。</p>
<p><img src="/img/kubernetes/module_03_nodes.svg" alt="nodes"></p>
<ol>
<li>Node管理</li>
</ol>
<p>不像其它的资源(如Pod和Namespace)，Node本质上不是Kubernetes来创建的，Kubernetes只是管理Node上的资源。虽然可以通过Manifest创建一个Node对象(如下json)，但Kubernetes也只是去检查是否真的是有这么一个Node，如果检查失败，也不会往上调度Pod。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;kind&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Node&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;apiVersion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;v1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;metadata&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10.240.79.157&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;labels&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">	  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my-first-k8s-node&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>这个检查是由Node Controller来完成的。Node Controller负责</p>
<ul>
<li>维护Node状态</li>
<li>与Cloud Provider同步Node</li>
<li>给Node分配容器CIDR</li>
<li>删除带有<code>NoExecute</code> taint的Node上的Pods</li>
</ul>
<p>默认情况下，kubelet在启动时会向master注册自己，并创建Node资源。</p>
<ol start="2">
<li>Node的状态</li>
</ol>
<p>每个Node都包括以下状态信息</p>
<ul>
<li>地址：包括hostname、外网IP和内网IP</li>
<li>条件(Condition)：包括OutOfDisk、Ready、MemoryPressure和DiskPressure</li>
<li>容量(Capacity)：Node上的可用资源，包括CPU、内存和Pod总数</li>
<li>基本信息(Info)：包括内核版本、容器引擎版本、OS类型等</li>
</ul>
<ol start="3">
<li>Taints和tolerations</li>
</ol>
<p>Taints和tolerations用于保证Pod不被调度到不合适的Node上，Taint应用于Node上，而toleration则应用于Pod上(Toleration是可选的)。</p>
<p>比如，可以使用taint命令给node1添加taints：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl taint nodes node1 key1=value1:NoSchedule</span><br><span class="line">kubectl taint nodes node2 key1=value2:NoExecutte</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>Node维护模式</li>
</ol>
<p>标识Node为不可调度，但不影响其上正在运行的Pod，这种维护Node时时非常有用的</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl cordon $NODENAME</span><br></pre></td></tr></table></figure>
</div></article><nav class="article-nav"><div class="article-nav-prev"><a href="/2019/02/06/kubernetes/kubernetes-03-theory-and-concpetion-md/">kubernetes 设计理念及主要概念之Service(三)</a></div><div class="article-nav-next"><a href="/2019/02/03/kubernetes/kubernetes-01-centos-installation/">kubernetes 简介以及安装安装高可用v1.13.1集群(一)</a></div></nav><div id="base-discus"><div id="disqus_thread"></div><script>var disqus_shortname = 'barudisshu-github-io';
var disqus_identifier = '2019/02/04/kubernetes/kubernetes-02-theory-and-concpetion-md/';
var disqus_title = 'kubernetes 设计理念及主要概念之Pod(二)';
var disqus_url = 'https://galudisu.info/2019/02/04/kubernetes/kubernetes-02-theory-and-concpetion-md/';
(function () {
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async>  </script></div></div></div><footer class="base-footer"><div class="footer-wrapper"><span>©2016 - 2025 <a href="https://galudisu.info">barudisshu</a>, unless otherwise noted.</span></div></footer><div class="dom-ready">
<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>

<link rel="stylesheet" href="//cdn.bootcss.com/pace/1.0.2/themes/green/pace-theme-flash.min.css">

<script src="/js/base.js"></script>

<script src="/js/rabbit-lyrics.js"></script>
</div></body></html>