<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><title>kubernetes è®¾è®¡ç†å¿µåŠä¸»è¦æ¦‚å¿µä¹‹Volume(å››)</title>
<link rel="stylesheet" href="/css/layout.css">
<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="/css/vendors/rabbit-lyrics.css">
<link rel="shortcut icon" href="/img/favicon.ico"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ç®€å•æ˜“æ‡‚ã®ç°ä»£é­”æ³•" type="application/atom+xml">
</head><body><header class="base-menu"><div class="menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">ç®€å•æ˜“æ‡‚ã®ç°ä»£é­”æ³•</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav></div></header><header class="base-mobile-menu"><div class="mobile-menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">ç®€å•æ˜“æ‡‚ã®ç°ä»£é­”æ³•</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav><div class="toggle-menu" id="mobile-menu-toggle"><span class="menu-bar"></span><span class="menu-bar"> </span><span class="menu-bar"></span></div></div></header><div class="base-content"><div class="base-content-main"><article class="article-main"><h1 class="article-title">kubernetes è®¾è®¡ç†å¿µåŠä¸»è¦æ¦‚å¿µä¹‹Volume(å››)</h1><div class="article-meta"><p class="meta-item meta-time"><span class="meta-item-title"></span><i class="icon-calendar"> </i>2019-02-08</p><p class="meta-item meta-tag"><span class="meta-item-title"></span><i class="icon-tag"> </i><a class="tag-link" href="/tags/kubernetes/">kubernetes</a></p></div><div class="article-content"><h2 id="Kuberneteså­˜å‚¨å·"><a class="header-anchor" href="#Kuberneteså­˜å‚¨å·">Â¶</a>Kuberneteså­˜å‚¨å·</h2>
<p>é»˜è®¤æƒ…å†µä¸‹å®¹å™¨çš„æ•°æ®éƒ½æ˜¯éæŒä¹…åŒ–çš„ï¼Œåœ¨å®¹å™¨æ¶ˆäº¡ä»¥åæ•°æ®ä¹Ÿè·Ÿç€ä¸¢å¤±ï¼Œæ‰€ä»¥Dockeræä¾›äº†Volumeæœºåˆ¶ä»¥ä¾¿å°†æ•°æ®æŒä¹…åŒ–å­˜å‚¨ã€‚ç±»ä¼¼çš„ï¼ŒKubernetesæä¾›äº†æ›´å¼ºå¤§çš„Volumeæœºåˆ¶å’Œä¸°å¯Œçš„æ’ä»¶ï¼Œè§£å†³äº†å®¹å™¨æ•°æ®æŒä¹…åŒ–å’Œå®¹å™¨é—´å…±äº«æ•°æ®çš„é—®é¢˜ã€‚</p>
<p>ä¸Dockerä¸åŒï¼ŒKubernetes Volumeçš„ç”Ÿå‘½å‘¨æœŸä¸Podç»‘å®š</p>
<ul>
<li>å®¹å™¨æŒ‚æ‰åKubeletå†æ¬¡é‡å¯å®¹å™¨æ—¶ï¼ŒVolumeçš„æ•°æ®ä¾ç„¶è¿˜åœ¨</li>
<li>è€ŒPodåˆ é™¤æ—¶ï¼ŒVolumeæ‰ä¼šæ¸…ç†ã€‚æ•°æ®æ˜¯å¦ä¸¢å¤±å–å†³äºå…·ä½“çš„Volumeç±»å‹ï¼Œæ¯”å¦‚emptyDirçš„æ•°æ®ä¼šä¸¢å¤±ï¼Œè€ŒPVçš„æ•°æ®ä¸ä¼šä¸¢å¤±</li>
</ul>
<span id="more"></span>
<ol>
<li>Volumeç±»å‹</li>
</ol>
<p>ç›®å‰ï¼ŒKubernetesæ”¯æŒä»¥ä¸‹Volumeç±»å‹ï¼š</p>
<ul>
<li>emptyDir</li>
<li>hostPath</li>
<li>gcePersistentDisk</li>
<li>awsElasticBlokStore</li>
<li>nfs</li>
<li>iscsi</li>
<li>flocker</li>
<li>glusterfs</li>
<li>rbd</li>
<li>cephfs</li>
<li>gitRepo</li>
<li>secret</li>
<li>persistentVolumeClaim</li>
<li>downwardAPI</li>
<li>azureFileVolume</li>
<li>vsphereVolume</li>
<li>Quobyte</li>
<li>PortworxVolume</li>
<li>ScaleIO</li>
<li>FlexVolume</li>
<li>StorageOS</li>
<li>local</li>
</ul>
<p>è¿™äº›Volumeå¹¶éå…¨éƒ¨éƒ½æ˜¯æŒä¹…åŒ–çš„ï¼ŒemptyDirä¸hostPathæ•°æ®èŠ‚ç‚¹çº§åˆ«çš„å·ç±»å‹ï¼ŒemptyDirçš„ç”Ÿå‘½å‘¨æœŸä¸Podèµ„æºç›¸åŒï¼Œè€Œä½¿ç”¨hostPathå·çš„Podä¸€æ—¦è¢«é‡æ–°è°ƒåº¦è‡³å…¶ä»–èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå®ƒå°†æ— æ³•å†ä½¿ç”¨æ­¤å‰çš„æ•°æ®ã€‚</p>
<p>å†å¦‚ï¼ŒSecretå’ŒConfigMapç®—å¾—ä¸Šæ˜¯ä¸¤ç§ç‰¹æ®Šçš„å·ç±»å‹ã€‚</p>
<ul>
<li>
<p>Secretç”¨äºå‘Podä¼ é€’æ•æ„Ÿä¿¡æ¯ã€å¦‚å¯†ç ã€ç§é’¥ã€è¯ä¹¦æ–‡ä»¶ç­‰ï¼Œè¿™äº›ä¿¡æ¯å¦‚æœç›´æ¥å®šä¹‰åœ¨é•œåƒä¸­å¾ˆå®¹æ˜“å¯¼è‡´æ³„éœ²ï¼Œæœ‰äº†Secretèµ„æºï¼Œç”¨æˆ·å¯ä»¥å°†è¿™äº›ä¿¡æ¯å­˜å‚¨äºé›†ç¾¤ä¸­è€Œåå†ç”±Podè¿›è¡ŒæŒ‚è½½ï¼Œä»è€Œå®ç°å°†æ•æ„Ÿæ•°æ®ä¸ç³»ç»Ÿè§£è€¦ã€‚</p>
</li>
<li>
<p>ConfigMapèµ„æºåˆ™ç”¨äºå‘Podæ³¨å…¥éæ•æ„Ÿæ•°æ®ï¼Œä½¿ç”¨æ—¶ï¼Œç”¨æˆ·å°†æ•°æ®ç›´æ¥å­˜å‚¨äºConfigMapå¯¹è±¡ä¸­ï¼Œè€Œåç›´æ¥åœ¨Podä¸­ä½¿ç”¨ConfigMapå·å¼•ç”¨å®ƒå³å¯ï¼Œå®ƒå¯ä»¥å¸®åŠ©å®ç°å®¹å™¨é…ç½®æ–‡ä»¶é›†ä¸­åŒ–å®šä¹‰å’Œç®¡ç†ã€‚</p>
</li>
</ul>
<p>å› æ­¤ï¼Œç±»ä¼¼äºemptyDirã€hostPathã€secretã€gitRepoç­‰ï¼Œè¿™äº›Volumeä¼šéšç€Podçš„æ¶ˆäº¡è€Œæ¶ˆå¤±ã€‚</p>
<ol start="2">
<li>Volumeçš„ä½¿ç”¨</li>
</ol>
<p>åœ¨Podä¸­å®šä¹‰Volumeç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šä¸€æ˜¯<code>.spec.valumes</code>ï¼Œç”¨äºæ”¯æŒä¸åŒçš„Volumeç±»å‹ï¼›äºŒæ˜¯<code>.spec.containers.volumeMounts</code>ï¼Œç”¨äºå®šä¹‰æŒ‚è½½åˆ—è¡¨ã€‚</p>
<p>åœ¨Podçº§åˆ«å®šä¹‰Volumeï¼Œ<code>.spec.volumes</code>å­—æ®µå¯ä»¥å®šä¹‰å¤šä¸ªVolumeï¼Œä¾‹å¦‚ä¸‹é¢å®šä¹‰äº†emptyDirç±»å‹å’ŒgitRepoç±»å‹ï¼Œ</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">logdata</span></span><br><span class="line">  <span class="attr">emptyDir:</span> &#123;&#125;</span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">example</span></span><br><span class="line">  <span class="attr">gitRepo:</span></span><br><span class="line"> <span class="attr">repository:</span> <span class="string">https://github.com/barudisshu/kubernetes-pratise.git</span></span><br><span class="line"> <span class="attr">revision:</span> <span class="string">master</span></span><br><span class="line"> <span class="attr">directory:</span> <span class="string">.</span></span><br></pre></td></tr></table></figure>
<p>å®šä¹‰å¥½çš„Volumeå¯ä»¥å…±äº«ã€‚å½“Podä¸­åªæœ‰ä¸€ä¸ªå®¹å™¨æ—¶ï¼Œä½¿ç”¨å­˜å‚¨å·é€šå¸¸ç”¨äºæ•°æ®æŒä¹…åŒ–ã€‚</p>
<p><code>.spec.containers.volumeMounts</code>å­—æ®µå®šä¹‰äº†Volumeçš„æŒ‚è½½åˆ—è¡¨ã€‚å®ƒçš„æŒ‚è½½æ ¼å¼æ˜¯å›ºå®šçš„ï¼Œå¦‚ä¸‹ï¼Œ</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="attr">spec:</span></span><br><span class="line">   <span class="string">...</span></span><br><span class="line">   <span class="attr">containers:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&lt;String&gt;</span></span><br><span class="line"> <span class="string">...</span></span><br><span class="line"> <span class="attr">volumeMounts:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">name</span> <span class="string">&lt;String&gt;</span> <span class="string">-required-</span></span><br><span class="line">   <span class="string">mountPath</span> <span class="string">&lt;string&gt;</span> <span class="string">-required-</span></span><br><span class="line"><span class="string">readOnly</span> <span class="string">&lt;boolean&gt;</span></span><br><span class="line"><span class="string">subPath</span> <span class="string">&lt;string&gt;</span></span><br><span class="line"><span class="string">montPropagation</span> <span class="string">&lt;string&gt;</span></span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œ</p>
<ul>
<li>name<string>ï¼šæŒ‡å®šè¦æŒ‚è½½çš„å­˜å‚¨çš„åç§°ï¼Œå¿…é€‰</li>
<li>mountPath<string>ï¼šæŒ‚è½½ç‚¹è·¯å¾„ï¼Œå®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸Šçš„è·¯å¾„ï¼Œå¿…é€‰</li>
<li>readOnly<boolean>ï¼šæ˜¯å¦æŒ‚è½½ä¸ºåªè¯»</li>
<li>subPath<string>ï¼šå­è·¯å¾„ï¼Œå³mountPathæŒ‡å®šçš„è·¯å¾„ä¸‹çš„ä¸€ä¸ªå­—è·¯å¾„</li>
</ul>
<p>ä¾‹å¦‚ï¼Œå®¹å™¨myappå°†logdataå­˜å‚¨å·æŒ‚è½½åœ¨/var/log/myappï¼Œå°†exampleæŒ‚è½½åˆ°/webdata/exampleç›®å½•ï¼Œ</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">containers:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp</span></span><br><span class="line"><span class="attr">image:</span> <span class="string">ikubernetes/myapp:v7</span></span><br><span class="line"><span class="attr">volumeMounts:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">logdata</span></span><br><span class="line">    <span class="attr">mountPath:</span> <span class="string">/var/log/myapp/</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">example</span></span><br><span class="line">    <span class="attr">mountPath:</span> <span class="string">/webdata/example/</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>emptyDir</li>
</ol>
<p>emptyDirï¼Œå¦‚æœPodè®¾ç½®äº†emptyDirç±»å‹Volumeï¼ŒPodè¢«åˆ†é…åˆ°Nodeä¸Šæ—¶å€™ï¼Œä¼šåˆ›å»ºemptyDirï¼Œåªè¦Podè¿è¡Œåœ¨Nodeä¸Šï¼ŒemptyDiréƒ½ä¼šå­˜åœ¨(å®¹å™¨æŒ‚æ‰ä¸ä¼šå¯¼è‡´emptyDirä¸¢å¤±æ•°æ®)ï¼Œä½†æ˜¯å¦‚æœPodä»Nodeä¸Šè¢«åˆ é™¤(Podè¢«åˆ é™¤ï¼Œæˆ–è€…Podå‘ç”Ÿè¿ç§»)ï¼ŒemptyDirä¹Ÿä¼šè¢«åˆ é™¤ï¼Œå¹¶ä¸”æ°¸ä¹…ä¸¢å¤±ã€‚</p>
<p><code>.spec.volumes.emptyDir</code>åµŒå¥—å­—æ®µåŒ…å«æœ‰ï¼Œ</p>
<ul>
<li>mediumï¼šå­˜å‚¨ä»‹è´¨çš„ç±»å‹ï¼Œé»˜è®¤ä¸ºdefault,è¡¨ç¤ºä¸ºä½¿ç”¨èŠ‚ç‚¹é»˜è®¤å­˜å‚¨ä»‹è´¨ï¼›å¦ä¸€ç§æ˜¯Memoryï¼Œè¡¨ç¤ºä½¿ç”¨RAMçš„ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿtmpfsï¼Œç©ºé—´å—é™äºå†…å­˜ï¼Œä½†æ€§èƒ½éå¸¸å¥½ï¼Œé€šå¸¸ç”¨äºä½œä¸ºç¼“å­˜ã€‚</li>
<li>sizeLimitï¼šå½“å‰Volumeçš„ç©ºé—´é™é¢ï¼Œé»˜è®¤ä¸ºnilï¼Œè¡¨ç¤ºä¸é™åˆ¶ï¼›ä¸è¿‡å¦‚æœmediumå­—æ®µå€¼ä¸ºMemoryæ—¶å»ºè®®å®šä¹‰é™é¢ã€‚</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">vol-emptydir-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">html</span></span><br><span class="line">      <span class="attr">emptyDir:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">vol-emptydir-pod</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">nginx:1.12-alpine</span></span><br><span class="line">      <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">      <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/usr/share/nginx/html</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">html</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pagegen</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">alpine</span></span><br><span class="line">      <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/html</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">html</span></span><br><span class="line">      <span class="attr">command:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;/bin/sh&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;-c&quot;</span></span><br><span class="line">      <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">while</span> <span class="literal">true</span><span class="string">;</span> <span class="string">do</span></span><br><span class="line">            <span class="string">echo</span> <span class="string">$(hostname)</span> <span class="string">$(date)</span> <span class="string">&gt;&gt;</span> <span class="string">/html/index.html;</span></span><br><span class="line">            <span class="string">sleep</span> <span class="number">10</span><span class="string">;</span></span><br><span class="line">          <span class="string">done</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br></pre></td></tr></table></figure>
<p>å®¹å™¨pagegenæ¯éš”10ç§’å‘Volumeä¸Šçš„index.htmlæ–‡ä»¶è¿½åŠ ä¸€è¡Œä¿¡æ¯ï¼Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pods vol-emptydir-pod</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºServiceæˆ–ç›´æ¥åœ¨é›†ç¾¤è®¿é—®Podçš„ä¿¡æ¯ï¼Œå¯çœ‹åˆ°ï¼Œ</p>
<p><img src="/img/kubernetes/pagegen-vol.png" alt=""></p>
<p>è¾¹è½¦(sidecar)å®¹å™¨pagegenæ¯éš”10ç§’ç”Ÿæˆä¸€è¡Œä¿¡æ¯è¿½åŠ åˆ°Volumeä¸Šçš„index.htmlæ–‡ä»¶ã€‚å¦å¤–emptyDirå­˜å‚¨å·å¯ä»¥åŸºäºRAMåˆ›å»ºtmpfsæ–‡ä»¶ç³»ç»Ÿçš„å­˜å‚¨å·ï¼Œå¸¸ç”¨äºç¼“å­˜ï¼Œ</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumes:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cache</span></span><br><span class="line">  <span class="attr">emptyDir:</span></span><br><span class="line"> <span class="attr">medium:</span> <span class="string">Memory</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>gitRepo</li>
</ol>
<p>gitRepoå­˜å‚¨å·æ˜¯emptyDirçš„å®é™…åº”ç”¨ï¼Œå®ƒçœ‹åšæ˜¯å°†ä¸€ä»½Gitä»“å‚¨ä¸­çš„æ•°æ®å…‹éš†(clone)åˆ°åˆ›å»ºçš„ç©ºç›®å½•(emptyDir)ï¼Œè€Œåå†åˆ›å»ºå®¹å™¨å¹¶æŒ‚è½½è¯¥å­˜å‚¨å·ã€‚</p>
<p>gitRepoå­˜å‚¨å·è‡ªKubernetes1.12å¼€å§‹å·²ç»åºŸå¼ƒï¼Œæ‰€ä»¥è¿™é‡Œä¸å†é™ˆè¿°ã€‚</p>
<ol start="5">
<li>hostPath</li>
</ol>
<p>hostPathè¿è¡ŒæŒ‚è½½Nodeä¸Šçš„æ–‡ä»¶ç³»ç»Ÿåˆ°Podé‡Œé¢å»ã€‚å¦‚æœPodéœ€è¦ä½¿ç”¨Nodeä¸Šçš„æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨hostPathã€‚å› ä¸ºå®ƒç‹¬ç«‹äºPodèµ„æºçš„ç”Ÿå‘½å‘¨æœŸï¼Œå› è€Œå…·æœ‰æŒä¹…æ€§ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">vol-hostpath-pod</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">vol-hostpath-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">vol-hostpath-pod</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">ikubernetes/filebeat:5.6.7-alpine</span></span><br><span class="line">      <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">REDIS_HOST</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">redis.kubernetes.io:6379</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">LOG_LEVEL</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">info</span></span><br><span class="line">      <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/var/log</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">varlog</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/var/run/docker.sock</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">socket</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/var/lib/docker/containers</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">varlibdockercontainers</span></span><br><span class="line">          <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line">  <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">30</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">varlog</span></span><br><span class="line">      <span class="attr">hostPath:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/var/log</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">varlibdockercontainers</span></span><br><span class="line">      <span class="attr">hostPath:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/var/lib/docker/containers</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">socket</span></span><br><span class="line">      <span class="attr">hostPath:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/var/run/docker.sock</span></span><br></pre></td></tr></table></figure>
<p>è¿™ç±»Podèµ„æºé€šå¸¸å—æ§äºdaemonsetç±»å‹çš„Podæ§åˆ¶å™¨ï¼Œå®ƒè¿è¡Œäºé›†ç¾¤ä¸­çš„æ¯ä¸ªå·¥ä½œèŠ‚ç‚¹ä¹‹ä¸Šï¼Œè´Ÿè´£æ”¶é›†å·¥ä½œèŠ‚ç‚¹ä¸Šç³»ç»Ÿçº§çš„ç›¸å…³æ•°æ®ï¼Œå› æ­¤ä½¿ç”¨hostPathå­˜å‚¨å·ã€‚è¿™é‡Œçš„filebeatåº”ç”¨æ¶æ„ä¸­ï¼Œé€šè¿‡Redisè¿›è¡Œèµ„æºæ”¶é›†ï¼Œè¿™äº›æ”¶é›†çš„æ—¥å¿—ä¿¡æ¯ä¼šå‘å¾€ELKè¿›è¡Œç»Ÿè®¡å±•ç¤ºã€‚</p>
<p>hostPathä¸Šå¦‚æœæ˜¯ä¸å—æ§äºDaemonsetçš„æ— çŠ¶æ€åº”ç”¨ï¼Œé‡æ–°è°ƒåº¦èŠ‚ç‚¹è¿è¡Œæ—¶ï¼Œæ— æ³•ç¡®ä¿æ­¤å‰åˆ›å»ºçš„æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨ã€‚å› æ­¤ï¼ŒhostPathè™½èƒ½æŒä¹…åŒ–æ•°æ®ï¼Œä½†å¯¹è°ƒåº¦å™¨æ¥è¯´å¹¶ä¸é€‚ç”¨ï¼Œè¿™æ—¶éœ€è¦ç”¨åˆ°ç‹¬ç«‹äºé›†ç¾¤èŠ‚ç‚¹çš„æŒä¹…åŒ–å­˜å‚¨å·ï¼Œå³ç½‘ç»œå­˜å‚¨å·ã€‚</p>
<blockquote>
<p>ç½‘ç»œå­˜å‚¨å·ï¼Œå°±æ˜¯ç±»ä¼¼äºNASæˆ–SANè®¾å¤‡ã€åˆ†å¸ƒå¼å­˜å‚¨(GlusterFSã€RBD)ã€äº‘ç«¯å­˜å‚¨(gcePersistentDiskã€azureDiskã€cinderå’ŒawsElasticBlockStore)ä»¥åŠæ„å»ºåœ¨å„ç±»å­˜å‚¨ç³»ç»Ÿä¹‹ä¸Šçš„æŠ½è±¡ç®¡ç†å±‚(flockerã€portworx Volumeå’Œvsphere Volume)ç­‰è¿™ç±»ç½‘ç»œæœåŠ¡å­˜å‚¨ã€‚</p>
</blockquote>
<ol start="6">
<li>NFS</li>
</ol>
<p>NFSï¼Œå³Network File Systemï¼Œç½‘ç»œæ–‡ä»¶ç³»ç»Ÿã€‚Kubernetesä¸­é€šè¿‡ç®€å•é…ç½®å¯ä»¥æŒ‚åœ¨NFSåˆ°Podä¸­ï¼Œè€ŒNFSä¸­çš„æ•°æ®æ˜¯å¯ä»¥æ°¸ä¹…ä¿å­˜çš„ï¼ŒåŒæ—¶NFSæ”¯æŒåŒæ—¶å†™æ“ä½œã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">vol-nfs-pod</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">vol-nfs-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">vol-nfs-pod</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">redis:4-alpine</span></span><br><span class="line">      <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">6379</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">redisport</span></span><br><span class="line">      <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/data</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">redisdata</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redisdata</span></span><br><span class="line">      <span class="attr">nfs:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/data/redis</span></span><br><span class="line">        <span class="attr">server:</span> <span class="string">nfs.kubernetes.io</span></span><br><span class="line">        <span class="attr">readOnly:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<ol start="7">
<li>RBD</li>
</ol>
<p>Ceph RBD<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€å¼¹æ€§å¯æ‰©å±•çš„ã€é«˜å¯é çš„ã€æ€§èƒ½ä¼˜å¼‚çš„å­˜å‚¨ç³»ç»Ÿå¹³å°ã€‚è¦é…ç½®Podèµ„æºä½¿ç”¨RBDå­˜å‚¨å·ï¼Œå‰ææ¡ä»¶è¦æ»¡è¶³ï¼š</p>
<ul>
<li>Ceph RBDå­˜å‚¨é›†ç¾¤ï¼Œ</li>
<li>Ceph RBDé›†ç¾¤ä¸­åˆ›å»ºæœ‰æ»¡è¶³Podèµ„æºæ•°æ®ç”¨åˆ°çš„å­˜å‚¨image</li>
<li>Kubernetesé›†ç¾¤å†…å„ä¸ªèŠ‚ç‚¹éœ€è¦å®‰è£…Cephå®¢æˆ·ç«¯ç¨‹åºåŒ…(ceph-common)</li>
</ul>
<p>å®ƒçš„å­—æ®µä¿¡æ¯æœ‰ï¼Œ</p>
<ul>
<li><code>monitors&lt;[]string&gt;</code>ï¼šCephå­˜å‚¨ç›‘è§†å™¨ï¼Œé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼›å¿…é€‰å­—æ®µ</li>
<li><code>image&lt;string&gt;</code>ï¼šrados imageçš„åç§°ï¼Œå¿…é€‰å­—æ®µ</li>
<li><code>pool&lt;string&gt;</code>ï¼šradoså­˜å‚¨æ± åç§°ï¼Œé»˜è®¤ä¸ºRBD</li>
<li><code>user&lt;string&gt;</code>ï¼šradosç”¨æˆ·åï¼Œé»˜è®¤ä¸ºadmin</li>
<li><code>keyring&lt;string&gt;</code>ï¼šRBDç”¨æˆ·è®¤è¯æ—¶ä½¿ç”¨çš„keyringæ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤ä¸º<code>/etc/ceph/keyring</code></li>
<li><code>secretRef&lt;Object&gt;</code>ï¼šRBDç”¨æˆ·è®¤è¯æ—¶ä½¿ç”¨çš„ä¿å­˜æœ‰ç›¸åº”è®¤è¯ä¿¡æ¯çš„Secretå¯¹è±¡ï¼Œä¼šè¦†ç›–ç”±keyringå­—æ®µæä¾›çš„å¯†é’¥ä¿¡æ¯</li>
<li><code>readOnly&lt;boolean&gt;</code>ï¼šæ˜¯å¦ä»¥åªè¯»çš„æ–¹å¼è¿›è¡Œè®¿é—®</li>
<li><code>fsType</code>ï¼šè¦æŒ‚è½½çš„å­˜å‚¨å·çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼Œè‡³å°‘åº”è¯¥æ˜¯èŠ‚ç‚¹æ“ä½œç³»ç»Ÿæ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚ext4ã€xfsã€ntfç­‰ï¼Œé»˜è®¤ä¸ºext4</li>
</ul>
<p>ä¸‹é¢æ˜¯ä½¿ç”¨RBDå­˜å‚¨å·çš„Podèµ„æºç¤ºä¾‹ï¼Œ</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ceph-secret</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">&quot;kubernetes.io/rbd&quot;</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">key:</span> <span class="string">QVFENnNsNWMrQm52T2hBQXVYclJVeVNuUzBhOXVUVk00WnpiVFE9PQ==</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">storage.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StorageClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ceph-rbd</span></span><br><span class="line"><span class="attr">provisioner:</span> <span class="string">kubernetes.io/rbd</span></span><br><span class="line"><span class="attr">parameters:</span></span><br><span class="line">  <span class="attr">monitors:</span> <span class="number">192.168</span><span class="number">.50</span><span class="number">.32</span><span class="string">,192.168.50.33,192.168.50.34</span></span><br><span class="line">  <span class="attr">adminId:</span> <span class="string">admin</span></span><br><span class="line">  <span class="attr">adminSecretName:</span> <span class="string">ceph-secret</span></span><br><span class="line">  <span class="attr">pool:</span> <span class="string">kube</span></span><br><span class="line">  <span class="attr">userId:</span> <span class="string">admin</span></span><br><span class="line">  <span class="attr">userSecretName:</span> <span class="string">ceph-secret</span></span><br><span class="line">  <span class="attr">fsType:</span> <span class="string">xfs</span></span><br><span class="line">  <span class="attr">imageFormat:</span> <span class="string">&quot;2&quot;</span></span><br><span class="line">  <span class="attr">imageFeatures:</span> <span class="string">&quot;layering&quot;</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">vol-rbd-pod</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">vol-rbd-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">vol-rbd-pod</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">redis:4-alpine</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">6379</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">redisport</span></span><br><span class="line">      <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/data</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">redis-rbd-vol</span></span><br><span class="line">      <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-rbd-vol</span></span><br><span class="line">      <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">        <span class="attr">claimName:</span> <span class="string">ceph-claim</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ceph-claim</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOne</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">2Gi</span></span><br></pre></td></tr></table></figure>
<p>è¯¥ç¤ºä¾‹ä¾èµ–äºäº‹å…ˆå­˜åœ¨çš„ä¸€ä¸ªCephå­˜å‚¨é›†ç¾¤ï¼Œè¿™é‡Œå‡è®¾å…¶ç›‘è§†å™¨çš„åœ°å€ä¸º192.168.50.32ã€192.168.50.33ã€192.168.50.34ä¸‰ä¸ªä¸»æœºï¼Œå¹¶ä¸”é›†ç¾¤ä¸Šçš„å­˜å‚¨æ± kubeä¸­å­˜åœ¨åˆ›å»ºå¥½çš„æ˜ åƒRedisï¼Œæ­¤æ˜ åƒæ‹¥æœ‰xfsæ–‡ä»¶ç³»ç»Ÿã€‚Cephå®¢æˆ·ç«¯è®¿é—®é›†ç¾¤æ—¶éœ€è¦äº‹å…ˆå®Œæˆè®¤è¯ä¹‹åæ‰èƒ½è¿›è¡Œåç»­è®¿é—®æ“ä½œï¼Œè®¤è¯ä¿¡æ¯ä¿å­˜äºåä¸ºceph-secretçš„Secretèµ„æºå¯¹è±¡ä¸­ã€‚</p>
<p>æ›´å¤šå…³äºrephçš„é…ç½®æ–¹å¼ï¼Œå‚è€ƒ<a target="_blank" rel="noopener" href="https://jimmysong.io/kubernetes-handbook/practice/using-ceph-for-persistent-storage.html">è¿™é‡Œ</a>ã€‚</p>
<ol start="8">
<li>GlusterFS å­˜å‚¨å·</li>
</ol>
<p>GlusterFS(Gluster File System)æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œæ˜¯æ°´å¹³æ‰©å±•å­˜å‚¨è§£å†³æ–¹æ¡ˆGlusterçš„æ ¸å¿ƒï¼Œå…·æœ‰å¼ºå¤§çš„æ¨ªå‘æ‰©å±•èƒ½åŠ›ï¼ŒGlusterFSé€šè¿‡æ‰©å±•èƒ½å¤Ÿæ”¯æŒæ•°PBå­˜å‚¨å®¹é‡å’Œå¤„ç†æ•°åƒå®¢æˆ·ç«¯ã€‚è¦é…ç½®Podèµ„æºä½¿ç”¨GlusterFSå­˜å‚¨å·ï¼Œéœ€è¦äº‹å…ˆæ»¡è¶³ä»¥ä¸‹å‰ææ¡ä»¶ã€‚</p>
<ul>
<li>å­˜åœ¨æŸä¸ªå¯ç”¨é›†ç¾¤ï¼Œ</li>
<li>åœ¨GlusterFSé›†ç¾¤åˆ›å»ºäº†Podéœ€è¦ä½¿ç”¨çš„Volumeï¼Œ</li>
<li>Kubernetesé›†ç¾¤å„ä¸ªèŠ‚ç‚¹å®‰è£…GlusterFSå®¢æˆ·ç«¯ç¨‹åºåŒ…(glusterfså’Œglusterfs-fuse),</li>
</ul>
<p>Podå®šä¹‰GlusterFSç±»å‹Volumeï¼ŒåŒ…å«çš„å­—æ®µæœ‰ï¼Œ</p>
<ul>
<li><code>endpoint&lt;string&gt;</code>ï¼šè®¿é—®å…¥å£ï¼Œå¿…é€‰å­—æ®µï¼Œ</li>
<li><code>path&lt;string&gt;</code>ï¼šç”¨åˆ°GlusterFSé›†ç¾¤çš„å·è·¯å¾„ï¼Œ</li>
<li><code>readOnly&lt;boolean&gt;</code>ï¼šæ˜¯å¦ä¸ºåªè¯»å·ï¼Œ</li>
</ul>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®šä¹‰åœ¨vol-glusterfs.yamlé…ç½®æ–‡ä»¶ä¸­çš„Podèµ„æºç¤ºä¾‹ï¼Œå®ƒä½¿ç”¨äº†GlusterFSå­˜å‚¨å·æŒä¹…ä¿å­˜åº”ç”¨æ•°æ®ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">vol-glusterfs-pod</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">vol-glusterfs-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">redis:alpine</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">6379</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">redisport</span></span><br><span class="line">      <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/data</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">redisdata</span></span><br><span class="line">      <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redisdata</span></span><br><span class="line">      <span class="attr">glusterfs:</span></span><br><span class="line">        <span class="attr">endpoints:</span> <span class="string">glusterfs-endpoints</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">kube-redis</span></span><br><span class="line">        <span class="attr">readOnly:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br></pre></td></tr></table></figure>
<p>å¦å¤–åˆ›å»ºEndpointsèµ„æºglusterfs-endpointsï¼Œä»¥ç”¨äºPodèµ„æºè®¿é—®ï¼Œ</p>
<div id="footnotes"><hr><div id="footnotelist"><ol><li id="fn:1"><a href="/2019/02/08/ceph/quickly-build-a-new-ceph-cluster-with-ceph-deploy-on-centos-7/">Cephé›†ç¾¤å®‰è£…</a><a href="#fnref:1" rev="footnote"> â†©</a></li></ol></div></div></div></article><nav class="article-nav"><div class="article-nav-prev">ğŸ”™<a href="/2019/02/08/ceph/quickly-build-a-new-ceph-cluster-with-ceph-deploy-on-centos-7/">åœ¨CentOS7å¿«é€Ÿæ„å»ºCephé›†ç¾¤</a></div><div class="article-nav-next">ğŸ”œ<a href="/2019/02/06/kubernetes/kubernetes-03-theory-and-concpetion-md/">kubernetes è®¾è®¡ç†å¿µåŠä¸»è¦æ¦‚å¿µä¹‹Service(ä¸‰)</a></div></nav><div id="base-discus"><div id="disqus_thread"></div><script>var disqus_shortname = 'barudisshu-github-io';
var disqus_identifier = '2019/02/08/kubernetes/kubernetes-04-theory-and-concpetion-md/';
var disqus_title = 'kubernetes è®¾è®¡ç†å¿µåŠä¸»è¦æ¦‚å¿µä¹‹Volume(å››)';
var disqus_url = 'https://galudisu.info/2019/02/08/kubernetes/kubernetes-04-theory-and-concpetion-md/';
(function () {
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async>  </script></div></div></div><footer class="base-footer"><div class="footer-wrapper"><span>Â©2016 - 2025 <a href="https://galudisu.info">barudisshu</a>, unless otherwise noted.</span></div></footer><div class="dom-ready">
<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>

<link rel="stylesheet" href="//cdn.bootcss.com/pace/1.0.2/themes/green/pace-theme-flash.min.css">

<script src="/js/base.js"></script>

<script src="/js/rabbit-lyrics.js"></script>
</div></body></html>