<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><title>CentOS 7 å®‰è£…ã€é…ç½®ã€ä½¿ç”¨PostgreSQLåŠPostGIS</title>
<link rel="stylesheet" href="/css/layout.css">
<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="/css/vendors/rabbit-lyrics.css">
<link rel="shortcut icon" href="/img/favicon.ico"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ç®€å•æ˜“æ‡‚ã®ç°ä»£é­”æ³•" type="application/atom+xml">
</head><body><header class="base-menu"><div class="menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">ç®€å•æ˜“æ‡‚ã®ç°ä»£é­”æ³•</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav></div></header><header class="base-mobile-menu"><div class="mobile-menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">ç®€å•æ˜“æ‡‚ã®ç°ä»£é­”æ³•</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav><div class="toggle-menu" id="mobile-menu-toggle"><span class="menu-bar"></span><span class="menu-bar"> </span><span class="menu-bar"></span></div></div></header><div class="base-content"><div class="base-content-main"><article class="article-main"><h1 class="article-title">CentOS 7 å®‰è£…ã€é…ç½®ã€ä½¿ç”¨PostgreSQLåŠPostGIS</h1><div class="article-meta"><p class="meta-item meta-time"><span class="meta-item-title"></span><i class="icon-calendar"> </i>2019-01-24</p><p class="meta-item meta-tag"><span class="meta-item-title"></span><i class="icon-tag"> </i><a class="tag-link" href="/tags/postgreSQL/">postgreSQL</a></p><p class="meta-item meta-category"><span class="meta-item-title"></span><i class="icon-bookmark"> </i><a class="category-link" href="/categories/sql/">sql</a></p></div><div class="article-content"><p>å®é™…å¼€å‘è¿‡ç¨‹æœ‰ä¸¤ç§å®‰è£…æ–¹å¼ï¼Œä¸€ç§æ˜¯ç¼–è¯‘å®‰è£…ï¼›ä¸€ç§æ˜¯åŒ…å®‰è£…æ–¹å¼ã€‚ç¼–è¯‘å®‰è£…éœ€è¦cmakeï¼Œgccä»¥åŠç¼–è¯‘æ‰€éœ€è¦çš„å„ç§develï¼Œè¿™é‡Œä»…ä»‹ç»åŒ…å®‰è£…æ–¹å¼ã€‚</p>
<span id="more"></span>
<h2 id="ä»CentOSä»“å‚¨å®‰è£…"><a class="header-anchor" href="#ä»CentOSä»“å‚¨å®‰è£…">Â¶</a>ä»CentOSä»“å‚¨å®‰è£…</h2>
<p>CentOS 7ä»“å‚¨è£…è½½æœ‰PostgreSQLç‰ˆæœ¬<code>9.2.15</code>ï¼Œä½ å¯ä»¥ç›´æ¥é€šè¿‡ä»“å‚¨å®‰è£…ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install postgresql-server postgresql-contrib</span><br></pre></td></tr></table></figure>
<p>åˆå§‹åŒ–æ•°æ®åº“ï¼Œå¯åŠ¨PostgreSQLï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo postgresql-setup initdb</span><br><span class="line">sudo systemctl start postgresql</span><br></pre></td></tr></table></figure>
<p>å°†PostgreSQLåŠ å…¥Systemdä¸­ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable postgresql</span><br></pre></td></tr></table></figure>
<h2 id="æŒ‡å®šä»“åº“çš„ç‰ˆæœ¬"><a class="header-anchor" href="#æŒ‡å®šä»“åº“çš„ç‰ˆæœ¬">Â¶</a>æŒ‡å®šä»“åº“çš„ç‰ˆæœ¬</h2>
<p>ä½œä¸ºæ›¿ä»£ï¼Œä½ å¯ä»¥ä»Postgresä»“å‚¨å®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼Œç›®å‰CentOS7å¯ç”¨çš„æœ€é«˜PostgresSQLç‰ˆæœ¬æ˜¯<code>9.6.3</code>ï¼Œä½†éœ€è¦æä¾›RPM-basedçš„å®‰è£…æ–¹å¼ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šPostgresæŒ‡å®šç‰ˆæœ¬åï¼Œç‰ˆæœ¬ä¿¡æ¯ä¼šåŒ…å«åœ¨é…ç½®ç›®å½•ä¸­ã€‚ä¾‹å¦‚<code>/var/lib/pgsql</code>ä¼šå˜æˆ<code>/var/lib/pgsql/9.6</code>ã€‚è¿™å¯¹äºsystem unitsä¹Ÿä¸€æ ·ï¼Œ<code>systemctl status postgresql</code>ä¼šå˜æˆ<code>systemctl status postgresql-9.6</code>ã€‚</p>
</blockquote>
<p>é¦–å…ˆéœ€è¦ä»Postgresçš„<a target="_blank" rel="noopener" href="https://yum.postgresql.org/repopackages.php">ä»“å‚¨</a>é€‰æ‹©å¸Œæœ›å®‰è£…çš„ç‰ˆæœ¬ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://download.postgresql.org/pub/repos/yum/9.6/redhat/rhel-7-x86_64/pgdg-centos96-9.6-3.noarch.rpm</span><br></pre></td></tr></table></figure>
<p>å®‰è£…RPMï¼Œä»¥åŠ<a target="_blank" rel="noopener" href="https://fedoraproject.org/wiki/EPEL">EPEL</a>ä»“å‚¨ï¼Œç”¨äºä¾èµ–æ„å»ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install pgdg-centos96-9.6-3.noarch.rpm epel-release</span><br></pre></td></tr></table></figure>
<p>å®‰è£…å‰éœ€è¦updateä¸€ä¸‹ï¼Œä¸ç„¶ä¼šæœ‰conflictï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo yum update</span><br><span class="line">sudo yum install postgresql96-server postgresql96-contrib</span><br></pre></td></tr></table></figure>
<p>åˆå§‹åŒ–æ•°æ®åº“ï¼Œå¯åŠ¨PostgreSQLï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo /usr/pgsql-9.6/bin/postgresql96-setup initdb</span><br><span class="line">sudo systemctl start postgresql-9.6</span><br></pre></td></tr></table></figure>
<p>åŠ å…¥bootè‡ªå¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable postgresql-9.6</span><br></pre></td></tr></table></figure>
<h2 id="é…ç½®ç”¨æˆ·ä¿¡æ¯ã€æ•°æ®åº“"><a class="header-anchor" href="#é…ç½®ç”¨æˆ·ä¿¡æ¯ã€æ•°æ®åº“">Â¶</a>é…ç½®ç”¨æˆ·ä¿¡æ¯ã€æ•°æ®åº“</h2>
<p>é»˜è®¤åœ°ï¼ŒPostgreSQLä¸ºLinuxåˆ›å»ºäº†ä¸€ä¸ªæ— homeç›®å½•çš„ç”¨æˆ·<code>postgres</code>ï¼Œç”¨äºè®¿é—®æ•°æ®åº“è½¯ä»¶ç›®å½•ã€‚</p>
<blockquote>
<p>å°å¿ƒï¼š<br>
è¿™ä¸ª<code>postgres</code>ç”¨æˆ·ä¸åº”è¯¥ç”¨äºå…¶å®ƒç›®çš„(ä¾‹å¦‚ï¼Œè¿æ¥å…¶å®ƒç½‘ç»œ)ã€‚è¿™æ ·ä¼šç»™æ•°æ®åº“å®‰å…¨å¸¦æ¥é£é™©ã€‚</p>
</blockquote>
<ol>
<li>æ›´æ”¹<code>postgres</code>å¯†ç ï¼š</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo passwd postgres</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æ–¹å¼æ˜¯æ›´æ”¹<code>postgres</code>æ•°æ®åº“ç”¨æˆ·å¯†ç ã€‚ç¡®ä¿ä½¿ç”¨çš„<code>newpassword</code>æ˜¯å¼ºç±»å‹å¯†ç ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su - postgres</span><br><span class="line">psql -d template1 -c &quot;ALTER USER postgres WITH PASSWORD &#x27;newpassword&#x27;;&quot;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„è¿™é‡Œçš„<code>postgres</code>ç”¨æˆ·ä¸åŒäºLinuxçš„é‚£ä¸ª<code>postgres</code>ç”¨æˆ·ã€‚Linuxçš„<code>postgres</code>æ˜¯ç”¨äºè®¿é—®æ•°æ®åº“ï¼Œè¿™ä¸ªPostgreSQLç”¨æˆ·æ˜¯è´Ÿè´£è¯¥æ•°æ®åº“çš„ç®¡ç†ä»»åŠ¡å¤„ç†ã€‚</p>
<p>ä¸Šé¢è®¾ç½®çš„å¯†ç è¢«ç”¨äºé€šè¿‡ç½‘ç»œè®¿é—®æ•°æ®åº“ã€‚æœ¬æœºæ–¹å¼ä½¿ç”¨çš„<code>peer</code>æˆæƒã€‚æœ¬ç« æœ€åä»‹ç»å¦‚ä½•å®ç°è¿œç¨‹è®¿é—®ã€‚</p>
<h2 id="PostgreSQL-Shell"><a class="header-anchor" href="#PostgreSQL-Shell">Â¶</a>PostgreSQL Shell</h2>
<p>PostgreSQL client shellå…è®¸ä½ åœ¨æ•°æ®åº“å¤„ç†SQLå‘½ä»¤ã€‚é¦–å…ˆç™»å½•<code>postgres</code>ç”¨æˆ·ï¼Œè¿›å…¥shellï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql postgres</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆä¼šç™»å½•<code>postgres</code>æ•°æ®åº“ï¼Œpromptä¿¡æ¯ç±»ä¼¼äºï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">psql (9.2.15)</span><br><span class="line">Type &quot;help&quot; for help.</span><br><span class="line"></span><br><span class="line">postgres=#</span><br></pre></td></tr></table></figure>
<p>æœ€åä¸€è¡Œï¼Œ<code>postgres=#</code>æ ‡ç¤ºäº†å½“å‰æ•°æ®åº“çš„åç§°ã€‚è¦æŸ¥çœ‹å¯ç”¨å‘½ä»¤ï¼Œè¾“å…¥<code>\h</code>ã€‚é€€å‡ºå½“å‰shellï¼Œè¾“å…¥<code>\q</code>ã€‚</p>
<h2 id="æ•°æ®åº“å·¥ä½œ"><a class="header-anchor" href="#æ•°æ®åº“å·¥ä½œ">Â¶</a>æ•°æ®åº“å·¥ä½œ</h2>
<p>é¦–å…ˆï¼Œä½ å¯ä»¥ä½¿ç”¨<code>createdb</code>å‘½ä»¤åˆ›å»ºæ•°æ®åº“ã€‚ä¾‹å¦‚ä»¥<code>postgres</code>ç”¨æˆ·èº«ä»½åˆ›å»ºä¸€ä¸ª<code>mytestdb</code>æ•°æ®åº“ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">createdb mytestdb</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥ä¸ºè¯¥æ•°æ®åº“æŒ‡æ´¾è§’è‰²å…³ç³»ã€‚ä¾‹å¦‚ï¼ŒæŒ‡æ´¾ä¸€ä¸ª<code>examplerole</code>è§’è‰²ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">createdb mytestdb -O examplerole</span><br></pre></td></tr></table></figure>
<p><code>createdb</code>å‘½ä»¤æœ‰å‡ ä¸ªæ“ä½œé€‰é¡¹ï¼Œä½ å¯ä»¥åœ¨<a target="_blank" rel="noopener" href="https://www.postgresql.org/docs/9.2/static/app-createdb.html">PostgreSQL documentation</a>æŸ¥çœ‹æ›´å¤šç»†èŠ‚ã€‚</p>
<p>è¿æ¥æ•°æ®åº“ï¼Œå¯ä»¥ä½¿ç”¨<code>psql</code>å‘½ä»¤æŒ‡å®šï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql mytestdb</span><br></pre></td></tr></table></figure>
<p>å‡ºç°ä¸‹é¢promptè¯´æ˜è¿æ¥æˆåŠŸï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">psql (9.2.15)</span><br><span class="line">Type &quot;help&quot; for help.</span><br><span class="line"></span><br><span class="line">mytestdb=#</span><br></pre></td></tr></table></figure>
<p>é»˜è®¤åœ°ï¼Œæ•°æ®åº“çš„è¿æ¥æ˜¯ä½œä¸º<a target="_blank" rel="noopener" href="https://www.linode.com/docs/databases/postgresql/how-to-install-postgresql-relational-databases-on-centos-7/#peer-authentication">peer-authenticated</a>ç”¨æˆ·çš„æ–¹å¼ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥æŒ‡å®šæœ¬åœ°ç”¨æˆ·çš„æ–¹å¼è®¿é—®ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql mytestdb -U examplerole</span><br></pre></td></tr></table></figure>
<p>è¦æŸ¥çœ‹æ‰€æœ‰çš„æ•°æ®åº“ï¼Œä½¿ç”¨<code>\l</code>æˆ–<code>\list</code>å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">postgres=# \l</span><br><span class="line">                          List of databases</span><br><span class="line">Name    |  Owner   | Encoding |   Collate   |    Ctype    |   Access privileges</span><br><span class="line">-----------+----------+----------+-------------+-------------+-----------------------</span><br><span class="line">mytestdb  | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 |</span><br><span class="line">postgres  | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 |</span><br><span class="line">template0 | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/postgres          +</span><br><span class="line">|         |          |          |             | postgres=CTc/postgres</span><br><span class="line">template1 | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/postgres          +</span><br><span class="line">|         |          |          |             | postgres=CTc/postgres</span><br><span class="line">(4 rows)</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡<code>\c</code>å‘½ä»¤å¯ä»¥å±•ç¤ºå½“å‰æ•°æ®åº“å’Œå½“å‰ç”¨æˆ·ä¿¡æ¯ã€‚è¦å±•ç¤ºå…¶å®ƒé¢å¤–ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨<code>\conninfo</code>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You are connected to database &quot;mytestdb&quot; as user &quot;postgres&quot; via socket in &quot;/var/run/postgresql&quot; at port &quot;5432&quot;.</span><br></pre></td></tr></table></figure>
<p>æ•°æ®æ•°æ®åº“ç”¨<code>dropdb</code>å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dropdb mytestdb</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œåˆ é™¤çš„æ•°æ®åº“ä¸èƒ½æ¢å¤ã€‚</p>
<h2 id="è¡¨"><a class="header-anchor" href="#è¡¨">Â¶</a>è¡¨</h2>
<p>åˆ›å»ºä¸€ä¸ª<code>employees</code>çš„è¡¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE employees (employee_id int, first_name varchar, last_name varchar);</span><br></pre></td></tr></table></figure>
<p>æ’å…¥ä¸€æ¡è®°å½•ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO employees VALUES (1, &#x27;John&#x27;, &#x27;Doe&#x27;);</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹è¡¨å†…å®¹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM employees;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå†…å®¹ä¸º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">employee_id | first_name | last_name</span><br><span class="line">-------------+------------+-----------</span><br><span class="line">          1 | John       | Doe</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>
<p>åˆ—ä¸¾å½“å‰æ•°æ®åº“çš„æ‰€æœ‰è¡¨ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡<code>\dt</code>å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mytestdb-# </span><span class="language-bash">\dt</span></span><br><span class="line">          List of relations</span><br><span class="line">Schema |   Name    | Type  |  Owner</span><br><span class="line">--------+-----------+-------+----------</span><br><span class="line">public | employees | table | postgres</span><br></pre></td></tr></table></figure>
<p>åˆ é™¤è¡¨é€šè¿‡<code>DROP TABLE</code>å‘½ä»¤ï¼Œä¾‹å¦‚åˆ é™¤<code>employees</code>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE employees;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥é€šè¿‡é€—å·åˆ†éš”æ–¹å¼åˆ é™¤å¤šä¸ªè¡¨ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE employees1, employees2;</span><br></pre></td></tr></table></figure>
<p>æ›´æ”¹å’Œæ·»åŠ è¡¨columnï¼Œå’Œæ ‡å‡†SQLä¸€æ ·ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE employees ADD start_date date;</span><br></pre></td></tr></table></figure>
<p>éªŒè¯å…ˆå‰çš„æ›´æ”¹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM employees;</span><br></pre></td></tr></table></figure>
<p>ä½ ä¼šçœ‹åˆ°æ–°å¢çš„åˆ—ä¸åŒ…å«ä»»ä½•å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">employee_id | first_name | last_name | start_date</span><br><span class="line">-------------+------------+-----------+------------</span><br><span class="line">          1 | John       | Doe       |</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>
<p>PostgreSQLæ”¯æŒå¥½å‡ ç§æ•°æ®åº“ç±»å‹ï¼Œå¯ä»¥åœ¨<a target="_blank" rel="noopener" href="https://www.postgresql.org/docs/9.2/static/datatype.html">è¿™é‡Œ</a>æŸ¥çœ‹ç›¸å…³ä¿¡æ¯ã€‚</p>
<p>ä½ å¯ä»¥ä½¿ç”¨<code>UPDATE</code>æ›´æ”¹è®°å½•ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE employees SET start_date = &#x27;2016-09-28&#x27; WHERE employee_id = &#x27;1&#x27;;</span><br></pre></td></tr></table></figure>
<p>æˆ–æ’å…¥ä¸€æ¡æ–°çš„è®°å½•ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO employees VALUES (2, &#x27;Jane&#x27;, &#x27;Smith&#x27;, &#x27;2015-03-09&#x27;);</span><br></pre></td></tr></table></figure>
<p>éªŒè¯ä¸€ä¸‹ï¼Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM employees;</span><br><span class="line"></span><br><span class="line">employee_id | first_name | last_name | start_date</span><br><span class="line">-------------+------------+-----------+------------</span><br><span class="line">          1 | John       | Doe       | 2016-09-28</span><br><span class="line">          2 | Jane       | Smith     | 2015-03-09</span><br><span class="line">(2 rows)</span><br></pre></td></tr></table></figure>
<p>è¦åˆ é™¤è¡Œå’Œåˆ—ï¼Œä¾‹å¦‚åˆ é™¤<code>start_date</code>å­—æ®µï¼Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE employees DROP start_date;</span><br></pre></td></tr></table></figure>
<p>åˆ é™¤è®°å½•ä½¿ç”¨<code>DELETE</code>ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM employees WHERE employee_id = &#x27;2&#x27;;</span><br></pre></td></tr></table></figure>
<p>éªŒè¯ä¸€ä¸‹ï¼Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM employees;</span><br><span class="line"></span><br><span class="line">employee_id | first_name | last_name</span><br><span class="line">-------------+------------+-----------</span><br><span class="line">          1 | John       | Doe</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>
<p>æŸ¥è¯¢æ•°æ®åº“å’Œæ ‡å‡†SQLä¸€æ ·ï¼Œä¾‹å¦‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT last_name,employee_id FROM employees;</span><br><span class="line"></span><br><span class="line">last_name | employee_id</span><br><span class="line">-----------+-------------</span><br><span class="line">Doe       |           1</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>
<p>æ›´å¤šæŸ¥è¯¢é€‰é¡¹ï¼Œå¯ä»¥ç‚¹å‡»<a target="_blank" rel="noopener" href="https://www.postgresql.org/docs/9.2/static/sql-select.html">è¿™é‡Œ</a></p>
<h2 id="è§’è‰²"><a class="header-anchor" href="#è§’è‰²">Â¶</a>è§’è‰²</h2>
<p>PostgreSQLé€šè¿‡<strong>roles</strong>æˆæƒæ•°æ®åº“è®¿é—®ï¼Œè¡¨ç¤ºæŸç§æƒé™ã€‚å¦å¤–ï¼Œè§’è‰²å¯ä»¥ç”±å…¶å®ƒä¸€ç³»åˆ—è§’è‰²åˆ›å»ºï¼Œç±»ä¼¼äºâ€œgroupâ€ã€‚PostgreSQLçš„è§’è‰²æ˜¯å…¨å±€çš„ï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦ä¸ºåŒä¸€ä¸ªè§’è‰²åˆ›å»ºä¸¤æ¬¡ä»¥è®¿é—®ä¸åŒæ•°æ®åº“ã€‚</p>
<p>åˆ›å»ºè§’è‰²é€šè¿‡<code>createuser</code>å‘½ä»¤ï¼Œä¾‹å¦‚åˆ›å»ºä¸€ä¸ª<code>examplerole</code>çš„è§’è‰²ï¼Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">createuser examplerole --pwprompt</span><br></pre></td></tr></table></figure>
<p>æˆæƒè§’è‰²è®¿é—®ï¼Œé»˜è®¤ä»¥<code>postgres</code>æ•°æ®è¿æ¥ï¼Œå†è¿›è¡Œæˆæƒï¼Œè¿™é‡Œçš„<code>postgres</code>ç›¸å½“äºä¸€ä¸ª<code>sa</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL ON employees TO examplerole;</span><br></pre></td></tr></table></figure>
<p>ç½—åˆ—æ‰€æœ‰ç”¨æˆ·è§’è‰²ï¼Œå¯ä»¥é€šè¿‡<code>\du</code>å‘½ä»¤æŸ¥çœ‹ï¼Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">postgres=# \du</span><br><span class="line">                             List of roles</span><br><span class="line">Role name   |                   Attributes                   | Member of</span><br><span class="line">-------------+------------------------------------------------+-----------</span><br><span class="line">examplerole |                                                | &#123;&#125;</span><br><span class="line">postgres    | Superuser, Create role, Create DB, Replication | &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†ä¾¿äºç®¡ç†ï¼Œå¯ä»¥å°†å¤šä¸ªè§’è‰²æ·»åŠ åˆ°ä¸€ä¸ªç»„ï¼Œè¿™æ ·å¯ä»¥å…¨å±€ç®¡ç†å®ƒä»¬çš„æƒé™ã€‚ä¸‹é¢å±•ç¤ºå¦‚ä½•å®ç°ï¼Œæ‰€æœ‰è¿™äº›å‘½ä»¤åº”è¯¥åœ¨<code>postgres</code>ç”¨æˆ·ä¸‹è¿›è¡Œã€‚</p>
<p>ä½¿ç”¨<code>createuser</code>åˆ›å»ºä¸€ä¸ªç»„è§’è‰²ã€‚å…¶ä¸­<code>--no-login</code>é€‰é¡¹æŒ‡å®šäº†è¯¥ç»„ä¸éœ€è¦ç™»å½•ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">createuser examplegroup --no-login</span><br></pre></td></tr></table></figure>
<p>ç™»å½•å¹¶æ·»åŠ è§’è‰²åˆ°ç»„ä¸­ï¼Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">psql postgres</span><br><span class="line">GRANT examplegroup TO examplerole;</span><br></pre></td></tr></table></figure>
<p>éªŒè¯ä¸€ä¸‹ï¼Œä½¿ç”¨<code>\du</code>å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°<code>examplerole</code>ç”¨æˆ·ç°åœ¨åœ¨<code>examplegroup</code>ç»„ä¸­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">postgres=# \du</span><br><span class="line">                                List of roles</span><br><span class="line">Role name    |                   Attributes                   |   Member of</span><br><span class="line">--------------+------------------------------------------------+----------------</span><br><span class="line">examplegroup | Cannot login                                   | &#123;&#125;</span><br><span class="line">examplerole  |                                                | &#123;examplegroup&#125;</span><br><span class="line">group        |                                                | &#123;&#125;</span><br><span class="line">postgres     | Superuser, Create role, Create DB, Replication | &#123;&#125;</span><br></pre></td></tr></table></figure>
<p><code>createuser</code>å‘½ä»¤æœ‰å‡ ä¸ªé€‰é¡¹ã€‚ç‚¹å‡»<a target="_blank" rel="noopener" href="https://www.postgresql.org/docs/9.2/static/app-createuser.html">è¿™é‡Œ</a>æŸ¥çœ‹ç›¸å…³ä¿¡æ¯ã€‚</p>
<p>è¦æ›´æ”¹è§’è‰²å±æ€§ï¼Œæœ‰å‡ ä¸ªé€‰é¡¹ï¼Œä¾‹å¦‚ï¼Œæˆäºˆ<code>examplerole</code>å±æ€§<code>CREATEDB</code>ï¼Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER ROLE examplerole CREATEDB;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨<code>\du</code>éªŒè¯ä¸€ä¸‹ï¼Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">postgres=# \du</span><br><span class="line">                             List of roles</span><br><span class="line">Role name   |                   Attributes                   | Member of</span><br><span class="line">-------------+------------------------------------------------+-----------</span><br><span class="line">examplerole | Create DB                                      | &#123;&#125;</span><br><span class="line">group       |                                                | &#123;&#125;</span><br><span class="line">postgres    | Superuser, Create role, Create DB, Replication | &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ é™¤è§’è‰²ï¼Œä½¿ç”¨<code>dropuser</code>å‘½ä»¤ï¼Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dropuser examplerole</span><br></pre></td></tr></table></figure>
<h2 id="Peer-Authentication"><a class="header-anchor" href="#Peer-Authentication">Â¶</a>Peer Authentication</h2>
<p>PostgreSQLé»˜è®¤ä½¿ç”¨å¯¹ç­‰æˆæƒ(peer authentication)çš„æ–¹å¼è¿›è¡Œè¿æ¥ã€‚æ„å‘³ç€ï¼Œå¦‚ä½•å½“å‰æˆæƒçš„æœ¬åœ°ç³»ç»Ÿç”¨æˆ·å’ŒPostgreSQLè§’è‰²ç”¨æˆ·ååŒ¹é…ï¼Œåˆ™æˆäºˆè¿æ¥ã€‚æ‰€ä»¥ä½ éœ€è¦åŒæ—¶åˆ›å»ºä¸€ä¸ªç›¸åŒçš„Linuxç”¨æˆ·å’Œä¸€ä¸ªå¯¹åº”çš„PostgreSQLè§’è‰²ã€‚ä¾‹å¦‚ï¼Œåˆšåˆšåˆ›å»ºäº†<code>examplerole</code>è§’è‰²ï¼ŒLinuxä¸­éœ€è¦åˆ›å»ºä¸€ä¸ª<code>examplerole</code>ï¼Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo adduser examplerole &amp;&amp; passwd examplerole</span><br></pre></td></tr></table></figure>
<h2 id="Secure-PostgreSQL"><a class="header-anchor" href="#Secure-PostgreSQL">Â¶</a>Secure PostgreSQL</h2>
<p>PostgreSQLé»˜è®¤ä½¿ç”¨çš„peer authenticationæ–¹å¼ï¼Œé™åˆ¶äº†ä»…èƒ½é€šè¿‡æœ¬åœ°è®¿é—®ï¼Œå®ƒçš„é…ç½®ä¿¡æ¯åœ¨<code>/var/lib/pgsql/dta/pg_hba.conf</code>ä¸­ï¼Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># &quot;local&quot; is for Unix domain socket connections only</span><br><span class="line">local    all        all             peer</span><br></pre></td></tr></table></figure>
<p>å°†<code>peer</code>æ›¿æ¢ä¸º<code>md5</code>ï¼Œä»¥å…è®¸é€šè¿‡MD5å“ˆå¸Œå¯†ç æ–¹å¼è®¿é—®ã€‚</p>
<p>ä¹Ÿå¯ä»¥æŒ‡å®šä¿¡ä»»ä»»ä½•æœåŠ¡å™¨çš„è¿æ¥ï¼Œä¿®æ”¹ä¸ºï¼Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># IPv4 local connections:</span><br><span class="line">host    all            all      127.0.0.1/32      trust</span><br><span class="line">host    all            all      0.0.0.0/0  		  trust</span><br><span class="line"># IPv6 local connections:</span><br><span class="line">host    all            all      ::/0  		       trust</span><br></pre></td></tr></table></figure>
<p>é€€å‡ºï¼Œé‡å¯æœåŠ¡ï¼Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart postgresql</span><br><span class="line">su - postgres</span><br></pre></td></tr></table></figure>
<p>å†æ¬¡ç™»å½•ï¼Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql mytestdb -U examplerole</span><br></pre></td></tr></table></figure>
<p>å®ƒä¼šæç¤ºä½ è¾“å…¥å¯†ç ï¼Œç”¨äºç™»å½•<code>examplerole</code>è§’è‰²ä»¥è®¿é—®æ•°æ®åº“ã€‚ä½ å¯ä»¥é€šè¿‡<code>\z</code>å‘½ä»¤è®¿é—®è¡¨æƒé™ã€‚</p>
<p>å¦å¤–ï¼Œè¦å®ç°è¿œç¨‹è®¿é—®ï¼Œè¿˜éœ€è¦ä¿®æ”¹<code>/var/lib/pgsql/data/postgresql.conf</code>é…ç½®ï¼Œå»æ‰å‰é¢æ³¨é‡Šï¼Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">listen_addresses=&#x27;*&#x27;</span><br></pre></td></tr></table></figure>
<p>æŸäº›æƒ…å†µä¸‹ï¼Œè¿˜éœ€è¦å…³é—­ç³»ç»Ÿé˜²ç«å¢™ï¼Œæˆ–ç›´æ¥æ·»åŠ åˆ°iptalbeï¼Œ</p>
<p>CentOS é˜²ç«å¢™ä¸­å†…ç½®äº†PostgreSQLæœåŠ¡ï¼Œé…ç½®æ–‡ä»¶ä½ç½®åœ¨/usr/lib/firewalld/services/postgresql.xmlï¼Œæˆ‘ä»¬åªéœ€ä»¥æœåŠ¡æ–¹å¼å°†PostgreSQLæœåŠ¡å¼€æ”¾å³å¯ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --add-service=postgresql --permanent  å¼€æ”¾postgresqlæœåŠ¡</span><br><span class="line">firewall-cmd --reload  é‡è½½é˜²ç«å¢™</span><br></pre></td></tr></table></figure>
<p>æˆ–å¹²è„†å…³é—­é˜²ç«å¢™ï¼Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop firewalld</span><br><span class="line">sudo systemctl disable firewalld</span><br></pre></td></tr></table></figure>
<p>é‡å¯postgresqlå³å¯ã€‚</p>
<h2 id="å®‰è£…PostGIS"><a class="header-anchor" href="#å®‰è£…PostGIS">Â¶</a>å®‰è£…PostGIS</h2>
<p>PostGISå¯ä»¥ç”±CentOSä»“å‚¨å®‰è£…ï¼Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum -y install postgis.x86_64 postgis-client.x86_64 postgis-debuginfo.x86_64 postgis-devel.x86_64 postgis-docs.x86_64 postgis-utils.x86_64</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹PostGIç›¸å…³æ–‡ä»¶æ˜¯å¦å®‰è£…æˆåŠŸï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls /usr/pgsql/share/extension</span><br><span class="line">ls /usr/pgsql/share/contrib/postgis</span><br></pre></td></tr></table></figure>
<p>åŠ è½½PostGISæ’ä»¶</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su - postgres</span><br><span class="line">psql -d postgres -U postgres</span><br></pre></td></tr></table></figure>
<p>åœ¨PostgreSQL Shellä¸­ï¼Œè¾“å…¥</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">postgres=# create database postgis ;</span><br><span class="line">postgres=# \c postgis</span><br><span class="line">postgis=# select * from pg_extension ;</span><br><span class="line">postgis=# create extension postgis ;</span><br><span class="line">postgis=# \dt</span><br><span class="line"></span><br><span class="line">postgis=# select count(*) from spatial_ref_sys ;</span><br><span class="line"></span><br><span class="line">postgres=# \dn</span><br><span class="line"></span><br><span class="line">postgis=# create extension postgis_topology ;</span><br><span class="line">CREATE EXTENSION</span><br><span class="line">postgis=# \dn</span><br></pre></td></tr></table></figure>
</div></article><nav class="article-nav"><div class="article-nav-prev">ğŸ”™<a href="/2019/02/03/kubernetes/kubernetes-01-centos-installation/">kubernetes ç®€ä»‹ä»¥åŠå®‰è£…å®‰è£…é«˜å¯ç”¨v1.13.1é›†ç¾¤(ä¸€)</a></div><div class="article-nav-next">ğŸ”œ<a href="/2019/01/16/react/react-storybook-live-editing/">ä½¿ç”¨storybookå¼€å‘è‡ªå·±çš„Reactç»„ä»¶åº“</a></div></nav><div id="base-discus"><div id="disqus_thread"></div><script>var disqus_shortname = 'barudisshu-github-io';
var disqus_identifier = '2019/01/24/postgresql/postgresql-relational-databases-on-centos-7/';
var disqus_title = 'CentOS 7 å®‰è£…ã€é…ç½®ã€ä½¿ç”¨PostgreSQLåŠPostGIS';
var disqus_url = 'https://galudisu.info/2019/01/24/postgresql/postgresql-relational-databases-on-centos-7/';
(function () {
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async>  </script></div></div></div><footer class="base-footer"><div class="footer-wrapper"><span>Â©2016 - 2025 <a href="https://galudisu.info">barudisshu</a>, unless otherwise noted.</span></div></footer><div class="dom-ready">
<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>

<link rel="stylesheet" href="//cdn.bootcss.com/pace/1.0.2/themes/green/pace-theme-flash.min.css">

<script src="/js/base.js"></script>

<script src="/js/rabbit-lyrics.js"></script>
</div></body></html>