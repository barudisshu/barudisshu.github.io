<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><title>ä½¿ç”¨storybookå¼€å‘è‡ªå·±çš„Reactç»„ä»¶åº“</title>
<link rel="stylesheet" href="/css/layout.css">
<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="/css/vendors/rabbit-lyrics.css">
<link rel="shortcut icon" href="/img/favicon.ico"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ç®€å•æ˜“æ‡‚ã®ç°ä»£é­”æ³•" type="application/atom+xml">
</head><body><header class="base-menu"><div class="menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">ç®€å•æ˜“æ‡‚ã®ç°ä»£é­”æ³•</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav></div></header><header class="base-mobile-menu"><div class="mobile-menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">ç®€å•æ˜“æ‡‚ã®ç°ä»£é­”æ³•</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav><div class="toggle-menu" id="mobile-menu-toggle"><span class="menu-bar"></span><span class="menu-bar"> </span><span class="menu-bar"></span></div></div></header><div class="base-content"><div class="base-content-main"><article class="article-main"><h1 class="article-title">ä½¿ç”¨storybookå¼€å‘è‡ªå·±çš„Reactç»„ä»¶åº“</h1><div class="article-meta"><p class="meta-item meta-time"><span class="meta-item-title"></span><i class="icon-calendar"> </i>2019-01-16</p><p class="meta-item meta-tag"><span class="meta-item-title"></span><i class="icon-tags"> </i><a class="tag-link" href="/tags/react/">react<span class="tag">, </span></a><a class="tag-link" href="/tags/redux/">redux<span class="tag">, </span></a><a class="tag-link" href="/tags/webpack/">webpack<span class="tag">, </span></a><a class="tag-link" href="/tags/hot/">hot</a></p></div><div class="article-content"><p><img src="/img/cartoon/20190116_225744.925.jpg" alt="ohanahibi"><br>
æœ‰æ—¶å€™å¹¶ä¸å¸Œæœ›ä½¿ç”¨ç¬¬ä¸‰æ–¹ç»„ä»¶åº“ï¼Œä»¥åŠå¤§éƒ¨åˆ†æ—¶å€™éœ€è¦è‡ªå·±å®šåˆ¶ä¸€å¥—ç»„ä»¶å®ç°ï¼Œä»¥ä¾›å…¬å¸æˆ–é¡¹ç›®å†…éƒ¨ä½¿ç”¨ã€‚å¼€å‘è‡ªå·±çš„ç»„ä»¶æœ‰å¦‚é‡å¤é€ è½®å­ï¼Œä¼šèŠ±è´¹ç›¸å½“å¤šçš„ç²¾åŠ›åˆ¶é€ ã€‚å¦‚æœæ˜¯ä¸ºäº†ä¸€ç§é•¿è¿œå…¬å¸å‘å±•ï¼Œè¿™ä»½åŠªåŠ›æ˜¯å€¼å¾—çš„ï¼Œå¦‚æœä¸æƒ³è‡ªå·±è€—è´¹ç²¾åŠ›ï¼Œä¹Ÿæœ‰è®¸å¤šå¼€æºçš„ç»„ä»¶å®ç°ï¼Œæ¯”å¦‚<a target="_blank" rel="noopener" href="https://material-ui.com/">material-ui</a>ã€‚ä¸€èˆ¬éƒ½æ˜¯æ‹¿æ¥æ”¹é€ ä¸€ä¸‹ï¼Œå¯ä»¥é¿å…å¾ˆå¤šå¼€å‘æˆ–å…¼å®¹æ€§ä¸Šçš„å‘ã€‚</p>
<span id="more"></span>
<h2 id="Architecture"><a class="header-anchor" href="#Architecture">Â¶</a>Architecture</h2>
<p>ç¼–å†™è¿™ç¯‡æ–‡ç« æ—¶ï¼Œç¬”è€…ç”¨çš„éƒ½æ˜¯æœ€æ–°çš„åŒ…ä»¥åŠä¾èµ–ï¼Œå‘æ¯”è¾ƒå¤šï¼Œæ¯”å¦‚<a target="_blank" rel="noopener" href="https://webpack.js.org/">webpack4</a>ï¼Œæ”¹æ‰ä»¥åŠåˆ é™¤å¾ˆå¤šåŠŸèƒ½ï¼›åˆå¦‚<a target="_blank" rel="noopener" href="https://babeljs.io/docs/en/v7-migration">babel7</a>å¼ƒç”¨äº†æ—§çš„å†™æ³•ï¼Œå…¨éƒ¨å¸¦ä¸Šäº†<code>scoped packages</code>ï¼Œå³åœ¨presetså‰é¢å¸¦ä¸Šæ¨¡å—æ ‡å¿—ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [<span class="string">&quot;@babel/env&quot;</span>], <span class="comment">// &quot;@babel/preset-env&quot;</span></span><br><span class="line">  <span class="attr">plugins</span>: [<span class="string">&quot;@babel/transform-arrow-functions&quot;</span>], <span class="comment">// same as &quot;@babel/plugin-transform-arrow-functions&quot;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä¸»è¦å…³é”®æŠ€æœ¯ï¼š</p>
<ul>
<li>webpack</li>
<li>typescript</li>
<li>react</li>
<li>state management(redux or mobx)</li>
<li>react-router-4</li>
<li>component hot reload</li>
<li>svg icon</li>
<li>jest</li>
<li>UI lib</li>
<li>less</li>
<li>eslint</li>
</ul>
<p>ä¸»è¦åº“ä»¥åŠç‰ˆæœ¬ï¼š</p>
<ul>
<li>webpack			4.x.x</li>
<li>typescript		2.9.x</li>
<li>react				16.7.x</li>
<li>react-router-dom	4.2.x</li>
<li>react-hot-loader	4.6.x<br>
â€¦</li>
<li>node				10.13.x</li>
</ul>
<p>æ³¨æ„ï¼šreact-router v4ä¸ºç¬¬å››ä»£react-routerï¼Œreact-domä¸ºv2æˆ–v3çš„æ—§ç‰ˆæœ¬ã€‚æ–°ç‰ˆæœ¬çš„react-router v4å¯ä»¥è¯´æ˜¯é‡å†™äº†è·¯ç”±ï¼Œreact-router v4 è¢«ä¸€åˆ†ä¸ºä¸‰ï¼š<code>react-router-dom</code>(for web)ã€<code>react-router-native</code>(for native)ã€<code>react-router</code>(core)ã€‚ä»…åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨çš„è¯ï¼Œä¸€èˆ¬å¼•å…¥<code>react-router-dom</code>å³å¯ã€‚å¦‚æœä»æ—§ç‰ˆæœ¬è¿ç§»ï¼Œå¯ä»¥å‚è€ƒ<a target="_blank" rel="noopener" href="https://github.com/gmfe/Think/issues/6">è¿™é‡Œ</a>ã€‚</p>
<p>ç›®å½•ç»“æ„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">--.storybook</span><br><span class="line">--public			æ¨¡æ¿ç›®å½•</span><br><span class="line">--src</span><br><span class="line">  --components 		è‡ªå®šä¹‰ç»„ä»¶</span><br><span class="line">  --docs			ä»£ç å…¥å£&lt;App/&gt;</span><br><span class="line">  --stories			æ–‡æ¡£è¯´æ˜</span><br><span class="line">eslintrc.yml</span><br><span class="line">tsconfig.json</span><br><span class="line">.babelrc</span><br><span class="line">package.json		ä¾èµ–åŒ…</span><br><span class="line">webpack.config.js</span><br></pre></td></tr></table></figure>
<h2 id="Babel"><a class="header-anchor" href="#Babel">Â¶</a>Babel</h2>
<p>Babelç”¨äºå°†æµè§ˆå™¨ä¸èƒ½è¯†åˆ«çš„ESä»¥åŠTSè½¬æ¢ä¸ºJSï¼Œé¦–å…ˆæ·»åŠ ä¾èµ–ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev @babel/core @babel/cli @babel/preset-env @babel/preset-react @babel/preset-typescript @babel/plugin-proposal-object-rest-spread @babel/plugin-transform-runtime</span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨æ ¹ç›®å½•æ·»åŠ .babelrcï¼Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;presets&quot;: [</span><br><span class="line">    &quot;@babel/preset-env&quot;,</span><br><span class="line">    &quot;@babel/preset-react&quot;,</span><br><span class="line">    &quot;@babel/preset-typescript&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;plugins&quot;: [</span><br><span class="line">    &quot;@babel/plugin-proposal-object-rest-spread&quot;,</span><br><span class="line">    &quot;@babel/plugin-transform-runtime&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Unit-Test"><a class="header-anchor" href="#Unit-Test">Â¶</a>Unit Test</h2>
<p>æ·»åŠ å•å…ƒæµ‹è¯•ï¼Œå•æµ‹é»˜è®¤è¯†åˆ«ç›®å½•<code>__tests__</code>ï¼Œä¾‹å¦‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">--src</span><br><span class="line">  --components</span><br><span class="line">    --Link</span><br><span class="line">	  --__tests__</span><br><span class="line">	    Link.react.test.js</span><br><span class="line">	  Link.react.js</span><br><span class="line">    index.js</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆï¼Œä½¿ç”¨TypeScriptç¼–å†™ä¸€ä¸ªç»„ä»¶ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PropTypes</span> <span class="keyword">from</span> <span class="string">&#x27;prop-types&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">STATUS</span> = &#123;</span><br><span class="line">  <span class="attr">HOVERED</span>: <span class="string">&#x27;hovered&#x27;</span>,</span><br><span class="line">  <span class="attr">NORMAL</span>: <span class="string">&#x27;normal&#x27;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">MLink</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_onMouseEnter</span> = <span class="variable language_">this</span>.<span class="property">_onMouseEnter</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_onMouseLeave</span> = <span class="variable language_">this</span>.<span class="property">_onMouseLeave</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">      <span class="attr">class</span>: <span class="variable constant_">STATUS</span>.<span class="property">NORMAL</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">_onMouseEnter</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">class</span>: <span class="variable constant_">STATUS</span>.<span class="property">HOVERED</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">_onMouseLeave</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">class</span>: <span class="variable constant_">STATUS</span>.<span class="property">NORMAL</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">a</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">className</span>=<span class="string">&#123;this.state.class&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">href</span>=<span class="string">&#123;this.props.page</span> || &#x27;#&#x27;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onMouseEnter</span>=<span class="string">&#123;this._onMouseEnter&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onMouseLeave</span>=<span class="string">&#123;this._onMouseLeave&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;this.props.children&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">MLink</span>.<span class="property">propTypes</span> = &#123;</span><br><span class="line">  <span class="attr">children</span>: <span class="title class_">PropTypes</span>.<span class="property">node</span>.<span class="property">isRequired</span>,</span><br><span class="line">  <span class="attr">page</span>: <span class="title class_">PropTypes</span>.<span class="property">node</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å¯¹åº”å…¶<code>__tests__</code>ç›®å½•æ·»åŠ å•å…ƒæµ‹è¯•ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MLink.react.test.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MLink</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../Link.react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> renderer <span class="keyword">from</span> <span class="string">&#x27;react-test-renderer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">test</span>(<span class="string">&#x27;MLink changes the class when hovered&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> component = renderer.<span class="title function_">create</span>(</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">MLink</span> <span class="attr">page</span>=<span class="string">&quot;http://www.facebook.com&quot;</span>&gt;</span>Facebook<span class="tag">&lt;/<span class="name">MLink</span>&gt;</span></span>,</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">let</span> tree = component.<span class="title function_">toJSON</span>();</span><br><span class="line">  <span class="title function_">expect</span>(tree).<span class="title function_">toMatchSnapshot</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// manually trigger the callback</span></span><br><span class="line">  tree.<span class="property">props</span>.<span class="title function_">onMouseEnter</span>();</span><br><span class="line">  <span class="comment">// re-rendering</span></span><br><span class="line">  tree = component.<span class="title function_">toJSON</span>();</span><br><span class="line">  <span class="title function_">expect</span>(tree).<span class="title function_">toMatchSnapshot</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// manually trigger the callback</span></span><br><span class="line">  tree.<span class="property">props</span>.<span class="title function_">onMouseLeave</span>();</span><br><span class="line">  <span class="comment">// re-rendering</span></span><br><span class="line">  tree = component.<span class="title function_">toJSON</span>();</span><br><span class="line">  <span class="title function_">expect</span>(tree).<span class="title function_">toMatchSnapshot</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>æŠŠå•å…ƒæµ‹è¯•æ‰€éœ€çš„é…ç½®è¡¥å……ä¸Šï¼Œæ·»åŠ å•å…ƒæµ‹è¯•æ‰€éœ€è¦çš„ä¾èµ–</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev jest @types/jest babel-jest ts-jest</span><br></pre></td></tr></table></figure>
<p>å¦å¤–è¿˜éœ€è¦ä¸€ä¸ªEnzymeï¼Œå®ƒæ˜¯Reactçš„æµ‹è¯•å·¥å…·ï¼Œè¿˜éœ€è¦enzyme-to-json è½¬æ¢ï¼Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev jest react-test-renderer enzyme enzyme-adapter-react-16 enzyme-to-json</span><br></pre></td></tr></table></figure>
<p>æ›´æ–°ä¸€ä¸‹package.jsonï¼ŒåŠ ä¸Šå¯¹åº”çš„è„šæœ¬</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jest&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;test:watch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jest --watch&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;test:coverage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jest --coverage&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;jest&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;setupFiles&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;./test/jestsetup.js&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;snapshotSerializers&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;enzyme-to-json/serializer&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºä¸€ä¸ªtest/jestsetup.jsæ–‡ä»¶ï¼Œè‡ªå®šä¹‰æµ‹è¯•ç¯å¢ƒ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Enzyme</span>, &#123; shallow, render, mount &#125; <span class="keyword">from</span> <span class="string">&#x27;enzyme&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Adapter</span> <span class="keyword">from</span> <span class="string">&#x27;enzyme-adapter-react-16&#x27;</span>;</span><br><span class="line"><span class="comment">// React 16 Enzyme adapter</span></span><br><span class="line"><span class="title class_">Enzyme</span>.<span class="title function_">configure</span>(&#123; <span class="attr">adapter</span>: <span class="keyword">new</span> <span class="title class_">Adapter</span>() &#125;);</span><br><span class="line"><span class="comment">// Make Enzyme functions available in all test files without importing</span></span><br><span class="line"><span class="variable language_">global</span>.<span class="property">shallow</span> = shallow;</span><br><span class="line"><span class="variable language_">global</span>.<span class="property">render</span> = render;</span><br><span class="line"><span class="variable language_">global</span>.<span class="property">mount</span> = mount;</span><br></pre></td></tr></table></figure>
<p>å¯¹äºCSSæ¨¡å—ï¼Œæ·»åŠ ä»¥ä¸‹é…ç½®åˆ°package.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;jest&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;moduleNameMapper&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;^.+\\.(css|scss)$&quot;</span><span class="punctuation">:</span> <span class="string">&quot;identity-obj-proxy&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>è¿è¡Œå‘½ä»¤è¿›è¡Œæµ‹è¯•</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jest --env=jsdom --coverage --no-cache --detectOpenHandles</span><br></pre></td></tr></table></figure>
<p>jestå¯ä»¥æµ‹è¯•çš„ç‰¹æ€§æœ‰ï¼š</p>
<ul>
<li>component render</li>
<li>props</li>
<li>events</li>
<li>event handlers<br>
â€¦</li>
</ul>
<p>æ›´å¤šä¾‹å­å¯ä»¥å‚è€ƒ<a target="_blank" rel="noopener" href="https://jestjs.io/">è¿™é‡Œ</a>ã€‚</p>
<h2 id="ESLint"><a class="header-anchor" href="#ESLint">Â¶</a>ESLint</h2>
<p>é¦–å…ˆåŠ å…¥ä¾èµ–ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev eslint eslint-config-airbnb-base eslint-loader eslint-plugin-import eslint-plugin-react typescript-eslint-parser</span><br></pre></td></tr></table></figure>
<p>ESLintç”¨äºä»£ç æ£€æŸ¥ç”¨ï¼Œé…ç½®ä¹Ÿæ¯”è¾ƒæ— è„‘ï¼Œå½“ä½ ç”¨åƒWebStormè¿™äº›å¼€å‘å·¥å…·æ—¶ï¼Œå·¥å…·ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°ESLintï¼Œè‡ªåŠ¨ä¸ºä½ æ ¼å¼åŒ–å’Œæ£€æŸ¥ä»£ç ã€‚ä¸‹é¢æ˜¯æˆ‘è‡ªå·±çš„ä¸€ä»½é…ç½®ï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="attr">browser:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">commonjs:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">es6:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">jest:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">ecmaFeatures:</span></span><br><span class="line">  <span class="attr">modules:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">spread:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">restParams:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">extends:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;eslint:recommended&#x27;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;plugin:react/recommended&#x27;</span></span><br><span class="line"><span class="attr">parser:</span> <span class="string">&#x27;babel-eslint&#x27;</span></span><br><span class="line"><span class="attr">parserOptions:</span></span><br><span class="line">  <span class="attr">ecmaFeatures:</span></span><br><span class="line">    <span class="attr">jsx:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">ecmaVersion:</span> <span class="number">2018</span></span><br><span class="line">  <span class="attr">sourceType:</span> <span class="string">module</span></span><br><span class="line"><span class="attr">plugins:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">react</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="attr">indent:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">error</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">linebreak-style:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">error</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">windows</span></span><br><span class="line">  <span class="attr">quotes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">error</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">single</span></span><br><span class="line">  <span class="attr">semi:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">error</span></span><br><span class="line">  <span class="attr">comma-dangle:</span> <span class="string">off</span></span><br><span class="line">  <span class="attr">no-unused-vars:</span> <span class="string">warn</span></span><br><span class="line">  <span class="attr">no-console:</span> <span class="string">error</span></span><br><span class="line">  <span class="attr">no-unexpected-multiline:</span> <span class="string">warn</span></span><br><span class="line">  <span class="attr">import/prefer-default-export:</span> <span class="string">off</span></span><br><span class="line"><span class="attr">settings:</span></span><br><span class="line">  <span class="attr">react:</span></span><br><span class="line">    <span class="attr">pragma:</span> <span class="string">React</span></span><br><span class="line">    <span class="attr">version:</span> <span class="string">detect</span></span><br></pre></td></tr></table></figure>
<p>åƒVSCodeï¼Œå¯ä»¥åœ¨é¦–é€‰é¡¹ -&gt; è®¾ç½® ä¸­æ‰¾åˆ°eslint.validateï¼ŒåŠ å…¥typescriptä¸typescriptreactï¼Œåˆ†åˆ«ç”¨äºç›‘å¬tsä¸tsxæ–‡ä»¶ï¼Œå¦‚ä¸‹</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;eslint.validate&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;javascript&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;javascriptreact&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;typescript&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;typescriptreact&quot;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<p>æ›´å¤šé…ç½®å¯ä»¥è‡ªå·±å®šåˆ¶ã€‚</p>
<h2 id="Storybook"><a class="header-anchor" href="#Storybook">Â¶</a>Storybook</h2>
<p>storybookçš„ä¸»è¦ä½œç”¨æ˜¯ä¸ºè‡ªå·±å®ç°çš„ç»„ä»¶ç¼–å†™æ–‡æ¡£ï¼Œå¯ä»¥åœ¨<a target="_blank" rel="noopener" href="https://storybook.js.org/">è¿™é‡Œ</a>æŸ¥çœ‹æ›´å¤šç»†èŠ‚ã€‚</p>
<p>å®‰è£…storybookï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev @storybook/react</span><br></pre></td></tr></table></figure>
<p>åŠ å…¥package.jsonçš„script</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;storybook&quot;</span><span class="punctuation">:</span> <span class="string">&quot;start-storybook -p 9001 -c .storybook&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>é»˜è®¤storybookä¼šåœ¨.storybookæ–‡ä»¶å¤¹ä½œä¸ºé…ç½®ï¼Œé…ç½®æ–‡ä»¶ä¸ºconfig.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .storybook/config.jsä¸­ä¿®æ”¹è·¯å¾„</span></span><br><span class="line"><span class="keyword">import</span> &#123; configure &#125; <span class="keyword">from</span> <span class="string">&#x27;@storybook/react&#x27;</span>;</span><br><span class="line"><span class="comment">// src/stories/button.stories.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> req = <span class="built_in">require</span>.<span class="title function_">context</span>(<span class="string">&#x27;../src/stories&#x27;</span>, <span class="literal">true</span>, <span class="regexp">/\.stories\.js$/</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadStories</span>(<span class="params"></span>) &#123;</span><br><span class="line">  req.<span class="title function_">keys</span>().<span class="title function_">forEach</span>(<span class="function">(<span class="params">filename</span>) =&gt;</span> <span class="title function_">req</span>(filename));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">configure</span>(loadStories, <span class="variable language_">module</span>);</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢é…ç½®æŒ‡å®šäº†åˆ›å»ºstoriesçš„ä½ç½®ï¼Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// .storybook/config.jsä¸­ä¿®æ”¹è·¯å¾„</span><br><span class="line">import &#123; configure &#125; from &#x27;@storybook/react&#x27;;</span><br><span class="line"></span><br><span class="line">function loadStories() &#123;</span><br><span class="line">  require(&#x27;../src/stories/button.stories.js&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">configure(loadStories, module);</span><br><span class="line"></span><br><span class="line">// src/stories/button.stories.js</span><br><span class="line">import React from &#x27;react&#x27;;</span><br><span class="line">import &#123; storiesOf &#125; from &#x27;@storybook/react&#x27;;</span><br><span class="line">import &#123;Button&#125; from &#x27;../components/Button&#x27;;</span><br><span class="line"></span><br><span class="line">storiesOf(&#x27;Button&#x27;, module)</span><br><span class="line">  .add(&#x27;åŸºæœ¬ç”¨æ³•&#x27;,() =&gt; (</span><br><span class="line">    &lt;Button&gt;æŒ‰é’®&lt;/Button&gt;</span><br><span class="line">  ))</span><br><span class="line">  </span><br><span class="line">// src/components/Button.js</span><br><span class="line">import React from &#x27;react&#x27;</span><br><span class="line"></span><br><span class="line">export class Button extends React.Component&#123;</span><br><span class="line">  constructor (props) &#123;</span><br><span class="line">    super(props)    </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render () &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;button style=&#123;&#123;backgroundColor: &#x27;#fff&#x27;, border: &#x27;1px solid #ccc&#x27;&#125;&#125;&gt;&#123;this.props.children&#125;&lt;/button&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨stroybookæœåŠ¡</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn storybook</span><br></pre></td></tr></table></figure>
<p><img src="/img/react/storybook-script.png" alt="storybook"></p>
<p>é»˜è®¤ä¼šè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨</p>
<p><img src="/img/react/storybook.png" alt="storybook"></p>
<p>å‡ºç°ä»¥ä¸Šé¡µé¢è¯´æ˜é…ç½®å·²ç»æˆåŠŸäº†ã€‚</p>
<h2 id="Live-Editing"><a class="header-anchor" href="#Live-Editing">Â¶</a>Live Editing</h2>
<p>é»˜è®¤åœ°ï¼Œwebpackçš„development modeåœ¨æ¯æ¬¡æ›´æ–°ä»£ç æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ·æ–°é¡µé¢ã€‚ä½†åˆ·æ–°ä¸åŒäºLive Editï¼Œæˆ‘ä¸å¸Œæœ›ç¼–å†™ä¸€ä¸ªCSSè¿˜è¦é‡æ–°refreshä¸€ä¸‹ï¼Œé¡µé¢ç›´æ¥å˜åŒ–å°±æœ€å¥½äº†ï¼æœ‰å¾ˆå¤šå·¥å…·å¯ä»¥å®ç°è¿™ç§æ–¹å¼ï¼Œè¿™é‡Œä»…ä»‹ç»react-hot-loaderï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev react-hot-loader</span><br></pre></td></tr></table></figure>
<p>åœ¨scripté‡Œé¢åŠ å…¥ä¸€ä¸ª<code>--hot</code>é€‰é¡¹å³å¯ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">	&quot;start&quot;: &quot;./node_modules/.bin/webpack-dev-server --hot --mode development --progress --colors --config ./webpack.config.js&quot;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>å‡ºç°ä»¥ä¸‹æ•ˆæœï¼Œè¯´æ˜Live EditingåŠŸèƒ½å®ç°äº†ã€‚</p>
<video src='/img/react/react-hot-loader.mp4' type='video/mp4' controls='controls'  width='100%' height='100%'>
</video>
<h2 id="Summary"><a class="header-anchor" href="#Summary">Â¶</a>Summary</h2>
<p>ç”±äºä½¿ç”¨çš„ä¸œè¥¿æ¯”è¾ƒå¤šï¼Œè€Œä¸”å¼€å‘çš„æ–¹å¼ä¹Ÿæ¯”è¾ƒçµæ´»ï¼Œå…·ä½“æŠ€æœ¯ç»†èŠ‚å¯ä»¥å…·ä½“æ·±å…¥ç†è§£ã€‚</p>
<p>å®Œæ•´ä»£ç ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„<a target="_blank" rel="noopener" href="https://github.com/barudisshu/galilei-ui">github</a></p>
</div></article><nav class="article-nav"><div class="article-nav-prev">ğŸ”™<a href="/2019/01/24/postgresql/postgresql-relational-databases-on-centos-7/">CentOS 7 å®‰è£…ã€é…ç½®ã€ä½¿ç”¨PostgreSQLåŠPostGIS</a></div><div class="article-nav-next">ğŸ”œ<a href="/2018/12/23/ideal/using-intellij-bookmarks/">åœ¨IntelliJåˆ›å»ºæ ‡ç­¾</a></div></nav><div id="base-discus"><div id="disqus_thread"></div><script>var disqus_shortname = 'barudisshu-github-io';
var disqus_identifier = '2019/01/16/react/react-storybook-live-editing/';
var disqus_title = 'ä½¿ç”¨storybookå¼€å‘è‡ªå·±çš„Reactç»„ä»¶åº“';
var disqus_url = 'https://galudisu.info/2019/01/16/react/react-storybook-live-editing/';
(function () {
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async>  </script></div></div></div><footer class="base-footer"><div class="footer-wrapper"><span>Â©2016 - 2025 <a href="https://galudisu.info">barudisshu</a>, unless otherwise noted.</span></div></footer><div class="dom-ready">
<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>

<link rel="stylesheet" href="//cdn.bootcss.com/pace/1.0.2/themes/green/pace-theme-flash.min.css">

<script src="/js/base.js"></script>

<script src="/js/rabbit-lyrics.js"></script>
</div></body></html>