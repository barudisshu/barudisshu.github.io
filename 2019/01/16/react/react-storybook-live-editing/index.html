<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><title>使用storybook开发自己的React组件库</title>
<link rel="stylesheet" href="/css/layout.css">
<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="/css/vendors/rabbit-lyrics.css">
<link rel="shortcut icon" href="/img/favicon.ico"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="简单易懂の现代魔法" type="application/atom+xml">
</head><body><header class="base-menu"><div class="menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">简单易懂の现代魔法</a></li><li class="menu-item"><a class="menu-link" href="/maths/">Maths</a></li><li class="menu-item"><a class="menu-link" href="/projects/">Projects</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav></div></header><header class="base-mobile-menu"><div class="mobile-menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">简单易懂の现代魔法</a></li><li class="menu-item"><a class="menu-link" href="/maths/">Maths</a></li><li class="menu-item"><a class="menu-link" href="/projects/">Projects</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav><div class="toggle-menu" id="mobile-menu-toggle"><span class="menu-bar"></span><span class="menu-bar"> </span><span class="menu-bar"></span></div></div></header><div class="base-content"><div class="base-content-main"><article class="article-main"><h1 class="article-title">使用storybook开发自己的React组件库</h1><div class="article-meta"><p class="meta-item meta-time"><span class="meta-item-title"></span><i class="icon-calendar"> </i>2019-01-16</p><p class="meta-item meta-tag"><span class="meta-item-title"></span><i class="icon-tags"> </i><a class="tag-link" href="/tags/react/">react<span class="tag">, </span></a><a class="tag-link" href="/tags/redux/">redux<span class="tag">, </span></a><a class="tag-link" href="/tags/webpack/">webpack<span class="tag">, </span></a><a class="tag-link" href="/tags/hot/">hot</a></p></div><div class="article-content"><p><img src="/img/cartoon/20190116_225744.925.jpg" alt="ohanahibi"><br>
有时候并不希望使用第三方组件库，以及大部分时候需要自己定制一套组件实现，以供公司或项目内部使用。开发自己的组件有如重复造轮子，会花费相当多的精力制造。如果是为了一种长远公司发展，这份努力是值得的，如果不想自己耗费精力，也有许多开源的组件实现，比如<a target="_blank" rel="noopener" href="https://material-ui.com/">material-ui</a>。一般都是拿来改造一下，可以避免很多开发或兼容性上的坑。</p>
<span id="more"></span>
<h2 id="Architecture"><a class="header-anchor" href="#Architecture">¶</a>Architecture</h2>
<p>编写这篇文章时，笔者用的都是最新的包以及依赖，坑比较多，比如<a target="_blank" rel="noopener" href="https://webpack.js.org/">webpack4</a>，改掉以及删除很多功能；又如<a target="_blank" rel="noopener" href="https://babeljs.io/docs/en/v7-migration">babel7</a>弃用了旧的写法，全部带上了<code>scoped packages</code>，即在presets前面带上模块标志：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [<span class="string">&quot;@babel/env&quot;</span>], <span class="comment">// &quot;@babel/preset-env&quot;</span></span><br><span class="line">  <span class="attr">plugins</span>: [<span class="string">&quot;@babel/transform-arrow-functions&quot;</span>], <span class="comment">// same as &quot;@babel/plugin-transform-arrow-functions&quot;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>主要关键技术：</p>
<ul>
<li>webpack</li>
<li>typescript</li>
<li>react</li>
<li>state management(redux or mobx)</li>
<li>react-router-4</li>
<li>component hot reload</li>
<li>svg icon</li>
<li>jest</li>
<li>UI lib</li>
<li>less</li>
<li>eslint</li>
</ul>
<p>主要库以及版本：</p>
<ul>
<li>webpack			4.x.x</li>
<li>typescript		2.9.x</li>
<li>react				16.7.x</li>
<li>react-router-dom	4.2.x</li>
<li>react-hot-loader	4.6.x<br>
…</li>
<li>node				10.13.x</li>
</ul>
<p>注意：react-router v4为第四代react-router，react-dom为v2或v3的旧版本。新版本的react-router v4可以说是重写了路由，react-router v4 被一分为三：<code>react-router-dom</code>(for web)、<code>react-router-native</code>(for native)、<code>react-router</code>(core)。仅在浏览器中使用的话，一般引入<code>react-router-dom</code>即可。如果从旧版本迁移，可以参考<a target="_blank" rel="noopener" href="https://github.com/gmfe/Think/issues/6">这里</a>。</p>
<p>目录结构：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">--.storybook</span><br><span class="line">--public			模板目录</span><br><span class="line">--src</span><br><span class="line">  --components 		自定义组件</span><br><span class="line">  --docs			代码入口&lt;App/&gt;</span><br><span class="line">  --stories			文档说明</span><br><span class="line">eslintrc.yml</span><br><span class="line">tsconfig.json</span><br><span class="line">.babelrc</span><br><span class="line">package.json		依赖包</span><br><span class="line">webpack.config.js</span><br></pre></td></tr></table></figure>
<h2 id="Babel"><a class="header-anchor" href="#Babel">¶</a>Babel</h2>
<p>Babel用于将浏览器不能识别的ES以及TS转换为JS，首先添加依赖：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev @babel/core @babel/cli @babel/preset-env @babel/preset-react @babel/preset-typescript @babel/plugin-proposal-object-rest-spread @babel/plugin-transform-runtime</span><br></pre></td></tr></table></figure>
<p>然后在根目录添加.babelrc，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;presets&quot;: [</span><br><span class="line">    &quot;@babel/preset-env&quot;,</span><br><span class="line">    &quot;@babel/preset-react&quot;,</span><br><span class="line">    &quot;@babel/preset-typescript&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;plugins&quot;: [</span><br><span class="line">    &quot;@babel/plugin-proposal-object-rest-spread&quot;,</span><br><span class="line">    &quot;@babel/plugin-transform-runtime&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Unit-Test"><a class="header-anchor" href="#Unit-Test">¶</a>Unit Test</h2>
<p>添加单元测试，单测默认识别目录<code>__tests__</code>，例如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">--src</span><br><span class="line">  --components</span><br><span class="line">    --Link</span><br><span class="line">	  --__tests__</span><br><span class="line">	    Link.react.test.js</span><br><span class="line">	  Link.react.js</span><br><span class="line">    index.js</span><br></pre></td></tr></table></figure>
<p>首先，使用TypeScript编写一个组件，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PropTypes</span> <span class="keyword">from</span> <span class="string">&#x27;prop-types&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">STATUS</span> = &#123;</span><br><span class="line">  <span class="attr">HOVERED</span>: <span class="string">&#x27;hovered&#x27;</span>,</span><br><span class="line">  <span class="attr">NORMAL</span>: <span class="string">&#x27;normal&#x27;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">MLink</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_onMouseEnter</span> = <span class="variable language_">this</span>.<span class="property">_onMouseEnter</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_onMouseLeave</span> = <span class="variable language_">this</span>.<span class="property">_onMouseLeave</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">      <span class="attr">class</span>: <span class="variable constant_">STATUS</span>.<span class="property">NORMAL</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">_onMouseEnter</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">class</span>: <span class="variable constant_">STATUS</span>.<span class="property">HOVERED</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">_onMouseLeave</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">class</span>: <span class="variable constant_">STATUS</span>.<span class="property">NORMAL</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">a</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">className</span>=<span class="string">&#123;this.state.class&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">href</span>=<span class="string">&#123;this.props.page</span> || &#x27;#&#x27;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onMouseEnter</span>=<span class="string">&#123;this._onMouseEnter&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onMouseLeave</span>=<span class="string">&#123;this._onMouseLeave&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;this.props.children&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">MLink</span>.<span class="property">propTypes</span> = &#123;</span><br><span class="line">  <span class="attr">children</span>: <span class="title class_">PropTypes</span>.<span class="property">node</span>.<span class="property">isRequired</span>,</span><br><span class="line">  <span class="attr">page</span>: <span class="title class_">PropTypes</span>.<span class="property">node</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>对应其<code>__tests__</code>目录添加单元测试，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MLink.react.test.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MLink</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../Link.react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> renderer <span class="keyword">from</span> <span class="string">&#x27;react-test-renderer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">test</span>(<span class="string">&#x27;MLink changes the class when hovered&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> component = renderer.<span class="title function_">create</span>(</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">MLink</span> <span class="attr">page</span>=<span class="string">&quot;http://www.facebook.com&quot;</span>&gt;</span>Facebook<span class="tag">&lt;/<span class="name">MLink</span>&gt;</span></span>,</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">let</span> tree = component.<span class="title function_">toJSON</span>();</span><br><span class="line">  <span class="title function_">expect</span>(tree).<span class="title function_">toMatchSnapshot</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// manually trigger the callback</span></span><br><span class="line">  tree.<span class="property">props</span>.<span class="title function_">onMouseEnter</span>();</span><br><span class="line">  <span class="comment">// re-rendering</span></span><br><span class="line">  tree = component.<span class="title function_">toJSON</span>();</span><br><span class="line">  <span class="title function_">expect</span>(tree).<span class="title function_">toMatchSnapshot</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// manually trigger the callback</span></span><br><span class="line">  tree.<span class="property">props</span>.<span class="title function_">onMouseLeave</span>();</span><br><span class="line">  <span class="comment">// re-rendering</span></span><br><span class="line">  tree = component.<span class="title function_">toJSON</span>();</span><br><span class="line">  <span class="title function_">expect</span>(tree).<span class="title function_">toMatchSnapshot</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>把单元测试所需的配置补充上，添加单元测试所需要的依赖</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev jest @types/jest babel-jest ts-jest</span><br></pre></td></tr></table></figure>
<p>另外还需要一个Enzyme，它是React的测试工具，还需要enzyme-to-json 转换，</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev jest react-test-renderer enzyme enzyme-adapter-react-16 enzyme-to-json</span><br></pre></td></tr></table></figure>
<p>更新一下package.json，加上对应的脚本</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jest&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;test:watch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jest --watch&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;test:coverage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jest --coverage&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;jest&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;setupFiles&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;./test/jestsetup.js&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;snapshotSerializers&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;enzyme-to-json/serializer&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>创建一个test/jestsetup.js文件，自定义测试环境</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Enzyme</span>, &#123; shallow, render, mount &#125; <span class="keyword">from</span> <span class="string">&#x27;enzyme&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Adapter</span> <span class="keyword">from</span> <span class="string">&#x27;enzyme-adapter-react-16&#x27;</span>;</span><br><span class="line"><span class="comment">// React 16 Enzyme adapter</span></span><br><span class="line"><span class="title class_">Enzyme</span>.<span class="title function_">configure</span>(&#123; <span class="attr">adapter</span>: <span class="keyword">new</span> <span class="title class_">Adapter</span>() &#125;);</span><br><span class="line"><span class="comment">// Make Enzyme functions available in all test files without importing</span></span><br><span class="line"><span class="variable language_">global</span>.<span class="property">shallow</span> = shallow;</span><br><span class="line"><span class="variable language_">global</span>.<span class="property">render</span> = render;</span><br><span class="line"><span class="variable language_">global</span>.<span class="property">mount</span> = mount;</span><br></pre></td></tr></table></figure>
<p>对于CSS模块，添加以下配置到package.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;jest&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;moduleNameMapper&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;^.+\\.(css|scss)$&quot;</span><span class="punctuation">:</span> <span class="string">&quot;identity-obj-proxy&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>运行命令进行测试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jest --env=jsdom --coverage --no-cache --detectOpenHandles</span><br></pre></td></tr></table></figure>
<p>jest可以测试的特性有：</p>
<ul>
<li>component render</li>
<li>props</li>
<li>events</li>
<li>event handlers<br>
…</li>
</ul>
<p>更多例子可以参考<a target="_blank" rel="noopener" href="https://jestjs.io/">这里</a>。</p>
<h2 id="ESLint"><a class="header-anchor" href="#ESLint">¶</a>ESLint</h2>
<p>首先加入依赖：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev eslint eslint-config-airbnb-base eslint-loader eslint-plugin-import eslint-plugin-react typescript-eslint-parser</span><br></pre></td></tr></table></figure>
<p>ESLint用于代码检查用，配置也比较无脑，当你用像WebStorm这些开发工具时，工具会自动检测到ESLint，自动为你格式化和检查代码。下面是我自己的一份配置：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="attr">browser:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">commonjs:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">es6:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">jest:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">ecmaFeatures:</span></span><br><span class="line">  <span class="attr">modules:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">spread:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">restParams:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">extends:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;eslint:recommended&#x27;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;plugin:react/recommended&#x27;</span></span><br><span class="line"><span class="attr">parser:</span> <span class="string">&#x27;babel-eslint&#x27;</span></span><br><span class="line"><span class="attr">parserOptions:</span></span><br><span class="line">  <span class="attr">ecmaFeatures:</span></span><br><span class="line">    <span class="attr">jsx:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">ecmaVersion:</span> <span class="number">2018</span></span><br><span class="line">  <span class="attr">sourceType:</span> <span class="string">module</span></span><br><span class="line"><span class="attr">plugins:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">react</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="attr">indent:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">error</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">linebreak-style:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">error</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">windows</span></span><br><span class="line">  <span class="attr">quotes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">error</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">single</span></span><br><span class="line">  <span class="attr">semi:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">error</span></span><br><span class="line">  <span class="attr">comma-dangle:</span> <span class="string">off</span></span><br><span class="line">  <span class="attr">no-unused-vars:</span> <span class="string">warn</span></span><br><span class="line">  <span class="attr">no-console:</span> <span class="string">error</span></span><br><span class="line">  <span class="attr">no-unexpected-multiline:</span> <span class="string">warn</span></span><br><span class="line">  <span class="attr">import/prefer-default-export:</span> <span class="string">off</span></span><br><span class="line"><span class="attr">settings:</span></span><br><span class="line">  <span class="attr">react:</span></span><br><span class="line">    <span class="attr">pragma:</span> <span class="string">React</span></span><br><span class="line">    <span class="attr">version:</span> <span class="string">detect</span></span><br></pre></td></tr></table></figure>
<p>像VSCode，可以在首选项 -&gt; 设置 中找到eslint.validate，加入typescript与typescriptreact，分别用于监听ts与tsx文件，如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;eslint.validate&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;javascript&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;javascriptreact&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;typescript&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;typescriptreact&quot;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<p>更多配置可以自己定制。</p>
<h2 id="Storybook"><a class="header-anchor" href="#Storybook">¶</a>Storybook</h2>
<p>storybook的主要作用是为自己实现的组件编写文档，可以在<a target="_blank" rel="noopener" href="https://storybook.js.org/">这里</a>查看更多细节。</p>
<p>安装storybook：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev @storybook/react</span><br></pre></td></tr></table></figure>
<p>加入package.json的script</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;storybook&quot;</span><span class="punctuation">:</span> <span class="string">&quot;start-storybook -p 9001 -c .storybook&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>默认storybook会在.storybook文件夹作为配置，配置文件为config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .storybook/config.js中修改路径</span></span><br><span class="line"><span class="keyword">import</span> &#123; configure &#125; <span class="keyword">from</span> <span class="string">&#x27;@storybook/react&#x27;</span>;</span><br><span class="line"><span class="comment">// src/stories/button.stories.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> req = <span class="built_in">require</span>.<span class="title function_">context</span>(<span class="string">&#x27;../src/stories&#x27;</span>, <span class="literal">true</span>, <span class="regexp">/\.stories\.js$/</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadStories</span>(<span class="params"></span>) &#123;</span><br><span class="line">  req.<span class="title function_">keys</span>().<span class="title function_">forEach</span>(<span class="function">(<span class="params">filename</span>) =&gt;</span> <span class="title function_">req</span>(filename));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">configure</span>(loadStories, <span class="variable language_">module</span>);</span><br></pre></td></tr></table></figure>
<p>上面配置指定了创建stories的位置，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// .storybook/config.js中修改路径</span><br><span class="line">import &#123; configure &#125; from &#x27;@storybook/react&#x27;;</span><br><span class="line"></span><br><span class="line">function loadStories() &#123;</span><br><span class="line">  require(&#x27;../src/stories/button.stories.js&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">configure(loadStories, module);</span><br><span class="line"></span><br><span class="line">// src/stories/button.stories.js</span><br><span class="line">import React from &#x27;react&#x27;;</span><br><span class="line">import &#123; storiesOf &#125; from &#x27;@storybook/react&#x27;;</span><br><span class="line">import &#123;Button&#125; from &#x27;../components/Button&#x27;;</span><br><span class="line"></span><br><span class="line">storiesOf(&#x27;Button&#x27;, module)</span><br><span class="line">  .add(&#x27;基本用法&#x27;,() =&gt; (</span><br><span class="line">    &lt;Button&gt;按钮&lt;/Button&gt;</span><br><span class="line">  ))</span><br><span class="line">  </span><br><span class="line">// src/components/Button.js</span><br><span class="line">import React from &#x27;react&#x27;</span><br><span class="line"></span><br><span class="line">export class Button extends React.Component&#123;</span><br><span class="line">  constructor (props) &#123;</span><br><span class="line">    super(props)    </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render () &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;button style=&#123;&#123;backgroundColor: &#x27;#fff&#x27;, border: &#x27;1px solid #ccc&#x27;&#125;&#125;&gt;&#123;this.props.children&#125;&lt;/button&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动stroybook服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn storybook</span><br></pre></td></tr></table></figure>
<p><img src="/img/react/storybook-script.png" alt="storybook"></p>
<p>默认会自动打开浏览器</p>
<p><img src="/img/react/storybook.png" alt="storybook"></p>
<p>出现以上页面说明配置已经成功了。</p>
<h2 id="Live-Editing"><a class="header-anchor" href="#Live-Editing">¶</a>Live Editing</h2>
<p>默认地，webpack的development mode在每次更新代码时，会自动刷新页面。但刷新不同于Live Edit，我不希望编写一个CSS还要重新refresh一下，页面直接变化就最好了！有很多工具可以实现这种方式，这里仅介绍react-hot-loader：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev react-hot-loader</span><br></pre></td></tr></table></figure>
<p>在script里面加入一个<code>--hot</code>选项即可。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">	&quot;start&quot;: &quot;./node_modules/.bin/webpack-dev-server --hot --mode development --progress --colors --config ./webpack.config.js&quot;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>出现以下效果，说明Live Editing功能实现了。</p>
<video src='/img/react/react-hot-loader.mp4' type='video/mp4' controls='controls'  width='100%' height='100%'>
</video>
<h2 id="Summary"><a class="header-anchor" href="#Summary">¶</a>Summary</h2>
<p>由于使用的东西比较多，而且开发的方式也比较灵活，具体技术细节可以具体深入理解。</p>
<p>完整代码，可以参考我的<a target="_blank" rel="noopener" href="https://github.com/barudisshu/galilei-ui">github</a></p>
</div></article><nav class="article-nav"><div class="article-nav-prev"><a href="/2019/01/24/postgresql/postgresql-relational-databases-on-centos-7/">CentOS 7 安装、配置、使用PostgreSQL及PostGIS</a></div><div class="article-nav-next"><a href="/2018/12/23/ideal/using-intellij-bookmarks/">在IntelliJ创建标签</a></div></nav><div id="base-discus"><div id="disqus_thread"></div><script>var disqus_shortname = 'barudisshu-github-io';
var disqus_identifier = '2019/01/16/react/react-storybook-live-editing/';
var disqus_title = '使用storybook开发自己的React组件库';
var disqus_url = 'https://galudisu.info/2019/01/16/react/react-storybook-live-editing/';
(function () {
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async>  </script></div></div></div><footer class="base-footer"><div class="footer-wrapper"><span>©2016 - 2025 <a href="https://galudisu.info">barudisshu</a>, unless otherwise noted.</span></div></footer><div class="dom-ready">
<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>

<link rel="stylesheet" href="//cdn.bootcss.com/pace/1.0.2/themes/green/pace-theme-flash.min.css">

<script src="/js/base.js"></script>

<script src="/js/rabbit-lyrics.js"></script>
</div></body></html>