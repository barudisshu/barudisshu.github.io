<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><title>Akka Typed åè®®å’Œè¡Œä¸º</title>
<link rel="stylesheet" href="/css/layout.css">
<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="/css/vendors/rabbit-lyrics.css">
<link rel="shortcut icon" href="/img/favicon.ico"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ç®€å•æ˜“æ‡‚ã®ç°ä»£é­”æ³•" type="application/atom+xml">
</head><body><header class="base-menu"><div class="menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">ç®€å•æ˜“æ‡‚ã®ç°ä»£é­”æ³•</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav></div></header><header class="base-mobile-menu"><div class="mobile-menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">ç®€å•æ˜“æ‡‚ã®ç°ä»£é­”æ³•</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav><div class="toggle-menu" id="mobile-menu-toggle"><span class="menu-bar"></span><span class="menu-bar"> </span><span class="menu-bar"></span></div></div></header><div class="base-content"><div class="base-content-main"><article class="article-main"><h1 class="article-title">Akka Typed åè®®å’Œè¡Œä¸º</h1><div class="article-meta"><p class="meta-item meta-time"><span class="meta-item-title"></span><i class="icon-calendar"> </i>2020-01-03</p><p class="meta-item meta-tag"><span class="meta-item-title"></span><i class="icon-tag"> </i><a class="tag-link" href="/tags/akka-typed/">akka-typed</a></p><p class="meta-item meta-category"><span class="meta-item-title"></span><i class="icon-bookmark"> </i><a class="category-link" href="/categories/akka/">akka</a></p></div><div class="article-content"><p>2019å¹´11æœˆ6å·LightBendå…¬å¸å‘å¸ƒäº†AKKA 2.6ç‰ˆæœ¬ï¼Œå¸¦æ¥äº†ç±»å‹å®‰å…¨çš„actorï¼Œæ–°çš„Akka Clusteråº•å±‚é€šä¿¡è®¾æ–½â€”â€”Arteryï¼Œå¸¦æ¥äº†æ›´å¥½çš„ç¨³å®šæ€§ï¼Œä½¿ç”¨Jacksonè¿›è¡Œæ¶ˆæ¯åºåˆ—åŒ–ï¼Œæ”¯æŒSLF4Jæ—¥å¿—æ¥å£ã€‚</p>
<h2 id="Why-Akka-Typed"><a class="header-anchor" href="#Why-Akka-Typed">Â¶</a>Why Akka Typed</h2>
<p>actorç¼–ç¨‹æ¨¡å‹æ˜¯ä¸€ä¸ªå¼ºæœ‰åŠ›çš„æŠ½è±¡æ¨¡å‹ï¼Œå°¤å…¶æ“…é•¿è§£å†³çœŸå®ä¸–ç•Œå»ºæ¨¡ï¼Œå®¹é”™ã€å¹¶å‘ã€åˆ†å¸ƒå¼ç³»ç»Ÿé—®é¢˜ã€‚actoræŠ½è±¡ç¼–ç¨‹æ¨¡å‹æ„å»ºäºåœ¨äº’ç›¸ç‹¬ç«‹çš„actorä¹‹é—´å‘é€æ¶ˆæ¯çš„åŸºç¡€ä¹‹ä¸Šï¼Œactorå¯ä»¥åˆ›å»ºå­actorï¼Œå¹¶è´Ÿè´£ç›‘ç®¡ï¼Œå½“å­actorå‡ºç°é”™è¯¯çš„æ—¶å€™å¯ä»¥é‡å¯æˆ–è€…é‡æ–°åˆ›å»ºï¼Œè¿™å¥—å®¹é”™æœºåˆ¶ç»™æ•´ä¸ªactorç³»ç»Ÿå¸¦æ¥äº†è‡ªæ„ˆèƒ½åŠ›ã€‚</p>
<p>ç»å…¸çš„Akka actor APIéå¸¸ç®€å•ï¼Œå°±æ˜¯æä¾›ä¸€ç»„å¤„ç†å’Œæ¥æ”¶æ¶ˆæ¯çš„å‡½æ•°ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// the Actor trait (AbstractActor class in Java) is the entry point for using the API</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrderProcessor</span> <span class="keyword">extends</span> <span class="title">Actor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// receiveæ–¹æ³•å¤„ç†æ¶ˆæ¯</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">receive</span></span>: <span class="type">Receive</span> = &#123;</span><br><span class="line">    <span class="keyword">case</span> order @ <span class="type">OrderProcessor</span>.<span class="type">ProcessOrder</span> =&gt;</span><br><span class="line">	  <span class="comment">// actoræ–¹æ³•ç¹è¡æ–°çš„actor</span></span><br><span class="line">	  <span class="keyword">val</span> connection = context.actorOf(</span><br><span class="line">	    <span class="type">BankConnection</span>.props(order.bankIndentifier)</span><br><span class="line">	  )</span><br><span class="line">	  <span class="comment">// !æ–¹æ³•è¡¨ç¤ºå³å‘å³å¼ƒ</span></span><br><span class="line">	  connection ! <span class="type">BankConnection</span>.<span class="type">ExecuteOrder</span>(order)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§ç¼–ç¨‹æ¨¡å‹å’ŒAPIåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å…·æœ‰æ˜¾è‘—çš„ä¼˜åŠ¿ï¼Œæ¯ä¸ªactoré¡ºåºå¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œactorçš„å†…éƒ¨çŠ¶æ€ä¹Ÿåªæœ‰å®ƒæœ¬èº«å¯ä»¥ä¿®æ”¹ï¼Œè¿™æ¯”å¹¶å‘çš„ä¿®æ”¹å…±äº«çŠ¶æ€å®¹æ˜“å¤šäº†ã€‚</p>
<p>å¤©ä¸‹æ²¡æœ‰å…è´¹çš„åˆé¤ï¼Œactorç¼–ç¨‹æ¨¡å‹ä¹Ÿæœ‰å®ƒçš„ç¼ºç‚¹ï¼Œæ§½ç‚¹åœ¨è¿™ç¯‡æ–‡ç« ä¸­æœ‰æåˆ°ï¼š<a target="_blank" rel="noopener" href="https://manuel.bernhardt.io/2017/05/29/akka-anti-patterns-overview/">Akka anti-patterns series</a></p>
<p>è¿™äº›å¹´æ¥æˆ‘åœ¨ä¸€äº›ç¨å¾®å¤§ä¸€äº›çš„Akkaå·¥ç¨‹ä¸­è§åˆ°çš„æœ€å¤§çš„é—®é¢˜æ˜¯actorç³»ç»Ÿéšç€ä¸šåŠ¡è¶Šåšè¶Šå¤§ï¼Œå¹¶ä¸”éå¸¸éš¾ä»¥æ‰©å±•ã€‚æ ¹æœ¬åŸå› æ˜¯è¿™å¥—Akka APIæ²¡æœ‰å¼ºåˆ¶ç”¨æˆ·é‡‡ç”¨â€œåè®®ä¼˜å…ˆâ€çš„è§„èŒƒã€‚å®é™…ä¸ŠAkkaå®˜æ–¹æ•™ç¨‹é‡Œæœ€å…ˆè®²è¿°çš„å°±æ˜¯æ¸…æ™°çš„å®šä¹‰ç»„ä»¶ä¹‹é—´çš„é€šä¿¡åè®®ï¼ˆä¹Ÿå°±æ˜¯æ¶ˆæ¯ï¼‰ï¼Œå¹¶ä½¿ç”¨å…¨è·¯å¾„è®¿é—®æ¶ˆæ¯ã€‚å·²ä¸Šé¢çš„ä¾‹å­æ¥è¯´ï¼ŒOrderProcessorçš„é€šä¿¡åè®®å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼´ç”Ÿå¯¹è±¡å­˜æ”¾äº†æ¶ˆæ¯çš„å®šä¹‰</span></span><br><span class="line"><span class="comment">// å¯¹äºé›†ç¾¤æˆ–æŒä¹…åŒ–ç³»ç»Ÿï¼Œæ¶ˆæ¯å®šä¹‰éœ€è¦ä½¿ç”¨åˆé€‚çš„åºåˆ—åŒ–æœºåˆ¶ï¼Œè­¬å¦‚protobuf</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">OrderProcessor</span> </span>&#123;</span><br><span class="line">  <span class="keyword">sealed</span> <span class="class"><span class="keyword">trait</span> <span class="title">Command</span></span></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">ProcessOrder</span>(<span class="params">bank: <span class="type">BankId</span>, fromAccount: <span class="type">AccountId</span>, toAccount: <span class="type">AccountId</span>, amount: <span class="type">Amount</span></span>) <span class="keyword">extends</span> <span class="title">Command</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å³ä¾¿ä½ éµç…§Akkaæœ€ä½³å®è·µï¼Œä½†è¿˜æ˜¯æ— æ³•ä¿è¯ç»™actorå‘é€ä¸€äº›å®ƒä¸æ”¯æŒæ¶ˆæ¯ï¼Œactorçš„receiveæ–¹æ³•ä¼šæ¥å—ä»»æ„ç±»å‹çš„æ¶ˆæ¯ï¼Œå½“å®ƒæ”¶åˆ°ä¸æ”¯æŒçš„æ¶ˆæ¯æ—¶ï¼Œä¾¿è‡ªåŠ¨è½¬ç»™unhandledæ–¹æ³•ï¼Œæ­¤æ–¹æ³•é»˜è®¤åªä¼šæ‰“æ—¥å¿—è®°å½•ä¸€ä¸‹ï¼ˆéœ€è¦æ­£ç¡®çš„é…ç½®æ—¥å¿—æ‰“å°æœºåˆ¶ï¼‰ï¼Œè¿™å¯¹æ–°äººæ¥è¯´å¤ªå‘äº†ï¼Œä½ æ‰¾ä¸åˆ°ä»»ä½•é”™è¯¯ï¼Œä½†æ˜¯ç³»ç»Ÿå°±æ˜¯æ— æ³•æ­£å¸¸å·¥ä½œã€‚</p>
<p>æ›´æ·±å±‚æ¬¡çš„åŸå› åœ¨äºç¼ºå°‘ä¸€ç§æœºåˆ¶æ¥å¸®åŠ©æˆ‘ä»¬ç»´æŠ¤actorä¹‹é—´çš„é€šä¿¡åè®®ã€‚éšç€æ¶ˆæ¯ç±»å‹å¢å¤šï¼Œå¾ˆå®¹æ˜“å¿˜è®°è¿™äº›actoréƒ½æ”¯æŒä»€ä¹ˆç±»å‹çš„æ¶ˆæ¯ã€‚é€šè¿‡å•å…ƒæµ‹è¯•å’Œä¸¥æ ¼çš„æ—¥å¿—çº§åˆ«ä¼šæœ‰åŠ©äºç¼“è§£è¿™ç§é—®é¢˜ï¼ˆåªè¦æ¥å—åˆ°ä¸æ”¯æŒçš„æ¶ˆæ¯å°±æ‰“warnæ—¥å¿—ï¼‰ï¼Œä½†æ˜¯ä»ç„¶æ— æ³•å®Œå…¨é¿å…ã€‚</p>
<p>Akka Typedå°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ–°çš„APIæ˜¯ä¸ºâ€œåè®®ä¼˜å…ˆâ€è®¾è®¡çš„ï¼Œåœ¨å®ç°åŠŸèƒ½ä¹‹å‰ï¼Œä½ å¿…é¡»èŠ±ä¸€ç‚¹æ—¶é—´æƒ³ä¸€æƒ³æ¯ä¸€ä¸ªactorè¦å¤„ç†å“ªäº›æ¶ˆæ¯ã€‚ç»å…¸çš„Actor APIçš„æœ€ä½³å®è·µä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä½†å´æ˜¯å¯é€‰çš„ï¼Œä½ éœ€è¦åœ¨å®ç°çš„è¿‡ç¨‹ä¸­ä½¿è¦å¤„ç†æ¶ˆæ¯æ¡ç†æ¸…æ™°ã€‚</p>
<p>çœ‹è¿‡è®¸å¤šçœŸå®çš„Akka Systemåˆ†äº«ä¹‹åï¼Œæœ‰ä¸€ç‚¹å¿…é¡»å¼ºè°ƒä¸€ä¸‹ï¼šå¼€å‘Akka Typedçš„ç›®çš„ä¸ä»…ä»…æ˜¯ä¸ºäº†ä»¥ç»“æ„åŒ–çš„æ–¹å¼ç»„ç»‡æ¶ˆæ¯ä»¥åŠé˜²æ­¢ä¸¢å¤±é‚£ä¸€ç‚¹ç‚¹actorä¸æ”¯æŒçš„æ¶ˆæ¯ï¼Œå®ƒçš„ä¸»è¦ç›®çš„æ˜¯å¼•å¯¼æˆ‘ä»¬ä¼˜å…ˆè€ƒè™‘ç³»ç»Ÿè®¾è®¡ã€‚è®¾è®¡ä¸€ç»„æ°åˆ°å¥½å¤„çš„actorï¼Œé€‚å½“çš„é€šä¿¡ç²’åº¦ï¼Œæ­£ç¡®çš„æ¶ˆæ¯æ¨¡å¼ï¼Œè¿™æ ·å°±å¯ä»¥æ„å»ºä¸€ä¸ªå¼ºå¤§çš„ç³»ç»Ÿï¼Œä½†æ˜¯å®ƒçš„æ ¸å¿ƒå´éå¸¸ç®€å•ï¼Œå°±åƒé«˜è€ƒä¸€æ ·ç®€å•ã€‚ä½†æ˜¯æˆ‘è§åˆ°å¤ªå¤šè¿‡åº¦è®¾è®¡ï¼Œå¤§å®¶å€¾å‘äºè®¾è®¡è¿‡å¤šçš„actorä»¥åŠæ¶ˆæ¯ï¼Œå¼•å…¥äº†ä¸å¿…è¦çš„å¤æ‚åº¦ï¼Œæœ€åå°¾å¤§ä¸æ‰ã€‚</p>
<h2 id="Letâ€™s-build-a-payment-processor"><a class="header-anchor" href="#Letâ€™s-build-a-payment-processor">Â¶</a>Letâ€™s build a payment processor</h2>
<p>å‰é¢æˆ‘ä»¬å·²ç»è®²è¿‡ä½¿ç”¨Akka Typedå¯ä»¥éå¸¸å®¹æ˜“çš„å®šä¹‰åè®®ï¼Œä½†ä»€ä¹ˆæ˜¯â€œåè®®â€å‘¢ï¼Ÿåè®®ä»…ä»…æ˜¯â€œæ¶ˆæ¯â€å—ï¼Ÿç®€å•æ¥è¯´åè®®å°±æ˜¯ï¼šå®šä¹‰ä¸€ç»„æ¶ˆæ¯ï¼Œåœ¨ä¸¤ä¸ªåŠä»¥ä¸Šçš„ç»„ä»¶ä¹‹é—´æŒ‰ç‰¹å®šçš„é¡ºåºå’Œç»„åˆä¼ é€’ã€‚å¸¸è§çš„åè®®æœ‰TCPã€HTTPSç­‰ï¼Œè€Œæˆ‘ä»¬å®šä¹‰çš„æ˜¯åº”ç”¨å±‚çš„åè®®ã€‚ä½ å¯ä»¥è®¤ä¸ºåè®®å°±æ˜¯å¢å¼ºç‰ˆçš„APIï¼šAPIåªå®šä¹‰äº†ä¸ªä½“ä¹‹é—´çš„è°ƒç”¨æ ¼å¼ï¼ˆå‚æ•°ã€è¯·æ±‚å†…å®¹ã€å“åº”å†…å®¹ç­‰ï¼‰ï¼Œåè®®æè¿°äº†æ€ä¹ˆé€šè¿‡ç»„ä»¶ä¹‹é—´çš„ç›¸äº’è°ƒç”¨ä½¿ç³»ç»Ÿåˆ°è¾¾æœŸæœ›çš„çŠ¶æ€ã€‚</p>
<p>åœ¨Akka Typed APIä¸­ï¼Œåè®®ç”±ä¸€ç»„æ¶ˆæ¯classå’Œå¯¹åº”ç±»å‹çš„actorç»„æˆã€‚ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†ä»configurationç»„ä»¶è·å–é…ç½®æ•°æ®çš„åè®®ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sealed</span> <span class="class"><span class="keyword">trait</span> <span class="title">ConfigurationMessage</span></span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">RetrieveConfiguration</span>(<span class="params">merchantId: <span class="type">MerchantId</span>, replyTo: <span class="type">ActorRef</span>[<span class="type">ConfigurationResponse</span>]</span>) <span class="keyword">extends</span> <span class="title">ConfigurationMessage</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">sealed</span> <span class="class"><span class="keyword">trait</span> <span class="title">ConfigurationResponse</span></span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigurationFound</span>(<span class="params">merchantId: <span class="type">MerchantId</span>,  merchantConfiguration: <span class="type">MerchantConfiguration</span></span>) <span class="keyword">extends</span> <span class="title">ConfigurationResponse</span></span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigurationNotFound</span>(<span class="params">merchanId: <span class="type">MerchantId</span></span>) <span class="keyword">extends</span> <span class="title">ConfigurationResponse</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">MerchantId</span>(<span class="params">id: <span class="type">String</span></span>) <span class="keyword">extends</span> <span class="title">AnyVal</span></span></span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">BankIdentifier</span>(<span class="params">id: <span class="type">String</span></span>) <span class="keyword">extends</span> <span class="title">AnyVal</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">MerchantConfiguration</span>(<span class="params">bankIdentifier: <span class="type">BankIdentifier</span></span>)</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªä¾‹å­éµå¾ªäº†è¯·æ±‚-å“åº”çš„æ¶ˆæ¯è®¾è®¡æ¨¡å¼ï¼Œæ¬²çŸ¥æ›´å¤šè¯¦æƒ…ï¼Œè¯·å‚è§æœ¬ä¹¦ï¼š<a target="_blank" rel="noopener" href="https://www.manning.com/books/reactive-design-patterns">Reactive Design Patterns</a></p>
<p>å¦‚æœä½ ä»¥å‰ç”¨è¿‡ç»å…¸çš„Actor APIï¼Œä½ ä¼šå‘ç°è¿™é‡Œçš„å®ç°æ–¹å¼æœ‰ä¸¤ä¸ªä¸åŒçš„åœ°æ–¹ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ¶ˆæ¯å‘é€è€…çš„å¼•ç”¨åŒ…å«åœ¨æ¶ˆæ¯çš„å®šä¹‰ä¸­ï¼Œç»å…¸çš„Actor APIæ˜¯é€šè¿‡Akkaæä¾›çš„sender()æ–¹æ³•æ¥è·å–å‘é€è€…çš„ã€‚ç¬¬äºŒä¸ªæ˜¯æ¶ˆæ¯classä¸­åŒ…å«çš„ActorRefæ˜¯æœ‰ç±»å‹çš„ï¼Œå‘é€è€…ä½¿ç”¨å®ƒçš„æ—¶å€™å°±å¯ä»¥æ¸…æ¥šçš„çŸ¥é“åº”è¯¥å‘é€ä»€ä¹ˆç±»å‹çš„æ¶ˆæ¯ã€‚æˆ‘ä»¬ä½¿ç”¨æ¥å£ConfigurationResponseå®šä¹‰äº†é…ç½®æ•°æ®çš„è¿”å›æ ¼å¼ï¼Œå®ƒæœ‰ä¸¤ä¸ªå®ç°ç±»ï¼Œè¿™æ ·å‘é€è€…å°±å¯ä»¥å‘é€ä¸¤ç§æ ¼å¼çš„æ¶ˆæ¯ã€‚</p>
<p>çœ‹äº†Actorçš„å®šä¹‰ä¹‹åï¼Œå°±èƒ½ç†è§£ä¸ºä»€ä¹ˆAkka Typedæ¯”ç»å…¸çš„Actoræ›´å®¹æ˜“ä¸”æ›´å®‰å…¨çš„è§£å†³åè®®é—®é¢˜ï¼ŒConfigurationçš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Configuration</span>(<span class="params">context: <span class="type">ActorContext</span>[<span class="type">ConfigurationMessage</span>]</span>) <span class="keyword">extends</span> <span class="title">AbstractBehavior</span>[<span class="type">ConfigurationMessage</span>] </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å®šä¹‰çš„actorç»§æ‰¿<code>AbstractBehavior</code>ï¼Œå¹¶å¸¦æœ‰æŒ‡å®šçš„ç±»å‹ï¼Œå®ƒåªèƒ½å¤„ç†<code>ConfigurationMessage</code>ç±»å‹çš„æ¶ˆæ¯ï¼Œç¼–è¯‘å™¨å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ£€æŸ¥æ¶ˆæ¯çš„å‘é€è€…å‘é€çš„æ¶ˆæ¯æ˜¯å¦æ­£ç¡®ã€‚</p>
<p>ä¸Šé¢çš„ä¾‹å­ä¸­æˆ‘ä»¬ä½¿ç”¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹æ–¹å¼å®šä¹‰äº†Actorï¼Œç¨åæˆ‘ä»¬ä¼šå±•ç¤ºå‡½æ•°å¼ç¼–ç¨‹é£æ ¼ã€‚</p>
<h2 id="Implementing-our-first-typed-actor"><a class="header-anchor" href="#Implementing-our-first-typed-actor">Â¶</a>Implementing our first typed actor</h2>
<p><code>Configuration</code>æä¾›æŸ¥è¯¢åŠŸèƒ½ï¼šæ ¹æ®å•†æˆ·IdæŸ¥è¯¢æ”¯ä»˜æ–¹å¼ã€‚æˆ‘ä»¬ç»§ç»­ä½¿ç”¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹æ–¹å¼ï¼Œå¦‚æœä½¿ç”¨è¿‡ç»å…¸çš„Akka APIï¼Œä½ å¯¹è¿™ç§ä½¿ç”¨æ–¹å¼åº”è¯¥éå¸¸ç†Ÿæ‚‰ã€‚</p>
<p>ç»§æ‰¿<code>AbstractBehavior</code>å°±å¿…é¡»å®ç°<code>onMessage</code>æ–¹æ³•ï¼Œå®ƒè¿”å›ä¸€ä¸ª<code>Behavior</code>ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// the AbstractBehavior trait is the entry point for using the object-oriented style API</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Configuration</span>(<span class="params">context: <span class="type">ActorContext</span>[<span class="type">ConfigurationMessage</span>]</span>) <span class="keyword">extends</span> <span class="title">AbstractBehavior</span>[<span class="type">ConfigurationMessage</span>] </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// the mutable state here holds the configuration values of each merchant we know about</span></span><br><span class="line">  <span class="keyword">var</span> configurations: <span class="type">Map</span>[<span class="type">MerchantId</span>, <span class="type">MerchantConfiguration</span>] = <span class="type">Map</span>.empty</span><br><span class="line"></span><br><span class="line">  <span class="comment">// the onMessage method defines the initial behavior applied to a message upon reception</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">onMessage</span></span>(msg: <span class="type">ConfigurationMessage</span>): <span class="type">Behavior</span>[<span class="type">ConfigurationMessage</span>] = msg <span class="keyword">match</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">RetrieveConfiguration</span>(merchantId, replyTo) =&gt;</span><br><span class="line">      configurations.get(merchantId) <span class="keyword">match</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="type">Some</span>(configuration) =&gt;</span><br><span class="line">          <span class="comment">// reply to the sender using the fire-and-forget paradigm</span></span><br><span class="line">          replyTo ! <span class="type">ConfigurationFound</span>(merchantId, configuration)</span><br><span class="line">        <span class="keyword">case</span> <span class="type">None</span> =&gt;</span><br><span class="line">          <span class="comment">// reply to the sender using the fire-and-forget paradigm</span></span><br><span class="line">          replyTo ! <span class="type">ConfigurationNotFound</span>(merchantId)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// lastly, return the Behavior to be applied to the next received message</span></span><br><span class="line">      <span class="comment">// in this case, that&#x27;s just the same Behavior as we already have</span></span><br><span class="line">      <span class="keyword">this</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªactorä¸æˆ‘ä»¬åœ¨æœ¬æ–‡å¼€å¤´ä½¿ç”¨ç»å…¸çš„actor APIå®šä¹‰çš„actoréå¸¸ç›¸ä¼¼ï¼šè¦†ç›–onMessageæ–¹æ³•ï¼Œå¹¶æ ¹æ®æŒ‡å®šçš„æ¶ˆæ¯ç±»å‹åšå‡ºå¯¹åº”çš„å“åº”ã€‚</p>
<p>ä¸åŒç‚¹åœ¨äºonMessageå¯¹åº”çš„æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªBehaviorï¼Œä¸€ä¸ªactoræ¥æ”¶åˆ°æ¶ˆæ¯ä¹‹åçš„è¡Œä¸ºåŒ…å«å¦‚ä¸‹3ä¸ªæ­¥éª¤ï¼š</p>
<p>å‘é€ä¸€æ¡æˆ–å¤šæ¡æ¶ˆæ¯ç»™å…¶ä»–çš„actor<br>
åˆ›å»ºå­acotr<br>
è¿”å›ä¸€ä¸ªæ–°çš„è¡Œä¸ºï¼Œå‡†å¤‡æ¥æ”¶ä¸‹ä¸€ä¸ªæ¶ˆæ¯<br>
åœ¨Akka Typed APIä¸­ï¼Œä¸€ä¸ªBehaviorå³ä»£è¡¨äº†å¤„ç†å½“å‰æ¶ˆæ¯çš„è¡Œä¸ºï¼Œä¹Ÿè¡¨æ˜äº†å¦‚ä½•å¤„ç†ä¸‹ä¸€ä¸ªæ¶ˆæ¯â€”â€”é€šè¿‡è¿”å›ä¸€ä¸ªæ–°çš„Behaviorã€‚ä¹Ÿå¯ä»¥åªæ˜¯è¿”å›å½“å‰è¡Œä¸ºï¼ˆå°±åƒä¸Šé¢çš„ä¾‹å­ä¸€æ ·ï¼‰ï¼Œå› ä¸ºä½¿ç”¨é¢å‘å¯¹è±¡é£æ ¼çš„actorç»§æ‰¿è‡ªAbstractBehaviorï¼Œå®ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ªBehaviorï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨return thisã€‚</p>
<p>æœ¬ç³»åˆ—æ•™ç¨‹åé¢ä¼šè®¨è®ºæ›´å¤šå…³äºBehaviorçš„ç”¨æ³•ï¼Œä½¿ç”¨Akka Typed APIå®šä¹‰çš„actorçš„ä¸€ä¸ªä¼˜ç‚¹å°±æ˜¯éå¸¸å®¹æ˜“ç»„åˆå’Œæµ‹è¯•ã€‚</p>
<p>Typed Akka TestKitå¯ä»¥å¸®åŠ©ä½ è½»è€Œæ˜“ä¸¾çš„å¯¹actorè¿›è¡Œæµ‹è¯•ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConfigurationSpec</span> <span class="keyword">extends</span> <span class="title">ScalaTestWithActorTestKit</span> <span class="keyword">with</span> <span class="title">WordSpecLike</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;The Configuration actor&quot;</span> should &#123;</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;not find a configuration for an unknown merchant&quot;</span> in &#123;</span><br><span class="line">      <span class="comment">// define a probe which allows it to easily send messages</span></span><br><span class="line">      <span class="keyword">val</span> probe = createTestProbe[<span class="type">ConfigurationResponse</span>]()</span><br><span class="line"></span><br><span class="line">      <span class="comment">// spawn a new Configuration actor as child of the TestKit&#x27;s guardian actor</span></span><br><span class="line">      <span class="keyword">val</span> configurationActor = spawn(<span class="type">Configuration</span>())</span><br><span class="line"></span><br><span class="line">      <span class="comment">// send a message to the actor under test with the probe&#x27;s reference as sender</span></span><br><span class="line">      configurationActor ! <span class="type">Configuration</span>.<span class="type">RetrieveConfiguration</span>(<span class="type">MerchantId</span>(<span class="string">&quot;unknown&quot;</span>), probe.ref)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// expect a certain type of message as response. there are many different ways to retrieve</span></span><br><span class="line">      <span class="comment">// or to expect messages</span></span><br><span class="line">      <span class="keyword">val</span> response = probe.expectMessageType[<span class="type">Configuration</span>.<span class="type">ConfigurationNotFound</span>]</span><br><span class="line">      response.merchanId shouldBe <span class="type">MerchantId</span>(<span class="string">&quot;unknown&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Supervising-and-starting-the-actor"><a class="header-anchor" href="#Supervising-and-starting-the-actor">Â¶</a>Supervising and starting the actor</h2>
<p>actor Systemä¸ºactoræä¾›è¿è¡Œç¯å¢ƒã€åˆ†é…èµ„æºã€åŸºç¡€è®¾æ–½ã€‚åœ¨è¿™ä¸ªç³»ç»Ÿä¸­ï¼Œæ¯ä¸€ä¸ªactoréƒ½æœ‰ä¸€ä¸ªçˆ¶actorï¼Œæœ€é¡¶å±‚çš„actorå«åšæ ¹èŠ‚ç‚¹ï¼ˆ<code>root</code>)ï¼Œä½¿ç”¨<code>/</code>ä»£è¡¨ï¼Œå®ƒçš„ä¸¤ä¸ªç›´æ¥å­actoræ˜¯<code>/user</code>å’Œ<code>/system</code>ï¼Œ<code>/user</code>ç”¨äºåœ¨ç”¨æˆ·ç©ºé—´åˆ›å»ºå­actorï¼Œ<code>/system</code>å±äºakkaç³»ç»Ÿå†…éƒ¨ç®¡ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ›å»ºçš„æ‰€æœ‰çš„actoréƒ½ä»å±äº<code>/user</code>ã€‚</p>
<p>Akka Typedä¸ç»å…¸çš„Actor APIæœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„ä¸åŒç‚¹ï¼š<code>/user</code>çš„å¤„ç†é€»è¾‘ã€‚åœ¨ç»å…¸çš„Akka APIä¸­ï¼ŒAkkaæä¾›çš„<code>/useractor</code>è´Ÿè´£ç›‘ç®¡ä¸€åˆ‡ï¼›ä½†æ˜¯Akka TypedæŠŠè¿™ä¸ªæƒåŠ›äº¤ç»™äº†ç”¨æˆ·ã€‚ä¹Ÿå°±æ˜¯è¯´åº”ç”¨ç¨‹åºçš„å¼€å‘è€…åœ¨å®ç°actorçš„æ—¶å€™åŒæ—¶ä¹Ÿå¿…é¡»å¤šè€ƒè™‘ä¸€ä¸‹actoréƒ½ä¼šæœ‰å“ªäº›è¡Œä¸ºã€‚</p>
<p>åœ¨åˆ›å»º<code>Configuration</code> actorçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¤§å¯ä»¥ç›´æ¥æŠŠå®ƒä¼ ç»™<code>ActorSystem</code>å¹¶æŠŠå®ƒä½œä¸ºç›‘ç®¡è€…ï¼Œä½†å½“åˆ›å»ºæ›´å¤šactorçš„æ—¶å€™ï¼Œè¿™äº›actorå…¨éƒ¨éƒ½ç”±<code>Configuration</code> actorç›‘ç®¡å°±ä¸åˆé€‚äº†ã€‚è€Œä¸”åœ¨actoræ¨¡å‹ä¸­çˆ¶ç›‘ç®¡æœºåˆ¶é‡‡ç”¨çº§è”çš„æ–¹å¼å¤„ç†actorå¤±è´¥çš„é—®é¢˜ï¼šçˆ¶actorè´Ÿè´£å†³å®šå¦‚ä½•å¤„ç†å­actorï¼ˆå½“å®ƒæŠ›å¼‚å¸¸çš„æ—¶å€™ï¼‰ï¼Œå› æ­¤å¦‚ä½•å¯¹actoråˆ†ç»„ç›´æ¥å½±å“äº†ç›‘ç®¡ç­–ç•¥ã€‚åŒæ ·çš„æˆ‘ä»¬åº”è¯¥ä½¿ç”¨ä¸€ä¸ªä¸“ç”¨çš„çˆ¶actoråšä¸ºç›‘ç®¡actorï¼Œç”±å®ƒæ¥å†³å®šå¦‚ä½•å¤„ç†å­actorçš„å¤±è´¥é—®é¢˜ã€‚Akka Typed APIä¸­é»˜è®¤çš„ç›‘ç®¡ç­–ç•¥æ˜¯åœæ­¢å¤±è´¥çš„å­actorï¼ˆç»å…¸çš„Akka APIæ˜¯é‡å¯ï¼‰ã€‚ç”±æˆ‘ä»¬æŒ‡å®šç›‘ç®¡actorå¯ä»¥å¼€å‘æ›´çµæ´»çš„ç›‘ç®¡ç­–ç•¥ï¼Œæ ¹æ®ä¸åŒçš„å¼‚å¸¸åšå‡ºç›¸åº”çš„å†³ç­–ã€‚ç»¼ä¸Šæ‰€è¿°æˆ‘ä»¬å†³å®šä½¿ç”¨<code>PaymentProcessor</code> actoråšä¸ºæ‰€æœ‰actorçš„ç›‘ç®¡è€…ï¼Œactorå±‚çº§å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p>![/img/akka/typed/supervision.png]</p>
<p><code>PaymentProcessor</code>çš„åŠŸèƒ½ç›®å‰éå¸¸ç®€å•ï¼Œå¯åŠ¨çš„æ—¶å€™åˆ›å»ºä¸€ä¸ªå­actorâ€”â€”Configurationï¼Œå®ƒæ˜¯æ— çŠ¶æ€çš„ï¼Œä¹Ÿä¸æ¥æ”¶ä»»ä½•æ¶ˆæ¯ï¼Œè¿™æ¬¡æˆ‘ä»¬ä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹çš„é£æ ¼ï¼Œæ— éœ€ç»§æ‰¿ä»»ä½•æ¥å£ï¼Œåªéœ€è¦è¿”å›ä¸€ä¸ªBehaviorï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">PaymentProcessor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>() = <span class="type">Behaviors</span>.setup[<span class="type">Nothing</span>] &#123; context =&gt;</span><br><span class="line">    context.log.info(<span class="string">&quot;Typed Payment Processor started&quot;</span>)</span><br><span class="line">    context.spawn(<span class="type">Configuration</span>(), <span class="string">&quot;config&quot;</span>)</span><br><span class="line">    <span class="type">Behaviors</span>.empty</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Behaviors.setup()</code>æ–¹æ³•æ˜¯åˆ›å»º<code>Behavior</code>çš„å…¥å£ï¼Œè¯¥æ–¹æ³•åŒ…å«ä¸€ä¸ª<code>ActorContext</code>å˜é‡ï¼Œæˆ‘ä»¬ç”¨å®ƒæ‰“æ—¥å¿—ï¼Œè®°å½•actorå·²ç»å¯åŠ¨ï¼Œå¹¶ä½¿ç”¨<code>spawn()</code>æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ª<code>Configuration actor</code>ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ç”¨äºåˆ›å»ºactorï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯actorçš„åå­—ï¼Œå®ƒåœ¨actorè·¯å¾„ä¸­æ˜¯<code>/user/config</code>ã€‚</p>
<p>å› ä¸º<code>PaymentProcessor</code>ä¸å¤„ç†ä»»ä½•æ¶ˆæ¯ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨äº†<code>setup[Nothing]</code>ã€‚</p>
<p><code>Configuration</code> actorä½¿ç”¨é™æ€çš„createå‡½æ•°åˆ›å»º<code>Behavior</code>ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Configuration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(): <span class="type">Behavior</span>[<span class="type">ConfigurationMessage</span>] = <span class="type">Behaviors</span>.setup(context =&gt; <span class="keyword">new</span> <span class="type">Configuration</span>(context))</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ä¸‡äº‹ä¿±å¤‡ï¼Œåªæ¬ ä¸œé£ï¼Œéœ€è¦å¯åŠ¨<code>ActorSystem</code>æ¥åˆ›å»ºæˆ‘ä»¬çš„ç›‘ç®¡actorã€‚Akkaæä¾›äº†é™æ€æ–¹æ³•ç”¨æ¥åˆ›å»ºç›‘ç®¡actorï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Main</span> <span class="keyword">extends</span> <span class="title">App</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="type">ActorSystem</span>[<span class="type">Nothing</span>](<span class="type">PaymentProcessor</span>(), <span class="string">&quot;typed-payment-processor&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æå®šï¼ç°åœ¨è¿è¡Œ<code>Main</code>æ–¹æ³•ï¼Œå°±å¯ä»¥çœ‹åˆ°<code>PaymentProcessor</code>å¯åŠ¨äº†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[info] Running io.bernhardt.typedpayment.Main</span><br><span class="line">[INFO] [07/10/2019 09:36:42.483] [typed-payment-processor-akka.actor.default-dispatcher-5] [akka://typed-payment-processor/user] Typed Payment Processor started</span><br></pre></td></tr></table></figure>
</div></article><nav class="article-nav"><div class="article-nav-prev">ğŸ”™<a href="/2020/03/04/hadoop/installation/">Hadoop é›†ç¾¤æ­å»ºæ•™ç¨‹</a></div><div class="article-nav-next">ğŸ”œ<a href="/2019/11/27/react-ts/chapter_b_Unit_Testing_with_Jest/">ç¬¬åä¸€ç«  å•å…ƒæµ‹è¯•</a></div></nav><div id="base-discus"><div id="disqus_thread"></div><script>var disqus_shortname = 'barudisshu-github-io';
var disqus_identifier = '2020/01/03/akka/typed/akka-typed/';
var disqus_title = 'Akka Typed åè®®å’Œè¡Œä¸º';
var disqus_url = 'https://galudisu.info/2020/01/03/akka/typed/akka-typed/';
(function () {
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async>  </script></div></div></div><footer class="base-footer"><div class="footer-wrapper"><span>Â©2016 - 2025 <a href="https://galudisu.info">barudisshu</a>, unless otherwise noted.</span></div></footer><div class="dom-ready">
<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>

<link rel="stylesheet" href="//cdn.bootcss.com/pace/1.0.2/themes/green/pace-theme-flash.min.css">

<script src="/js/base.js"></script>

<script src="/js/rabbit-lyrics.js"></script>
</div></body></html>