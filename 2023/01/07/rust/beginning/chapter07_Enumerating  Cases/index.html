<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><title>rust基础入门[07] - Enumerating Cases</title>
<link rel="stylesheet" href="/css/layout.css">
<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="/css/vendors/rabbit-lyrics.css">
<link rel="shortcut icon" href="/img/favicon.ico"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="简单易懂の现代魔法" type="application/atom+xml">
</head><body><header class="base-menu"><div class="menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">简单易懂の现代魔法</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav></div></header><header class="base-mobile-menu"><div class="mobile-menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">简单易懂の现代魔法</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav><div class="toggle-menu" id="mobile-menu-toggle"><span class="menu-bar"></span><span class="menu-bar"> </span><span class="menu-bar"></span></div></div></header><div class="base-content"><div class="base-content-main"><article class="article-main"><h1 class="article-title">rust基础入门[07] - Enumerating Cases</h1><div class="article-meta"><p class="meta-item meta-time"><span class="meta-item-title"></span><i class="icon-calendar"> </i>2023-01-07</p><p class="meta-item meta-tag"><span class="meta-item-title"></span><i class="icon-tag"> </i><a class="tag-link" href="/tags/rust/">rust</a></p><p class="meta-item meta-category"><span class="meta-item-title"></span><i class="icon-bookmark"> </i><a class="category-link" href="/categories/learning/">learning</a></p></div><div class="article-content"><p>本章覆盖有：</p>
<ul>
<li>如何从有限集定义枚举变量</li>
<li>如何用枚举实现组合类型</li>
<li>如何用<code>match</code>模式匹配处理枚举</li>
<li>如何用<code>match</code>处理其他数据类型，诸如整数、字符、字符串</li>
<li>如何用布尔值泛化<code>match</code>结构</li>
</ul>
<span id="more"></span>
<h2 id="Enumerations"><a class="header-anchor" href="#Enumerations">¶</a>Enumerations</h2>
<p>与其下面的写法：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> EUROPE: <span class="type">u8</span> = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> ASIA: <span class="type">u8</span> = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> AFRICA: <span class="type">u8</span> = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> AMERICA: <span class="type">u8</span> = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">const</span> OCEANIA: <span class="type">u8</span> = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">continent</span> = ASIA;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> continent == EUROPE &#123; <span class="built_in">print!</span>(<span class="string">&quot;E&quot;</span>); &#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> continent == ASIA &#123; <span class="built_in">print!</span>(<span class="string">&quot;As&quot;</span>); &#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> continent == AFRICA &#123; <span class="built_in">print!</span>(Af<span class="string">&quot;); &#125;</span></span><br><span class="line"><span class="string">else if continent == AMERICA &#123; print!(&quot;</span>Am<span class="string">&quot;); &#125;</span></span><br><span class="line"><span class="string">else if continent == OCEANIA &#123; print!(&quot;</span>O<span class="string">&quot;); &#125;</span></span><br></pre></td></tr></table></figure>
<p>不如用下面等价写法：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Continent</span> &#123;</span><br><span class="line">	Europe,</span><br><span class="line">	Asia,</span><br><span class="line">	Africa,</span><br><span class="line">	America,</span><br><span class="line">	Oceania,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">contin</span> = Contient::Asia;</span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span> contin &#123;</span><br><span class="line">	Continent:: Europe =&gt; <span class="built_in">print!</span>(<span class="string">&quot;E&quot;</span>),</span><br><span class="line">	Continent:: Asia =&gt; <span class="built_in">print!</span>(<span class="string">&quot;As&quot;</span>),</span><br><span class="line">	Continent:: Africa =&gt; <span class="built_in">print!</span>(<span class="string">&quot;Af&quot;</span>),</span><br><span class="line">	Continent:: America =&gt; <span class="built_in">print!</span>(<span class="string">&quot;Am&quot;</span>),</span><br><span class="line">	Continent:: Oceania =&gt; <span class="built_in">print!</span>(<span class="string">&quot;O&quot;</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>enum</code>关键字后面指定了一个新的类型Continent。这种类型称为枚举(enumerative)，因为它包含一系列条目，每个条目有唯一关联数字。在这个例子中，类型Continent允许的值是Europe，Asia，Africa，America和Oceania，内部由值0u8，1u8，2u8，3u8，4u8表示。</p>
<p>创建了枚举类型后，就可以创建该类型的对象。例如这里的 contin 变量，类型是 Continent。</p>
<p>枚举对象仅有一个值，这个值称为“变量(variants)”。</p>
<p>注意，变量的值必须由它的类型区分，例如 Continent::Asia。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">T</span> &#123;A, B, C, D&#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">n</span>: <span class="type">i32</span> = T::D;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">e</span>: T = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>第二行会发生编译错误，第二三行都提示mismatched types错误。尽管期望是<code>i32</code>的枚举值<code>main::T</code>，但枚举类型并不能隐式转换为数值类型，数值类型也不能隐式转换为枚举类型。</p>
<h2 id="The-match-Construct"><a class="header-anchor" href="#The-match-Construct">¶</a>The match Construct</h2>
<p>Rust中，match语句是基本工具。类似于C语言的switch，但在很多层面不同。</p>
<p>首先，match关键字不需要闭合括号。</p>
<p>其次，多个case，称为“手臂(arms)”，用作模式，跟随符号“=&gt;”，接着跟着一个表达式。这些手臂用逗号分隔。</p>
<p>不管是声明枚举类型，还是在“<code>match</code>”语句，最后一个条目的逗号可写可不写。通常的做法是，如果是每行一个item，就带上逗号；如果是整行罗列，最后一个逗号会省略：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">CardinalPoint</span> &#123; North, South, West, East &#125;;</span><br></pre></td></tr></table></figure>
<p>match语句的行为是。</p>
<p>首先，<code>match</code>后的语句先被执行，因此获取一个值，例如这里是Continent::Asia。</p>
<p>然后，这个值会被用于比较五个pattern的每个手臂(arm)，按照行顺序进行比较。如果匹配，右边的语句被执行，语句结束。</p>
<p>注意每个手臂右边的必须是一个单一表达式。</p>
<p>事实上，只要带上分号，任何表达式都能成为有效的语句。例如</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = <span class="number">7.2</span>;</span><br><span class="line"><span class="number">12</span>;</span><br><span class="line"><span class="literal">true</span>;</span><br><span class="line"><span class="number">4</span> &gt; <span class="number">7</span>;</span><br><span class="line"><span class="number">5.7</span> + <span class="number">5</span>. *a;</span><br></pre></td></tr></table></figure>
<p>上述这些代码是有效的，只是什么也没做。</p>
<p>但是，有些语句并不是有效的表达式。例如，“let a = 3; ”、“fn empty() {}”，</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">match</span> contin &#123;</span><br><span class="line">	Continent::Europe =&gt; <span class="keyword">let</span> <span class="variable">a</span> = <span class="number">7</span>;,</span><br><span class="line">	Continent::Asia =&gt; <span class="keyword">let</span> <span class="variable">a</span> = <span class="number">7</span>,</span><br><span class="line">	Continent::Africa =&gt; f <span class="title function_ invoke__">aaa</span>() &#123;&#125;,</span><br><span class="line">	Continent::America =&gt; <span class="built_in">print!</span>(<span class="string">&quot;Am&quot;</span>),</span><br><span class="line">	Continent::Oceania =&gt; <span class="built_in">print!</span>(<span class="string">&quot;O&quot;</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>前面三个case会报错，因为 “=&gt;”后面跟的不是有效的表达式。</p>
<p>若果我们要执行多个表达式，可以使用语句块方式实现：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Continent</span> &#123;</span><br><span class="line">	Europe,</span><br><span class="line">	Asia,</span><br><span class="line">	Africa,</span><br><span class="line">	America,</span><br><span class="line">	Oceania,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">contin</span> = Continent::Asia;</span><br><span class="line"><span class="keyword">match</span> contin &#123;</span><br><span class="line">	Continent::Europe =&gt; &#123;</span><br><span class="line">		contin = Continent::Asia;</span><br><span class="line">		<span class="built_in">print!</span>(<span class="string">&quot;E&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	Continent::Asia =&gt; &#123;</span><br><span class="line">		<span class="keyword">let</span> <span class="variable">a</span> = <span class="number">7</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	Continent::Africa =&gt; <span class="built_in">print!</span>(<span class="string">&quot;Af&quot;</span>),</span><br><span class="line">	Continent::America =&gt; <span class="built_in">print!</span>(<span class="string">&quot;Am&quot;</span>),</span><br><span class="line">	Continent::Oceania =&gt; <span class="built_in">print!</span>(<span class="string">&quot;O&quot;</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Relational-Operators-and-Enums"><a class="header-anchor" href="#Relational-Operators-and-Enums">¶</a>Relational Operators and Enums</h2>
<p>枚举不能用“==”操作符作比较。实际上，下面程序是不合法的：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">CardinalPoint</span> &#123; North, South, West, East &#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">direction</span> = CardinalPoint::South;</span><br><span class="line"><span class="keyword">if</span> direction == CardinalPoint::North &#123; &#125;</span><br></pre></td></tr></table></figure>
<p>编译器报“binary operation <code>==</code> cannot be applied to type <code>main::CardinalPoint</code>”。因此，你应该用 match 语句。</p>
<p>不仅是“==”操作符，其它二进制操作符都是错误的：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">CardinalPoint</span> &#123; North, South, West, East &#125;;</span><br><span class="line"><span class="keyword">if</span> CardinalPoint::South &lt; CardinalPoint::North &#123; &#125;</span><br></pre></td></tr></table></figure>
<h2 id="Handling-All-the-Cases"><a class="header-anchor" href="#Handling-All-the-Cases">¶</a>Handling All the Cases</h2>
<p>下面代码编译出错：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">CardinalPoint</span> &#123; North, South, West, East &#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">direction</span> = CardinalPoint::South;</span><br><span class="line"><span class="keyword">match</span> direction &#123;</span><br><span class="line">	CardinalPoint::North =&gt; <span class="built_in">print!</span>(<span class="string">&quot;NORTH&quot;</span>),</span><br><span class="line">	CardinalPoint::South =&gt; <span class="built_in">print!</span>(<span class="string">&quot;SOUTH&quot;</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>会获得一个错误“non-exhaustive patterns: <code>West</code> and <code>East</code> not covered”。编译器会抱怨说，四个枚举值，仅两个被考虑了，另外两个West和East没有考虑进去。这是由于Rust要求显式处理所有的情况。</p>
<p>要解决这个问题有两种做法，一是匹配所有的情况；</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">CardinalPoint</span> &#123; North, South, West, East &#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">direction</span> = CardinalPoint::South;</span><br><span class="line"><span class="keyword">match</span> direction &#123;</span><br><span class="line">	CardinalPoint::North =&gt; <span class="built_in">print!</span>(<span class="string">&quot;NORTH&quot;</span>),</span><br><span class="line">	CardinalPoint::South =&gt; <span class="built_in">print!</span>(<span class="string">&quot;SOUTH&quot;</span>),</span><br><span class="line">	CardinalPoint::East =&gt; &#123;&#125;,</span><br><span class="line">	CardinalPoint::West =&gt; &#123;&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>二是使用下划线，做默认情况处理；</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">CardinalPoint</span> &#123; North, South, West, East &#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">direction</span> = CardinalPoint::South;</span><br><span class="line"><span class="keyword">match</span> direction &#123;</span><br><span class="line">	CardinalPoint::North =&gt; <span class="built_in">print!</span>(<span class="string">&quot;NORTH&quot;</span>),</span><br><span class="line">	CardinalPoint::South =&gt; <span class="built_in">print!</span>(<span class="string">&quot;SOUTH&quot;</span>),</span><br><span class="line">	_ =&gt; &#123;&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意，下划线语句会匹配任何值，所以要将它放在最后。</p>
<h2 id="Using-match-with-Numbers"><a class="header-anchor" href="#Using-match-with-Numbers">¶</a>Using match with Numbers</h2>
<p>match结构，除了可以用于枚举，也可以用于其他数据类型：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">match</span> <span class="string">&quot;value&quot;</span> &#123;</span><br><span class="line">	<span class="string">&quot;val&quot;</span> =&gt; <span class="built_in">print!</span>(<span class="string">&quot;value &quot;</span>),</span><br><span class="line">	_ =&gt; <span class="built_in">print!</span>(<span class="string">&quot;other &quot;</span>),</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">match</span> <span class="number">3</span> &#123;</span><br><span class="line">	<span class="number">3</span> =&gt; <span class="built_in">print!</span>(<span class="string">&quot;three &quot;</span>),</span><br><span class="line">	<span class="number">4</span> =&gt; <span class="built_in">print!</span>(<span class="string">&quot;four &quot;</span>),</span><br><span class="line">	<span class="number">5</span> =&gt; <span class="built_in">print!</span>(<span class="string">&quot;five &quot;</span>),</span><br><span class="line">	_ =&gt; <span class="built_in">print!</span>(<span class="string">&quot;other &quot;</span>),</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">match</span> <span class="string">&#x27;.&#x27;</span> &#123;</span><br><span class="line">	<span class="string">&#x27;:&#x27;</span> =&gt; <span class="built_in">print!</span>(<span class="string">&quot;colon &quot;</span>),</span><br><span class="line">	<span class="string">&#x27;.&#x27;</span> =&gt; <span class="built_in">print!</span>(<span class="string">&quot;point &quot;</span>),</span><br><span class="line">	_ =&gt; <span class="built_in">print!</span>(<span class="string">&quot;other &quot;</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果将输出：“other three point”。</p>
<h2 id="Enumerations-with-Data"><a class="header-anchor" href="#Enumerations-with-Data">¶</a>Enumerations with Data</h2>
<p>Rust的枚举类型，并没有前面看到的这么简单：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Result</span> &#123;</span><br><span class="line">	<span class="title function_ invoke__">Success</span>(<span class="type">f64</span>),</span><br><span class="line">	<span class="title function_ invoke__">Failure</span>(<span class="type">u16</span>, <span class="type">char</span>),</span><br><span class="line">	Uncertainty,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// let outcome = Result::Success(23.67);</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">outcome</span> = <span class="type">Result</span>::<span class="title function_ invoke__">Failure</span>(<span class="number">1200</span>, <span class="string">&#x27;X&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span> outcome &#123;</span><br><span class="line">	<span class="type">Result</span>::<span class="title function_ invoke__">Success</span>(value) =&gt; <span class="built_in">print!</span>(<span class="string">&quot;Result: &#123;&#125;&quot;</span>, value),</span><br><span class="line">	<span class="type">Result</span>::<span class="title function_ invoke__">Failure</span>(error_code, module) =&gt; <span class="built_in">print!</span>(<span class="string">&quot;Error n. &#123;&#125; in module &#123;&#125;&quot;</span>, error_code, module),</span><br><span class="line">	<span class="type">Result</span>::Uncertainty =&gt; &#123;&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果将输出：“Error n. 1200 in module X”。</p>
<p>若替换为注解行，结果将输出为“Result: 23.67”。</p>
<p>对比于C语言，Rust的枚举类型包含枚举和组合的特性。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">eResult</span> &#123;</span></span><br><span class="line">        Success,</span><br><span class="line">        Failure,</span><br><span class="line">        Uncertainty</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sResult</span> &#123;</span></span><br><span class="line">        <span class="class"><span class="keyword">enum</span> <span class="title">eResult</span> <span class="title">r</span>;</span></span><br><span class="line">        <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">            <span class="type">double</span> value;</span><br><span class="line">            <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">                <span class="type">unsigned</span> <span class="type">short</span> error_code;</span><br><span class="line">                <span class="type">char</span> module;</span><br><span class="line">            &#125; s;</span><br><span class="line">        &#125; u;</span><br><span class="line">    &#125; outcome;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">outcome.r = Success;</span></span><br><span class="line"><span class="comment">outcome.u.value = 23.67;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">outcome.r = Failure;</span><br><span class="line">outcome.u.s.error_code = <span class="number">1200</span>;</span><br><span class="line">outcome.u.s.module = <span class="string">&#x27;X&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> (outcome.r) &#123;</span><br><span class="line">	<span class="keyword">case</span> Success:</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Result: %g&quot;</span>, outcome.u.value);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> Failure:</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Error n. %d in module %c&quot;</span>,</span><br><span class="line">			   outcome.u.s.error_code,</span><br><span class="line">			   outcome.u.s.module);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> Uncertainty:</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在“match”语句中，模式匹配的参数，例如Result::Success(value)中的value，会被看做是该scope下的变量，以及该变量的类型，由这个手臂(arm)声明。</p>
<p>当手臂(arm)满足case，这个变量的值就被初始化。例如value的值是23.67。并且用于手臂右边的作用范围。</p>
<p>如果不需要这个变量，为避免编译告警，可以：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Result</span> &#123;</span><br><span class="line">	<span class="title function_ invoke__">Success</span>(<span class="type">f64</span>),</span><br><span class="line">	<span class="title function_ invoke__">Failure</span>(<span class="type">u16</span>, <span class="type">char</span>),</span><br><span class="line">	Uncertainty,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">outcome</span> = <span class="type">Result</span>::<span class="title function_ invoke__">Success</span>(<span class="number">23.67</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span> outcome &#123;</span><br><span class="line">	<span class="type">Result</span>::<span class="title function_ invoke__">Success</span>(_) =&gt; <span class="built_in">print!</span>(<span class="string">&quot;OK&quot;</span>),</span><br><span class="line">	<span class="type">Result</span>::<span class="title function_ invoke__">Failure</span>(error_code, module) =&gt;</span><br><span class="line">		<span class="built_in">print!</span>(<span class="string">&quot;Error n. &#123;&#125; in module &#123;&#125;&quot;</span>, error_code, module),</span><br><span class="line">	<span class="type">Result</span>::Uncertainty =&gt; &#123;&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="“match”-Expressions"><a class="header-anchor" href="#“match”-Expressions">¶</a>“match” Expressions</h2>
<p>类似于“if”表达式，“match”也有表达式：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">CardinalPoint</span> &#123; North, South, West, East &#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">direction</span> = CardinalPoint::South;</span><br><span class="line"><span class="built_in">print!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, <span class="keyword">match</span> direction &#123;</span><br><span class="line">	CardinalPoint::North =&gt; <span class="string">&#x27;N&#x27;</span>,</span><br><span class="line">	CardinalPoint::South =&gt; <span class="string">&#x27;S&#x27;</span>,</span><br><span class="line">	_ =&gt; <span class="string">&#x27;*&#x27;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>结果会输出：“S.”。</p>
<p>这里有个要求，就是手臂右边的值，必须类型是一样的。如果将第三个case改为“_ =&gt; {}”。会发生“match arms have incompatible types”。因为是一个match表达式，所以它只能有指定的一种类型。</p>
<h2 id="Use-of-Guards-in-match-Constructs"><a class="header-anchor" href="#Use-of-Guards-in-match-Constructs">¶</a>Use of Guards in match Constructs</h2>
<p>假设我们要区分整数的类别：负数、0、1、正数：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="variable">n</span> <span class="keyword">in</span> -<span class="number">2</span>..<span class="number">5</span> &#123;</span><br><span class="line">	<span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; is &#123;&#125;.&quot;</span>, n, <span class="keyword">match</span> n &#123;</span><br><span class="line">		<span class="number">0</span> =&gt; <span class="string">&quot;zero&quot;</span>,</span><br><span class="line">		<span class="number">1</span> =&gt; <span class="string">&quot;one&quot;</span>,</span><br><span class="line">		_ <span class="keyword">if</span> n &lt; <span class="number">0</span> =&gt; <span class="string">&quot;negative&quot;</span>,</span><br><span class="line">		_ =&gt; <span class="string">&quot;plural&quot;</span>,</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article><div id="base-discus"><div id="disqus_thread"></div><script>var disqus_shortname = 'barudisshu-github-io';
var disqus_identifier = '2023/01/07/rust/beginning/chapter07_Enumerating  Cases/';
var disqus_title = 'rust基础入门[07] - Enumerating Cases';
var disqus_url = 'https://galudisu.info/2023/01/07/rust/beginning/chapter07_Enumerating  Cases/';
(function () {
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async>  </script></div></div></div><footer class="base-footer"><div class="footer-wrapper"><span>©2016 - 2025 <a href="https://galudisu.info">barudisshu</a>, unless otherwise noted.</span></div></footer><div class="dom-ready">
<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>

<link rel="stylesheet" href="//cdn.bootcss.com/pace/1.0.2/themes/green/pace-theme-flash.min.css">

<script src="/js/base.js"></script>

<script src="/js/rabbit-lyrics.js"></script>
</div></body></html>